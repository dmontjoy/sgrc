{
	"auto_complete":
	{
		"selected_items":
		[
			[
				"mes",
				"message"
			]
		]
	},
	"buffers":
	[
		{
			"file": "programas/reporte/stakeholder/areporte.php",
			"settings":
			{
				"buffer_size": 55672,
				"line_ending": "Unix"
			}
		},
		{
			"file": "/C/Users/daniel.montjoyp/AppData/Roaming/Sublime Text 2/Packages/Default/Default (Windows).sublime-keymap",
			"settings":
			{
				"buffer_size": 30564,
				"line_ending": "Unix"
			}
		},
		{
			"file": "informacion/reporte/class.ireporte.php",
			"settings":
			{
				"buffer_size": 91665,
				"line_ending": "Windows"
			}
		},
		{
			"contents": "<?php\n\n/*\n * To change this template, choose Tools | Templates\n * and open the template in the editor.\n * =\n *\n */\n\ninclude_once '../../include_utiles.php';\ninclude_once '../../../informacion/persona/class.ipersona.php';\ninclude_once '../../../informacion/mapa/class.imapa.php';\ninclude_once '../../../informacion/reclamo/class.ireclamo.php';\ninclude_once '../../../informacion/persona/class.iestado_civil.php';\ninclude_once '../../../gestion/stakeholder/class.gstakeholder.php';\n\ninclude_once '../../../gestion/calificacion/class.gdimension_matriz_sh.php';\n\ninclude_once '../../../gestion/stakeholder/class.ghogar.php';\ninclude_once '../../../informacion/stakeholder/class.ihogar.php';\ninclude_once '../../../informacion/persona/class.ipersona_parentesco.php';\n\ninclude_once '../../../informacion/stakeholder/class.istakeholder.php';\ninclude_once '../../../informacion/interaccion/class.iinteraccion.php';\ninclude_once '../../../informacion/interaccion/class.iinteraccion_tipo.php';\ninclude_once '../../../informacion/interaccion/class.iinteraccion_estado.php';\ninclude_once '../../../informacion/compromiso/class.icompromiso_estado.php';\ninclude_once '../../../informacion/compromiso/class.icompromiso_prioridad.php';\ninclude_once '../../../informacion/compromiso/class.icompromiso.php';\ninclude_once '../../../informacion/calificacion/class.idimension_matriz_sh.php';\ninclude_once '../../../programas/persona/persona/ver_persona.php';\ninclude_once '../../../programas/tag/tag/ver_tag.php';\ninclude_once '../../../programas/stakeholder/stakeholder/abusca_rapida_sh.php';\ninclude_once '../../../programas/stakeholder/stakeholder/astakeholder_interaccion.php';\ninclude_once '../../../programas/predio/predio/apredio_mapa.php';\n\ninclude_once '../../../programas/mensajes.php';\n\n//print_r($_REQUEST);\n\n\n\n$ayudante = new Ayudante();\n$op_stakeholder = $_REQUEST[\"op_stakeholder\"];\n\n$idmodulo = $_REQUEST[idmodulo];\n$idpersona = $_REQUEST[idpersona];\n$idpersona_compuesto = $_REQUEST[idpersona_compuesto];\n\n$nombre = $ayudante->caracter($_REQUEST[nombre]);\n\n$es_stakeholder = $_REQUEST['es_stakeholder'];\n\n$modo = $_REQUEST['modo'];\n\n$folder = $_REQUEST['folder'];\n\n$busca_rapida_stakeholder = $_REQUEST[busca_rapida_stakeholder];\n$busca_rapida_predio_stakeholder = $_REQUEST[busca_rapida_predio_stakeholder];\n\n$busca_rapida_tag = $_REQUEST[busca_rapida_tag];\n$idtag_compuesto = $_REQUEST[idtag_compuesto];\n$idpersona_tag = $_REQUEST[idpersona_tag]; //eliminar tag\n\n$idpersona_red = $_REQUEST[idpersona_red];\n$idmodulo_red = $_REQUEST[idmodulo_red];\n$idpersona_compuesto_red = $_REQUEST[idpersona_compuesto_red];\n$idpersona_red_stakeholder = $_REQUEST[idpersona_red_stakeholder];\n$idmodulo_persona_red = $_REQUEST[idmodulo_persona_red];\n//interaccion\n$interaccion = $_REQUEST[interaccion];\n\n$inicio = $_REQUEST[inicio];\n$fecha_interaccion = $_REQUEST[fecha_interaccion];\n$idinteraccion_estado = $_REQUEST[idinteraccion_estado];\n$idinteraccion_tipo = $_REQUEST[idinteraccion_tipo];\n$idinteraccion_prioridad = $_REQUEST[idinteraccion_prioridad];\n$prioridades = $_REQUEST['prioridades'];\n$tipos = $_REQUEST['tipos'];\n$fecha_del = $_REQUEST['fecha_del'];\n$fecha_al = $_REQUEST['fecha_al'];\n\n$orden_complejo_tag = $_REQUEST[orden_complejo_tag];\n\n$idinteraccion = $ayudante->caracter($_REQUEST['idinteraccion']);\n$idmodulo_interaccion = $_REQUEST['idmodulo_interaccion'];\n$idinteraccion_complejo_tag = $_REQUEST[idinteraccion_complejo_tag];\n$idinteraccion_complejo_rc = $_REQUEST[idinteraccion_complejo_rc];\n$idinteraccion_complejo_sh = $_REQUEST[idinteraccion_complejo_sh];\n$idinteraccion_archivo = $_REQUEST[idinteraccion_archivo];\n$comentario_interaccion = $ayudante->caracter($_REQUEST[comentario_interaccion]);\n\n$ruta = $_REQUEST['ruta'];\n$programa = $_REQUEST['programa'];\n//compromiso\n$idcompromiso = $_REQUEST['idcompromiso'];\n$idmodulo_compromiso = $_REQUEST['idmodulo_compromiso'];\n\n$fecha_compromiso = $_REQUEST[fecha_compromiso];\n$fecha_fin_compromiso = $_REQUEST[fecha_fin_compromiso];\n$compromiso = $ayudante->caracter($_REQUEST[compromiso]);\n$idcompromiso_estado = $_REQUEST[idcompromiso_estado];\n\n$idcompromiso_prioridad = $_REQUEST[idcompromiso_prioridad];\n$idcompromiso_rc = $_REQUEST[idcompromiso_rc];\n$idcompromiso_sh = $_REQUEST[idcompromiso_sh];\n$idcompromiso_archivo = $_REQUEST[idcompromiso_archivo];\n$comentario_compromiso = $ayudante->caracter($_REQUEST[comentario_compromiso]);\n$hora_compromiso = $_REQUEST[hora_compromiso];\n$minuto_compromiso = $_REQUEST[minuto_compromiso];\n$hora_fin_compromiso = $_REQUEST[hora_fin_compromiso];\n$minuto_fin_compromiso = $_REQUEST[minuto_fin_compromiso];\n\n$limite = $_REQUEST[limite];\n\n$idsh_dimension = $_REQUEST[idsh_dimension];\n$idmodulo_sh_dimension = $_REQUEST[idmodulo_sh_dimension];\n\n\n\n//calificacion\n$fecha = $_REQUEST[fecha];\n$dimension = $_REQUEST[dimension];\n$comentario = $ayudante->caracter($_REQUEST[comentario]);\n\n$idsh_dimension_matriz_sh = $_REQUEST[idsh_dimension_matriz_sh];\n//tag\n$tag = $_REQUEST[tag];\n$tags = $_REQUEST[tags];\n$idtag = $_REQUEST[idtag];\n$idmodulo_tag = $_REQUEST[idmodulo_tag];\n$idmodulo_persona_tag = $_REQUEST[idmodulo_persona_tag];\n//analisis red\n$rango_fecha = $_REQUEST[rango_fecha];\n\n$presenta = $_REQUEST[presenta]; //si hace un echo o retorna una cadena\n$persona = $_REQUEST[persona]; //varible que me indica : 1 si es sh, 2 si es rc\n$tabla_interaccion = $_REQUEST[tabla_interaccion]; // variable que me indica si construyo la tabla o solo un bloque\n$persona = $_REQUEST[persona];\n$idpersona_tipo = $_REQUEST['idpersona_tipo'];\n$tiene_cabecera = $_REQUEST['tiene_cabecera'];\n\n$idpredio = $_REQUEST['idpredio'];\n$idpredio_archivo = $_REQUEST['idpredio_archivo'];\n$comentario_predio = $_REQUEST['comentario_predio'];\n\n$idsh_compuesto = $_REQUEST['idsh_compuesto'];\n\n$idtag_entidad = $_REQUEST[idtag_entidad];\n\n$identidad = $_REQUEST[identidad];\n\n$entidad = $_REQUEST[entidad];\n\n$idgis_item = $_REQUEST[idgis_item];\n\n$fid_string = $_REQUEST[fid_string];\n\n$idpredio_complejo_tag = $_REQUEST[idpredio_complejo_tag];\n\n$idstakeholder_complejo_tag = $_REQUEST[idstakeholder_complejo_tag];\n\n$idmapa = $_REQUEST[idmapa];\n\n$tags_predio = $_REQUEST[tags_predio];\n\n$intensidad = $_REQUEST[intensidad];\n$idmodulo_predio = $_REQUEST[idmodulo_predio];\n\n//hogar\n$idhogar_complejo_sh = $_REQUEST['idhogar_complejo_sh'];\n$fecha_hogar = $_REQUEST['fecha_hogar'];\n$comentario_hogar = $_REQUEST['comentario_hogar'];\n$idsh_hogar = $_REQUEST['idsh_hogar'];\n$idmodulo_sh_hogar = $_REQUEST['idmodulo_sh_hogar'];\n$idpersona_parentesco = $_REQUEST['idpersona_parentesco'];\n/*\n  if (!$seguridad->verificaSesion()) {\n  $mensaje = \"Ingrese su usuario y contraseÃ±a\";\n  header(\"Location: ../../../index.php?mensaje=$mensaje\");\n  } */\n\n//echo \"permiso: \"; print_r($_SESSION[\"permiso\"]); exit;\n\n/* session_start();\n\n  $_SESSION[idusu] = 1;\n  $_SESSION[idmodulo_a] = 1;\n  $_SESSION[idmodulo_a] = 1; */\n//echo $op_stakeholder;\nswitch ($op_stakeholder) {\n    case \"ver_cabecera_stakeholder\" :ver_cabecera_stakeholder($idpersona, $idmodulo, $idpersona_compuesto);\n        break;\n    case \"busqueda_rapida_stakeholder\":busqueda_rapida_stakeholder($busca_rapida_stakeholder);\n        break;\n    case \"busqueda_rapida_predio_stakeholder\":busqueda_rapida_predio_stakeholder($busca_rapida_predio_stakeholder);\n        break;\n    case \"ver_editar_persona\":\n        echo ver_editar_persona($es_stakeholder, $idpersona, $idmodulo, $idpersona_compuesto, $idpersona_tipo, $tiene_cabecera);\n        break;\n    case \"ver_tag\":ver_tag($busca_rapida_tag, $idtag_entidad);\n        break;\n    case \"ver_tag_stakeholder\":\n        ver_tag_stakeholder($idpersona, $idmodulo);\n        break;\n    case \"ver_editar_tag_stakeholder\":\n        ver_editar_tag_stakeholder($idpersona, $idmodulo);\n        break;\n    case \"guardar_tag_stakeholder\":guardar_tag_stakeholder($idstakeholder_complejo_tag, $orden_complejo_tag, $idpersona, $idmodulo);\n        break;\n    case \"eliminar_tag_stakeholder\":eliminar_tag_stakeholder($idpersona_tag, $idpersona, $idmodulo, $idmodulo_persona_tag);\n        break;\n    case \"ver_tab_stakeholder\":ver_tab_stakeholder($idpersona, $idmodulo, $idpersona_tipo, $idpersona_compuesto);\n        break;\n    case \"ver_editar_red_stakeholder\":ver_editar_red_stakeholder($idpersona, $idmodulo);\n        break;\n    case \"guardar_red_stakeholder\":guardar_red_stakeholder($idpersona_compuesto_red, $idpersona, $idmodulo);\n        break;\n    case \"eliminar_red_stakeholder\":eliminar_red_stakeholder($idpersona_red_stakeholder, $idpersona, $idmodulo, $idmodulo_persona_red);\n        break;\n    case \"ver_interaccion_stakeholder\":ver_interaccion_stakeholder($idpersona, $idmodulo, $idinteraccion, $idmodulo_interaccion, $persona, $presenta);\n        break;\n    case \"ver_bloque_interaccion\":ver_bloque_interaccion($idpersona_tipo, $nombre, $idpersona, $idmodulo, $inicio, $persona, $presenta, $modo, $idsh_compuesto);\n        break;\n\n    case \"eliminar_interaccion_stakeholder\":eliminar_interaccion_stakeholder($idinteraccion, $idmodulo_interaccion);\n        break;\n    case \"guardar_interaccion_stakeholder\":guardar_interaccion_stakeholder($idpersona, $idmodulo, $interaccion, $fecha_interaccion, $idinteraccion_estado, $idinteraccion_tipo, $idinteraccion_complejo_tag, $idinteraccion_prioridad, $idinteraccion_complejo_rc, $idinteraccion_complejo_sh, $comentario_interaccion, $orden_complejo_tag);\n        break;\n    case \"ver_interaccion_stakolder_complejo\":ver_interaccion_stakolder_complejo($idpersona, $idmodulo, $idinteraccion, $idmodulo_interaccion, $persona, $presenta);\n        break;\n    case \"actualizar_interaccion_stakeholder\":actualizar_interaccion_stakeholder($idinteraccion, $idmodulo_interaccion, $idinteraccion_complejo_tag, $idinteraccion_complejo_rc, $idinteraccion_complejo_sh, $idinteraccion_archivo, $comentario_interaccion, $fecha_interaccion, $idinteraccion_estado, $idinteraccion_tipo, $idinteraccion_prioridad, $interaccion, $idpersona, $idmodulo, $persona, $presenta, $orden_complejo_tag);\n        break;\n    case \"ver_compromiso_stakeholder\":ver_compromiso_stakeholder($idpersona, $idmodulo, $idinteraccion, $idmodulo_interaccion, $idcompromiso, $idmodulo_compromiso);\n        break;\n    case \"ver_editar_compromiso_stakeholder\":ver_editar_compromiso_stakeholder($idcompromiso, $idmodulo_compromiso, $idpersona, $idmodulo);\n        break;\n    case \"guardar_compromiso_stakeholder\":guardar_compromiso_stakeholder($idinteraccion, $idmodulo_interaccion, $fecha_compromiso, $hora_compromiso, $minuto_compromiso, $fecha_fin_compromiso, $hora_fin_compromiso, $minuto_fin_compromiso, $compromiso, $idcompromiso_estado, $idcompromiso_prioridad, $idcompromiso_rc, $idcompromiso_sh, $comentario_compromiso, $idpersona, $idmodulo);\n        break;\n    case \"eliminar_compromiso_stakeholder\":eliminar_compromiso_stakeholder($idcompromiso, $idmodulo_compromiso);\n        break;\n    case \"ver_calificacion_stakeholder\":ver_calificacion_stakeholder($idpersona, $idmodulo, $idusu_c, $idmodulo_c);\n        break;\n    case \"mostrar_calificacion_stakeholder\":mostrar_calificacion_stakeholder($idpersona, $idmodulo);\n        break;\n    case \"guardar_calificacion_stakeholder\":guardar_calificacion_stakeholder($idpersona, $idmodulo, $fecha, $dimension, $comentario);\n        break;\n    case \"obtener_calificacion_stakeholder\":obtener_calificacion_stakeholder($idpersona, $idmodulo, $fecha_del, $fecha_al);\n        break;\n    case \"eliminar_calificacion_stakeholder\":eliminar_calificacion_stakeholder($idpersona, $idmodulo, $idsh_dimension, $idmodulo_sh_dimension);\n        break;\n    case \"actualizar_compromiso_stakeholder\":actualizar_compromiso_stakeholder($idcompromiso, $idmodulo_compromiso, $fecha_compromiso, $hora_compromiso, $minuto_compromiso, $fecha_fin_compromiso, $hora_fin_compromiso, $minuto_fin_compromiso, $compromiso, $idcompromiso_estado, $idcompromiso_prioridad, $idcompromiso_rc, $idcompromiso_sh, $idcompromiso_archivo, $comentario_compromiso);\n        break;\n    case \"ver_dimension_matriz\":ver_dimension_matriz();\n        break;\n    case \"refrescar_tag_stakeholder\":refrescar_tag_stakeholder($idpersona, $idmodulo);\n        break;\n    case \"ver_analisis_red\":ver_analisis_red($idpersona, $idmodulo, $rango_fecha);\n        break;\n    case \"actualizar_analisis_red\":actualizar_analisis_red($idpersona, $idmodulo, $rango_fecha);\n        break;\n    case \"ver_item_compromiso\":ver_item_compromiso($idcompromiso, $idmodulo_compromiso);\n        break;\n    case \"ver_cuerpo_compromiso\": ver_cuerpo_compromiso($idpersona, $idmodulo, $inicio);\n        break;\n    case \"descargar\": descargar($programa, $ruta);\n        break;\n    case \"ver_buscar_interaccion\":ver_buscar_interaccion();\n        break;\n    case \"buscar_interaccion\":buscar_interaccion($idinteraccion, $idmodulo_interaccion, $idinteraccion_estado, $prioridades, $tipos, $fecha_del, $fecha_al, $idinteraccion_complejo_tag, $idinteraccion_complejo_rc, $idinteraccion_complejo_sh, $interaccion);\n        break;\n    case \"exportar_interaccion\":exportar_interaccion($idinteraccion_estado, $prioridades, $tipos, $fecha_del, $fecha_al, $idinteraccion_complejo_tag, $idinteraccion_complejo_rc, $idinteraccion_complejo_sh, $interaccion);\n        break;\n    case \"exportar_pdf_interaccion\":exportar_pdf_interaccion($idinteraccion, $idmodulo_interaccion);\n        break;\n    case \"exportar_pdf_compromiso\":exportar_pdf_compromiso($idcompromiso, $idmodulo_compromiso);\n        break;\n    case \"exportar_pdf_organizacion\":exportar_pdf_organizacion($idpersona, $idmodulo);\n        break;\n    case \"ver_buscar_compromiso\":ver_buscar_compromiso();\n        break;\n    case \"buscar_compromiso\":buscar_compromiso($idcompromiso, $idmodulo_compromiso, $idcompromiso_estado, $idcompromiso_prioridad, $fecha_del, $fecha_al, $idinteraccion_complejo_rc, $idinteraccion_complejo_sh, $compromiso);\n        break;\n    case \"exportar_compromiso\":exportar_compromiso($idcompromiso_estado, $idcompromiso_prioridad, $fecha_del, $fecha_al, $idinteraccion_complejo_rc, $idinteraccion_complejo_sh, $compromiso);\n        break;\n    case \"ver_buscar_red\":ver_buscar_red();\n        break;\n\n    case \"ver_cuerpo_reclamo\":echo ver_cuerpo_reclamo($todos, $flag_estado, $limite);\n        break;\n\n    case \"createThumbs\":createThumbs($folder);\n        break;\n\n    case \"ver_buscar_mapa\":ver_buscar_mapa($fid_string, $presenta, $idmapa, $intensidad);\n        break;\n\n    case \"ver_editar_predio_stakeholder\":ver_editar_predio_stakeholder($idpersona, $idmodulo, $idmapa);\n        break;\n\n    case \"guardar_predio_stakeholder\":guardar_predio_stakeholder($idpredio, $idpersona, $idmodulo);\n        break;\n\n    case \"consultar_indentificadores_geograficos\": consultar_indentificadores_geograficos($idtag_compuesto, $tags, $tags_predio);\n        break;\n\n    case \"ver_predio_persona\": ver_predio_persona($idgis_item);\n        break;\n\n    case \"ver_predio_stakolder_complejo\":ver_predio_stakolder_complejo($idpredio, $idmodulo_predio, $nombre);\n        break;\n\n    case \"actualizar_predio_stakeholder\":actualizar_predio_stakeholder($idpredio, $idmodulo_predio, $idpredio_archivo, $comentario_predio, $idpredio_complejo_tag, $orden_complejo_tag);\n        break;\n\n    case \"ver_reporte_predio_entidad\":ver_reporte_predio_entidad($entidad, $identidad, $idmodulo);\n        break;\n\n    case \"ver_predio_entidad\":ver_predio_entidad($fid_string, $intensidad);\n        break;\n    case \"ver_editar_hogar\":ver_editar_hogar($idsh_hogar, $idmodulo_sh_hogar, $idpersona, $idmodulo);\n        break;\n    case \"ver_nuevo_hogar\":ver_nuevo_hogar($idpersona, $idmodulo);\n        break;\n    case \"ver_nuevo_editar_hogar\":ver_nuevo_editar_hogar($idpersona, $idmodulo);\n        break;\n    case \"guardar_hogar\":guardar_hogar($fecha_hogar, $idhogar_complejo_sh, $idpersona, $idmodulo, $comentario_hogar, $idpersona_parentesco);\n        break;\n    case \"eliminar_hogar\":eliminar_hogar($idsh_hogar, $idmodulo_sh_hogar, $idpersona, $idmodulo);\n        break;\n    case \"editar_hogar\":editar_hogar($idsh_hogar, $idmodulo_sh_hogar, $fecha_hogar, $idhogar_complejo_sh, $idpersona, $idmodulo, $comentario_hogar, $idpersona_parentesco);\n        break;\n    default : ver_cuerpo_inicial($idpersona, $idmodulo, $nombre, $modo);\n        break;\n}\n\nfunction eliminar_hogar($idsh_hogar, $idmodulo_sh_hogar, $idpersona, $idmodulo) {\n    $hogar = new ghogar();\n\n    $error = $hogar->eliminar($idsh_hogar, $idmodulo_sh_hogar);\n    if ($error == 0) {\n        $data['success'] = true;\n        $data['mensaje'] = coloca_mensaje(\"elimina_ok\", \" del hogar \");\n        $data['idmodulo'] = $idmodulo;\n        $data['idpersona'] = $idpersona;\n    } else {\n        $data['success'] = false;\n        $data['mensaje'] = coloca_mensaje(\"elimina_error\", \" del hogar \");\n    }\n    echo json_encode($data);\n}\n\nfunction ver_nuevo_editar_hogar($idpersona, $idmodulo) {\n\n    $plantilla = new DmpTemplate(\"../../../plantillas/stakeholder/hogar/nuevo_editar_hogar.html\");\n    $plantilla->reemplaza(\"idpersona\", $idpersona);\n    $plantilla->reemplaza(\"idmodulo\", $idmodulo);\n    $ihogar = new ihogar();\n\n    $ahogar = $ihogar->get_hogar_sh($idpersona, $idmodulo);\n\n    if (sizeof($ahogar[fecha_hogar]) > 0) {\n\n        foreach ($ahogar[fecha_hogar] as $idhogar_complejo => $fecha_hogar) {\n            $cont = 1;\n            $plantilla->iniciaBloque(\"hogar\");\n            $plantilla->reemplazaEnBloque(\"fecha_hogar\", $fecha_hogar, \"hogar\");\n\n            $plantilla->iniciaBloque(\"eliminar_hogar\");\n            $adhogar_complejo = explode(\"---\", $idhogar_complejo);\n            $plantilla->reemplazaEnBloque(\"idsh_hogar\", $adhogar_complejo[0], \"eliminar_hogar\");\n            $plantilla->reemplazaEnBloque(\"idmodulo_sh_hogar\", $adhogar_complejo[1], \"eliminar_hogar\");\n\n            $plantilla->iniciaBloque(\"editar_hogar\");\n            $plantilla->reemplazaEnBloque(\"idsh_hogar\", $adhogar_complejo[0], \"editar_hogar\");\n            $plantilla->reemplazaEnBloque(\"idmodulo_sh_hogar\", $adhogar_complejo[1], \"editar_hogar\");\n\n            foreach ($ahogar[sh][$idhogar_complejo] as $idhogar_sh_complejo => $nombre_sh) {\n\n                $plantilla->iniciaBloque(\"tr_sh_hogar\");\n\n                $plantilla->iniciaBloque(\"td_sh_hogar\");\n\n\n                $plantilla->reemplazaEnBloque(\"sh\", $nombre_sh, \"td_sh_hogar\");\n\n                $idhogar_sh = explode('---', $idhogar_sh_complejo);\n                $plantilla->reemplazaEnBloque(\"idsh\", $idhogar_sh[0], \"td_sh_hogar\");\n                $plantilla->reemplazaEnBloque(\"idmodulo\", $idhogar_sh[1], \"td_sh_hogar\");\n\n                $plantilla->iniciaBloque(\"idhogar_complejo_sh\");\n                $plantilla->reemplazaEnBloque(\"celda_nume_fila_sh\", $cont, \"idhogar_complejo_sh\");\n                $plantilla->reemplazaEnBloque(\"celda_nume_celda_sh\", 1, \"idhogar_complejo_sh\");\n\n\n                $plantilla->reemplazaEnBloque(\"celda_nume_fila_sh\", $cont, \"td_sh_hogar\");\n                $plantilla->reemplazaEnBloque(\"celda_nume_celda_sh\", 1, \"td_sh_hogar\");\n\n                $plantilla->reemplazaEnBloque(\"parentesco\", $ahogar[parentesco][$idhogar_complejo][$idhogar_sh_complejo], \"td_sh_hogar\");\n\n\n\n\n                $cont++;\n            }\n        }\n    }\n\n\n    echo utf8_encode($plantilla->getPlantillaCadena());\n}\n\nfunction editar_hogar($idsh_hogar, $idmodulo_sh_hogar, $fecha_hogar, $idhogar_complejo_sh, $idpersona, $idmodulo, $comentario_hogar, $idpersona_parentesco) {\n    $hogar = new ghogar();\n\n    $error = $hogar->editar($idsh_hogar, $idmodulo_sh_hogar, $fecha_hogar, $comentario_hogar, $idpersona, $idmodulo, $idhogar_complejo_sh, $idpersona_parentesco);\n\n    if ($error == 0) {\n        $data['success'] = true;\n        $data['mensaje'] = coloca_mensaje(\"guarda_ok\", \" del hogar \");\n        $data['idmodulo'] = $idmodulo;\n        $data['idpersona'] = $idpersona;\n    } else {\n        $data['success'] = false;\n        $data['mensaje'] = coloca_mensaje(\"guarda_error\", \" del hogar \");\n    }\n    echo json_encode($data);\n}\n\nfunction guardar_hogar($fecha_hogar, $idhogar_complejo_sh, $idpersona, $idmodulo, $comentario_hogar, $idpersona_parentesco) {\n\n    $hogar = new ghogar();\n\n    $error = $hogar->agregar($fecha_hogar, $comentario_hogar, $idpersona, $idmodulo, $idhogar_complejo_sh, $idpersona_parentesco);\n\n    if ($error == 0) {\n        $data['success'] = true;\n        $data['mensaje'] = coloca_mensaje(\"guarda_ok\", \" del hogar \");\n        $data['idmodulo'] = $idmodulo;\n        $data['idpersona'] = $idpersona;\n    } else {\n        $data['success'] = false;\n        $data['mensaje'] = coloca_mensaje(\"guarda_error\", \" del hogar \");\n    }\n    echo json_encode($data);\n}\n\nfunction ver_editar_hogar($idsh_hogar, $idmodulo_sh_hogar, $idpersona, $idmodulo) {\n    $ihogar = new ihogar();\n    $ahogar = $ihogar->get_hogar($idsh_hogar, $idmodulo_sh_hogar);\n    $ipersona_parentesco = new ipersona_parentesco();\n    $result_persona_parentesco = $ipersona_parentesco->get_persona_parentesco();\n    $n_registros = sizeof($ahogar[fecha_hogar]);\n\n    $plantilla = new DmpTemplate(\"../../../plantillas/stakeholder/hogar/hogar.html\");\n    $plantilla->iniciaBloque(\"editar_hogar\");\n    $plantilla->reemplazaEnBloque(\"idsh_hogar\", $idsh_hogar, \"editar_hogar\");\n    $plantilla->reemplazaEnBloque(\"idmodulo_sh_hogar\", $idmodulo_sh_hogar, \"editar_hogar\");\n\n\n    $plantilla->reemplaza(\"op_hogar_stakeholder\", \"editar_hogar\");\n    //$plantilla->reemplaza(\"idpersona\", $ahogar[idsh]);\n    //$plantilla->reemplaza(\"idmodulo\", $ahogar[idmodulo]);\n    $plantilla->reemplaza(\"idpersona\", $idpersona);\n    $plantilla->reemplaza(\"idmodulo\", $idmodulo);\n    //echo $n_registros;\n    $cont = 0;\n    if ($n_registros >= 1) {\n        foreach ($ahogar[fecha_hogar] as $idhogar_complejo => $fecha_hogar) {\n            $cont = 1;\n\n            $plantilla->reemplaza(\"fecha_hogar\", $fecha_hogar);\n\n            foreach ($ahogar[sh][$idhogar_complejo] as $idhogar_sh_complejo => $nombre_sh) {\n\n                $plantilla->iniciaBloque(\"tr_sh_hogar\");\n\n                //celda_nume_fila_sh\n                $plantilla->reemplazaEnBloque(\"celda_nume_fila_sh\", $cont, \"tr_sh_hogar\");\n                $plantilla->iniciaBloque(\"td_sh_hogar\");\n\n                $plantilla->reemplazaEnBloque(\"celda_nume_fila_sh\", $cont, \"td_sh_hogar\");\n                $plantilla->reemplazaEnBloque(\"celda_nume_celda_sh\", 1, \"td_sh_hogar\");\n                $plantilla->reemplazaEnBloque(\"sh\", $nombre_sh, \"td_sh_hogar\");\n                $idhogar_sh = explode('---', $idhogar_sh_complejo);\n                $plantilla->reemplazaEnBloque(\"idsh\", $idhogar_sh[0], \"td_sh_hogar\");\n                $plantilla->reemplazaEnBloque(\"idmodulo\", $idhogar_sh[1], \"td_sh_hogar\");\n                //echo $ahogar[idsh].\" hogar \".$idhogar_sh[0] .\" /n\";\n                //echo $ahogar[idmodulo].\" hogar \".$idhogar_sh[1] .\" /\";\n                $plantilla->iniciaBloque(\"idhogar_complejo_sh\");\n                $plantilla->reemplazaEnBloque(\"celda_nume_fila_sh\", $cont, \"idhogar_complejo_sh\");\n                $plantilla->reemplazaEnBloque(\"celda_nume_celda_sh\", 1, \"idhogar_complejo_sh\");\n\n                $plantilla->reemplazaEnBloque(\"idhogar_complejo_sh\", $idhogar_sh[0] . \"---\" . $idhogar_sh[1] . \"---1\", \"idhogar_complejo_sh\");\n\n                if ($idhogar_sh[0] . '---' . $idhogar_sh[1] != $ahogar[idsh] . '---' . $ahogar[idmodulo]) {\n                    $plantilla->iniciaBloque(\"eliminar_sh_hogar\");\n                    $plantilla->reemplazaEnBloque(\"celda_nume_fila_sh\", $cont, \"eliminar_sh_hogar\");\n                    $plantilla->reemplazaEnBloque(\"celda_nume_celda_sh\", 1, \"eliminar_sh_hogar\");\n                }\n\n                mysql_data_seek($result_persona_parentesco, 0);\n                while ($fila = mysql_fetch_array($result_persona_parentesco)) {\n\n                    $plantilla->iniciaBloque(\"persona_parentesco\");\n                    $plantilla->reemplazaEnBloque(\"descripcion\", $fila['descripcion'], \"persona_parentesco\");\n                    $plantilla->reemplazaEnBloque(\"idpersona_parentesco\", $fila['idpersona_parentesco'], \"persona_parentesco\");\n\n                    if ($ahogar[idpersona_parentesco][$idhogar_complejo][$idhogar_sh_complejo] == $fila[idpersona_parentesco]) {\n                        $plantilla->reemplazaEnBloque(\"selected\", \"selected\", \"persona_parentesco\");\n                    }\n                }\n\n                $cont++;\n            }\n        }\n        $plantilla->reemplaza(\"nume_fila_hogar_sh\", $cont - 1);\n        $plantilla->reemplaza(\"cant_hogar\", $cont - 1);\n        $plantilla->reemplaza(\"nume_fila_hogar_sh_complejo\", $cont);\n        $plantilla->reemplaza(\"nume_celda_hogar_sh_complejo\", 1);\n    }\n\n    echo utf8_encode($plantilla->getPlantillaCadena());\n}\n\nfunction ver_nuevo_hogar($idpersona, $idmodulo) {\n    $plantilla = new DmpTemplate(\"../../../plantillas/stakeholder/hogar/hogar.html\");\n    $plantilla->reemplaza(\"op_hogar_stakeholder\", \"guardar_hogar\");\n\n    $plantilla->reemplaza(\"idpersona\", $idpersona);\n    $plantilla->reemplaza(\"idmodulo\", $idmodulo);\n    $ipersona = new ipersona();\n    $result_persona = $ipersona->get_persona($idpersona, $idmodulo);\n\n    $ipersona_parentesco = new ipersona_parentesco();\n    $result_persona_parentesco = $ipersona_parentesco->get_persona_parentesco();\n\n    if ($fila = mysql_fetch_array($result_persona)) {\n        $nombre = $fila['nombre'];\n        $apellido_p = $fila['apellido_p'];\n        $apellido_m = $fila['apellido_m'];\n    }\n    $plantilla->reemplaza(\"fecha_hogar\", date('d/m/Y'));\n    $plantilla->reemplaza(\"cant_sh\", 1);\n\n    $plantilla->iniciaBloque(\"tr_sh_hogar\");\n\n    $plantilla->iniciaBloque(\"td_sh_hogar\");\n\n\n    $plantilla->reemplazaEnBloque(\"celda_nume_fila_sh\", 1, \"td_sh_hogar\");\n    $plantilla->reemplazaEnBloque(\"celda_nume_celda_sh\", 1, \"td_sh_hogar\");\n    $plantilla->reemplazaEnBloque(\"sh\", $nombre . \" \" . $apellido_p . \" \" . $apellido_m, \"td_sh_hogar\");\n    $plantilla->reemplazaEnBloque(\"idsh\", $idpersona, \"td_sh_hogar\");\n    $plantilla->reemplazaEnBloque(\"idmodulo\", $idmodulo, \"td_sh_hogar\");\n    $plantilla->iniciaBloque(\"idhogar_complejo_sh\");\n    $plantilla->reemplazaEnBloque(\"idhogar_complejo_sh\", $idpersona . '---' . $idmodulo, \"idhogar_complejo_sh\");\n    $plantilla->reemplazaEnBloque(\"celda_nume_fila_sh\", 1, \"idhogar_complejo_sh\");\n    $plantilla->reemplazaEnBloque(\"celda_nume_celda_sh\", 1, \"idhogar_complejo_sh\");\n\n\n    $plantilla->reemplaza(\"nume_fila_hogar_sh_complejo\", 1);\n    $plantilla->reemplaza(\"nume_celda_hogar_sh_complejo\", 1);\n\n\n    mysql_data_seek($result_persona_parentesco, 0);\n    while ($fila = mysql_fetch_array($result_persona_parentesco)) {\n\n        $plantilla->iniciaBloque(\"persona_parentesco\");\n        $plantilla->reemplazaEnBloque(\"descripcion\", $fila['descripcion'], \"persona_parentesco\");\n        $plantilla->reemplazaEnBloque(\"idpersona_parentesco\", $fila['idpersona_parentesco'], \"persona_parentesco\");\n    }\n\n    $plantilla->reemplaza(\"maximo\", 1);\n\n\n    echo utf8_encode($plantilla->getPlantillaCadena());\n}\n\nfunction actualizar_compromiso_stakeholder($idcompromiso, $idmodulo_compromiso, $fecha_compromiso, $hora_compromiso, $minuto_compromiso, $fecha_fin_compromiso, $hora_fin_compromiso, $minuto_fin_compromiso, $compromiso, $idcompromiso_estado, $idcompromiso_prioridad, $idcompromiso_rc, $idcompromiso_sh, $idcompromiso_archivo, $comentario_compromiso) {\n    //echo \"verrr\".$idcompromiso.\"-\".$idmodulo_compromiso;\n    $gstakeholder = new gstakeholder();\n\n    $error = $gstakeholder->actualizar_compromiso($idcompromiso, $idmodulo_compromiso, $fecha_compromiso, $hora_compromiso, $minuto_compromiso, $fecha_fin_compromiso, $hora_fin_compromiso, $minuto_fin_compromiso, $compromiso, $idcompromiso_estado, $idcompromiso_prioridad, $idcompromiso_rc, $idcompromiso_sh, $idcompromiso_archivo, $comentario_compromiso);\n\n    $aerror = explode(\"---\", $error);\n\n    if ($aerror[2] == 0) {\n        $count = 0;\n        $archivos = array();\n\n        foreach ($_FILES[\"archivos\"][\"error\"] as $key => $error) {\n            if ($error == UPLOAD_ERR_OK) {\n                $tmp_name = $_FILES[\"archivos\"][\"tmp_name\"][$key];\n                $archivo = $_FILES[\"archivos\"][\"name\"][$key];\n\n                $uploadfile = dirname(dirname(dirname(dirname(__FILE__)))) . DIRECTORY_SEPARATOR . \"archivo\" . DIRECTORY_SEPARATOR . $_SESSION['proyecto'] . DIRECTORY_SEPARATOR . \"compromiso\" . DIRECTORY_SEPARATOR . $aerror[0] . '_' . $archivo;\n                $thumbfile = dirname(dirname(dirname(dirname(__FILE__)))) . DIRECTORY_SEPARATOR . \"archivo\" . DIRECTORY_SEPARATOR . $_SESSION['proyecto'] . DIRECTORY_SEPARATOR . \"compromiso\" . DIRECTORY_SEPARATOR . \"thumbnail\" . DIRECTORY_SEPARATOR . $aerror[0] . '_' . $archivo;\n\n                //echo $uploadfile.\" \";\n\n                if (move_uploaded_file($tmp_name, $uploadfile)) {\n                    $archivos[] = $archivo;\n                    $count++;\n                    $thumb = new thumb();\n                    if ($thumb->loadImage($uploadfile)) {\n\n                        $thumb->resize(100, 'height');\n                        $thumb->save($thumbfile);\n                    }\n                }\n            }\n        }\n\n        if ($count > 0) {\n            $gstakeholder->agregar_archivo_compromiso($aerror[0], $aerror[1], $archivos);\n        }\n\n        $data['success'] = true;\n        $data['mensaje'] = coloca_mensaje(\"actualiza_ok\", \" del compromiso \");\n        $data['idcompromiso'] = $idcompromiso;\n        $data['idmodulo_compromiso'] = $idmodulo_compromiso;\n        $data['data'] = utf8_encode(ver_item_compromiso($idcompromiso, $idmodulo_compromiso));\n    } else {\n        $data['success'] = false;\n        $data['mensaje'] = coloca_mensaje(\"actualiza_error\", \" del compromiso \");\n    }\n    $data['op_stakeholder'] = true;\n\n    echo json_encode($data);\n\n    // echo $aerror[0].\" \".$aerror[1];\n    //ver_editar_compromiso_stakeholder($aerror[0],$aerror[1],$idpersona,$idmodulo);\n}\n\nfunction guardar_compromiso_stakeholder($idinteraccion, $idmodulo_interaccion, $fecha_compromiso, $hora_compromiso, $minuto_compromiso, $fecha_fin_compromiso, $hora_fin_compromiso, $minuto_fin_compromiso, $compromiso, $idcompromiso_estado, $idcompromiso_prioridad, $idcompromiso_rc, $idcompromiso_sh, $comentario_compromiso, $idpersona, $idmodulo) {\n    $gstakeholder = new gstakeholder();\n\n    $error = $gstakeholder->agregar_compromiso($idinteraccion, $idmodulo_interaccion, $fecha_compromiso, $hora_compromiso, $minuto_compromiso, $fecha_fin_compromiso, $hora_fin_compromiso, $minuto_fin_compromiso, $compromiso, $idcompromiso_estado, $idcompromiso_prioridad, $idcompromiso_rc, $idcompromiso_sh, $comentario_compromiso, $idpersona, $idmodulo);\n\n    $aerror = explode(\"---\", $error);\n\n    $plantilla = new DmpTemplate(\"../../../plantillas/stakeholder/compromiso/nuevo_compromiso.html\");\n\n    $plantilla->iniciaBloque(\"item_compromiso\");\n    $plantilla->reemplazaEnBloque(\"fecha_compromiso\", $fecha_compromiso, \"item_compromiso\");\n    $plantilla->reemplazaEnBloque(\"compromiso\", $compromiso, \"item_compromiso\");\n    $plantilla->reemplazaEnBloque(\"idcompromiso\", $aerror[0], \"item_compromiso\");\n    $plantilla->reemplazaEnBloque(\"idmodulo_compromiso\", $_SESSION[\"idmodulo\"], \"item_compromiso\");\n\n    // echo $aerror[0].\" \".$aerror[1];\n    //ver_editar_compromiso_stakeholder($aerror[0],$aerror[1],$idpersona,$idmodulo);\n    if ($aerror[2] == 0) {\n\n        $count = 0;\n        $archivos = array();\n\n        foreach ($_FILES[\"archivos\"][\"error\"] as $key => $error) {\n            if ($error == UPLOAD_ERR_OK) {\n                $tmp_name = $_FILES[\"archivos\"][\"tmp_name\"][$key];\n                $archivo = $_FILES[\"archivos\"][\"name\"][$key];\n\n                $uploadfile = dirname(dirname(dirname(dirname(__FILE__)))) . DIRECTORY_SEPARATOR . \"archivo\" . DIRECTORY_SEPARATOR . $_SESSION['proyecto'] . DIRECTORY_SEPARATOR . \"compromiso\" . DIRECTORY_SEPARATOR . $aerror[0] . '_' . $archivo;\n                $thumbfile = dirname(dirname(dirname(dirname(__FILE__)))) . DIRECTORY_SEPARATOR . \"archivo\" . DIRECTORY_SEPARATOR . $_SESSION['proyecto'] . DIRECTORY_SEPARATOR . \"compromiso\" . DIRECTORY_SEPARATOR . \"thumbnail\" . DIRECTORY_SEPARATOR . $aerror[0] . '_' . $archivo;\n\n                //echo $uploadfile.\" \";\n\n                if (move_uploaded_file($tmp_name, $uploadfile)) {\n                    $archivos[] = $archivo;\n                    $count++;\n                    $thumb = new thumb();\n                    if ($thumb->loadImage($uploadfile)) {\n\n                        $thumb->resize(100, 'height');\n                        $thumb->save($thumbfile);\n                    }\n                }\n            }\n        }\n\n        if ($count > 0) {\n            $gstakeholder->agregar_archivo_compromiso($aerror[0], $aerror[1], $archivos);\n        }\n\n        $data['success'] = true;\n        $data['mensaje'] = coloca_mensaje(\"guarda_ok\", \" del compromiso \");\n        $data['idinteraccion'] = $idinteraccion;\n        $data['idmodulo_interaccion'] = $idmodulo_interaccion;\n        $data['html'] = utf8_encode($plantilla->getPlantillaCadena());\n    } else {\n        $data['success'] = false;\n        $data['mensaje'] = coloca_mensaje(\"guarda_error\", \" del compromiso \");\n    }\n    $data['op_stakeholder'] = false;\n\n    echo json_encode($data);\n}\n\nfunction eliminar_compromiso_stakeholder($idcompromiso, $idmodulo_compromiso) {\n    $gstakeholder = new gstakeholder();\n    $respuesta = $gstakeholder->eliminar_compromiso($idcompromiso, $idmodulo_compromiso);\n    if ($respuesta == 0) {\n        $data['success'] = true;\n        $data['mensaje'] = coloca_mensaje(\"elimina_ok\", \" del compromiso \");\n    } else {\n        $data['success'] = fale;\n        $data['mensaje'] = coloca_mensaje(\"elimina_error\", \" del compromiso \");\n    }\n    echo json_encode($data);\n}\n\nfunction mostrar_calificacion_stakeholder($idpersona, $idmodulo) {\n    echo ver_calificacion_stakeholder($idpersona, $idmodulo);\n}\n\nfunction ver_calificacion_stakeholder($idpersona, $idmodulo, $idusu_c, $idmodulo_c) {\n    $seguridad = new Seguridad();\n\n    $plantilla = new DmpTemplate(\"../../../plantillas/stakeholder/calificacion/ver_calificacion_stakeholder.html\");\n\n    $idimension_matriz_sh = new idimension_matriz_sh();\n\n    $result = $idimension_matriz_sh->lista_dimension_matriz_sh($idpersona, $idmodulo);\n    $votos = array();\n    $count = 0;\n    while ($fila1 = mysql_fetch_array($result)) {\n        $count++;\n        $votos[$fila1[iddimension_matriz_sh]] = $fila1;\n    }\n\n    if ($count > 0 && $seguridad->verifica_permiso(\"Ver\", \"Stakeholder-Calificacion\")) {\n        $plantilla->iniciaBloque(\"tr_calificacion\");\n        $plantilla->reemplazaEnBloque(\"posicion\", ruta_images . $votos[1][valor], \"tr_calificacion\");\n        $plantilla->reemplazaEnBloque(\"idpersona\", $idpersona, \"tr_calificacion\");\n        $plantilla->reemplazaEnBloque(\"idmodulo\", $idmodulo, \"tr_calificacion\");\n        $plantilla->reemplazaEnBloque(\"comentario\", $votos[1][comentario], \"tr_calificacion\");\n\n        $plantilla->iniciaBloque(\"tr_dimension\");\n        $plantilla->reemplazaEnBloque(\"dimension\", $votos[2][dimension], \"tr_dimension\");\n        $plantilla->reemplazaEnBloque(\"valor\", ruta_images . $votos[2][valor], \"tr_dimension\");\n        $plantilla->reemplazaEnBloque(\"comentario\", $votos[2][comentario], \"tr_dimension\");\n\n        $plantilla->iniciaBloque(\"tr_dimension\");\n        $plantilla->reemplazaEnBloque(\"dimension\", $votos[3][dimension], \"tr_dimension\");\n        $plantilla->reemplazaEnBloque(\"valor\", ruta_images . $votos[3][valor], \"tr_dimension\");\n        $plantilla->reemplazaEnBloque(\"comentario\", $votos[3][comentario], \"tr_dimension\");\n    } else {\n        $plantilla->iniciaBloque(\"tr_calificacion\");\n        $plantilla->reemplazaEnBloque(\"posicion\", ruta_images . \"00.png\", \"tr_calificacion\");\n        $plantilla->reemplazaEnBloque(\"idpersona\", $idpersona, \"tr_calificacion\");\n        $plantilla->reemplazaEnBloque(\"idmodulo\", $idmodulo, \"tr_calificacion\");\n\n\n        $plantilla->iniciaBloque(\"tr_dimension\");\n        $plantilla->reemplazaEnBloque(\"dimension\", \"Poder\", \"tr_dimension\");\n        $plantilla->reemplazaEnBloque(\"valor\", ruta_images . \"0.png\", \"tr_dimension\");\n\n        $plantilla->iniciaBloque(\"tr_dimension\");\n        $plantilla->reemplazaEnBloque(\"dimension\", \"Interes\", \"tr_dimension\");\n        $plantilla->reemplazaEnBloque(\"valor\", ruta_images . \"0.png\", \"tr_dimension\");\n    }\n\n    if ($seguridad->verifica_permiso(\"Crear\", \"Stakeholder-Calificacion\")) {\n        $plantilla->iniciaBloque(\"crear_calificacion_sh\");\n        $plantilla->reemplazaEnBloque(\"idpersona\", $idpersona, \"crear_calificacion_sh\");\n        $plantilla->reemplazaEnBloque(\"idmodulo\", $idmodulo, \"crear_calificacion_sh\");\n    }\n\n    if ($seguridad->verifica_permiso(\"Eliminar\", \"Stakeholder-Calificacion\")) {\n        $plantilla->iniciaBloque(\"eliminar_calificacion_sh\");\n        $plantilla->reemplazaEnBloque(\"idpersona\", $idpersona, \"eliminar_calificacion_sh\");\n        $plantilla->reemplazaEnBloque(\"idmodulo\", $idmodulo, \"eliminar_calificacion_sh\");\n    }\n\n    return $plantilla->getPlantillaCadena();\n}\n\nfunction ver_editar_compromiso_stakeholder($idcompromiso, $idmodulo_compromiso, $idpersona = \"\", $idmodulo = \"\") {\n\n    $plantilla = new DmpTemplate(\"../../../plantillas/stakeholder/compromiso/compromiso.html\");\n\n    $plantilla_interaccion = new DmpTemplate(\"../../../plantillas/stakeholder/interaccion/vista_interaccion.html\");\n\n    $plantilla->reemplaza(\"op_stakeholder\", \"actualizar_compromiso_stakeholder\");\n    $compromiso_estado = new icompromiso_estado();\n    $oicompromiso = new icompromiso();\n    $acompromiso = $oicompromiso->get_compromiso($idcompromiso, $idmodulo_compromiso);\n    $result = $compromiso_estado->lista_compromiso_estado();\n\n    $plantilla_interaccion->reemplaza(\"interaccion\", $acompromiso['interaccion']);\n    $plantilla_interaccion->reemplaza(\"fecha_interaccion\", date(\"d/m/Y\", strtotime($acompromiso['fecha_interaccion'])));\n\n    $plantilla->reemplaza(\"contenido_interaccion\", $plantilla_interaccion->getPlantillaCadena());\n    ///echo $acompromiso['compromiso'][$idcompromiso.\"-\".$idmodulo_compromiso];\n    $plantilla->reemplaza(\"idcompromiso\", $idcompromiso);\n    $plantilla->reemplaza(\"idmodulo_compromiso\", $idmodulo_compromiso);\n\n    $plantilla->reemplaza(\"compromiso\", $acompromiso['compromiso'][$idcompromiso . \"-\" . $idmodulo_compromiso]);\n\n    $plantilla->reemplaza(\"compromiso_comentario\", $acompromiso['comentario'][$idcompromiso . \"-\" . $idmodulo_compromiso]);\n\n    while ($fila = mysql_fetch_array($result)) {\n        $plantilla->iniciaBloque(\"compromiso_estado\");\n        $plantilla->reemplazaEnBloque(\"compromiso_estado\", $fila[compromiso_estado], \"compromiso_estado\");\n        $plantilla->reemplazaEnBloque(\"idcompromiso_estado\", $fila[idcompromiso_estado], \"compromiso_estado\");\n        if ($acompromiso['idcompromiso_estado'][$idcompromiso . \"-\" . $idmodulo_compromiso] == $fila[idcompromiso_estado]) {\n            $plantilla->reemplazaEnBloque(\"selected\", \"selected\", \"compromiso_estado\");\n        }\n    }\n\n    $compromiso_prioridad = new icompromiso_prioridad();\n    $result = $compromiso_prioridad->lista_compromiso_prioridad();\n\n    while ($fila = mysql_fetch_array($result)) {\n        $plantilla->iniciaBloque(\"compromiso_prioridad\");\n        $plantilla->reemplazaEnBloque(\"compromiso_prioridad\", $fila[compromiso_prioridad], \"compromiso_prioridad\");\n        $plantilla->reemplazaEnBloque(\"idcompromiso_prioridad\", $fila[idcompromiso_prioridad], \"compromiso_prioridad\");\n        if ($acompromiso['idcompromiso_prioridad'][$idcompromiso . \"-\" . $idmodulo_compromiso] == $fila[idcompromiso_prioridad]) {\n\n            $plantilla->reemplazaEnBloque(\"selected\", \"selected\", \"compromiso_prioridad\");\n        }\n    }\n    $plantilla->reemplaza(\"fecha_compromiso\", $acompromiso['fecha'][$idcompromiso . \"-\" . $idmodulo_compromiso]);\n\n    if ($acompromiso['fecha_fin'][$idcompromiso . \"-\" . $idmodulo_compromiso] != \"00/00/0000\")\n        $plantilla->reemplaza(\"fecha_fin_compromiso\", $acompromiso['fecha_fin'][$idcompromiso . \"-\" . $idmodulo_compromiso]);\n\n    for ($h = 0; $h < 24; $h++) {\n        $plantilla->iniciaBloque(\"hora_compromiso\");\n        $hora = \"\";\n        if ($h > 9) {\n            $hora.=$h;\n        } else {\n            $hora.= \"0\" . $h;\n        }\n        $plantilla->reemplazaEnBloque(\"hora\", $hora, \"hora_compromiso\");\n        if ($hora == $acompromiso['hora'][$idcompromiso . \"-\" . $idmodulo_compromiso]) {\n            $plantilla->reemplazaEnBloque(\"selected\", \"selected\", \"hora_compromiso\");\n        }\n\n        $hora_fin = \"\";\n        $plantilla->iniciaBloque(\"hora_fin_compromiso\");\n        if ($h > 9) {\n            $hora_fin.=$h;\n        } else {\n            $hora_fin.=\"0\" . $h;\n        }\n        $plantilla->reemplazaEnBloque(\"hora\", $hora_fin, \"hora_fin_compromiso\");\n        if ($hora_fin == $acompromiso['hora_fin'][$idcompromiso . \"-\" . $idmodulo_compromiso]) {\n            $plantilla->reemplazaEnBloque(\"selected\", \"selected\", \"hora_fin_compromiso\");\n        }\n    }\n    for ($m = 0; $m < 6; $m++) {\n        $plantilla->iniciaBloque(\"minuto_compromiso\");\n        if ($m * 10 > 9) {\n            $plantilla->reemplazaEnBloque(\"minuto\", ($m * 10), \"minuto_compromiso\");\n        } else {\n            $plantilla->reemplazaEnBloque(\"minuto\", \"0\" . ($m * 10), \"minuto_compromiso\");\n        }\n        if (($m * 10) == $acompromiso['minuto'][$idcompromiso . \"-\" . $idmodulo_compromiso]) {\n            $plantilla->reemplazaEnBloque(\"selected\", \"selected\", \"minuto_compromiso\");\n        }\n\n        $plantilla->iniciaBloque(\"minuto_fin_compromiso\");\n        if ($m * 10 > 9) {\n            $plantilla->reemplazaEnBloque(\"minuto\", ($m * 10), \"minuto_fin_compromiso\");\n        } else {\n            $plantilla->reemplazaEnBloque(\"minuto\", \"0\" . ($m * 10), \"minuto_fin_compromiso\");\n        }\n        if (($m * 10) == $acompromiso['minuto_fin'][$idcompromiso . \"-\" . $idmodulo_compromiso]) {\n            $plantilla->reemplazaEnBloque(\"selected\", \"selected\", \"minuto_fin_compromiso\");\n        }\n    }\n    ###########################################################\n    //RC\n    $cont_rc_fila = 0;\n    $cont_rc = 0;\n    if (sizeof($acompromiso['rc'][$idcompromiso . \"-\" . $idmodulo_compromiso] > 0)) {\n\n        foreach ($acompromiso['rc'][$idcompromiso . \"-\" . $idmodulo_compromiso] as $key => $rc) {\n            if ($cont_rc % 5 == 0) {\n                $plantilla->iniciaBloque(\"tr_rc_compromiso\");\n                $cont_rc_fila++;\n                $cont_rc_celda = 0;\n            }\n\n\n            $plantilla->iniciaBloque(\"td_rc_compromiso\");\n            $plantilla->reemplazaEnBloque(\"rc\", $rc, \"td_rc_compromiso\");\n            $plantilla->reemplazaEnBloque(\"celda_nume_fila_rc\", $cont_rc_fila, \"td_rc_compromiso\");\n            $plantilla->reemplazaEnBloque(\"celda_nume_celda_rc\", $cont_rc_celda, \"td_rc_compromiso\");\n\n            $plantilla->iniciaBloque(\"idcompromiso_complejo_rc\");\n\n            $plantilla->reemplazaEnBloque(\"idcompromiso_complejo_rc\", $acompromiso['idcompromiso_rc'][$idcompromiso . \"-\" . $idmodulo_compromiso][$key] . \"***\" . $acompromiso['idmodulo_compromiso_rc'][$idcompromiso . \"-\" . $idmodulo_compromiso][$key] . \"***1\", \"idcompromiso_complejo_rc\");\n            $plantilla->reemplazaEnBloque(\"celda_nume_fila_rc\", $cont_rc_fila, \"idcompromiso_complejo_rc\");\n            $plantilla->reemplazaEnBloque(\"celda_nume_celda_rc\", $cont_rc_celda, \"idcompromiso_complejo_rc\");\n\n            //if ($_SESSION[idusu] . \"-\" . $_SESSION[idmodulo_a] != $acompromiso['idrc'][$idcompromiso . \"-\" . $idmodulo_compromiso][$key] . \"-\" . $acompromiso['rc_idmodulo'][$idcompromiso . \"-\" . $idmodulo_compromiso][$key]) {\n            $plantilla->iniciaBloque(\"eliminar_rc_compromiso\");\n            $plantilla->reemplazaEnBloque(\"celda_nume_fila_rc\", $cont_rc_fila, \"eliminar_rc_compromiso\");\n            $plantilla->reemplazaEnBloque(\"celda_nume_celda_rc\", $cont_rc_celda, \"eliminar_rc_compromiso\");\n            //}\n\n            $cont_rc_celda++;\n            $cont_rc++;\n        }\n    }\n\n    $plantilla->reemplaza(\"cant_rc\", $cont_rc);\n\n    ////antes coloco el numero real de celdas y filas\n    $plantilla->reemplaza(\"nume_fila_compromiso_rc\", $cont_rc_fila);\n    $plantilla->reemplaza(\"nume_celda_compromiso_rc\", $cont_rc_celda);\n\n    ///\n    while ($cont_rc_celda < 5) {\n        $plantilla->iniciaBloque(\"td_rc_compromiso\");\n        $plantilla->reemplazaEnBloque(\"rc\", \"&nbsp;\", \"td_rc_compromiso\");\n        $plantilla->reemplazaEnBloque(\"celda_nume_fila_rc\", $cont_rc_fila, \"td_rc_compromiso\");\n        $plantilla->reemplazaEnBloque(\"celda_nume_celda_rc\", $cont_rc_celda, \"td_rc_compromiso\");\n\n        $cont_rc_celda++;\n    }\n    //sh\n    $cont_sh = 0;\n    $cont_sh_fila = 0;\n\n    if (sizeof($acompromiso['sh'][$idcompromiso . \"-\" . $idmodulo_compromiso] > 0)) {\n\n        foreach ($acompromiso['sh'][$idcompromiso . \"-\" . $idmodulo_compromiso] as $key => $sh) {\n\n            if ($cont_sh % 5 == 0) {\n                $plantilla->iniciaBloque(\"tr_sh_compromiso\");\n                $cont_sh_fila++;\n                $cont_sh_celda = 0;\n            }\n\n\n            $plantilla->iniciaBloque(\"td_sh_compromiso\");\n            $plantilla->reemplazaEnBloque(\"sh\", $sh, \"td_sh_compromiso\");\n            $plantilla->reemplazaEnBloque(\"celda_nume_fila_sh\", $cont_sh_fila, \"td_sh_compromiso\");\n            $plantilla->reemplazaEnBloque(\"celda_nume_celda_sh\", $cont_sh_celda, \"td_sh_compromiso\");\n\n            $plantilla->iniciaBloque(\"idcompromiso_complejo_sh\");\n\n            $plantilla->reemplazaEnBloque(\"idcompromiso_complejo_sh\", $acompromiso['idcompromiso_sh'][$idcompromiso . \"-\" . $idmodulo_compromiso][$key] . \"***\" . $acompromiso['idmodulo_compromiso_sh'][$idcompromiso . \"-\" . $idmodulo_compromiso][$key] . \"***1\", \"idcompromiso_complejo_sh\");\n            $plantilla->reemplazaEnBloque(\"celda_nume_fila_sh\", $cont_sh_fila, \"idcompromiso_complejo_sh\");\n            $plantilla->reemplazaEnBloque(\"celda_nume_celda_sh\", $cont_sh_celda, \"idcompromiso_complejo_sh\");\n\n            if ($idpersona . \"-\" . $idmodulo != $acompromiso['idsh'][$idcompromiso . \"-\" . $idmodulo_compromiso][$key] . \"-\" . $acompromiso['sh_idmodulo'][$idcompromiso . \"-\" . $idmodulo_compromiso][$key]) {\n                $plantilla->iniciaBloque(\"eliminar_sh_compromiso\");\n                $plantilla->reemplazaEnBloque(\"celda_nume_fila_sh\", $cont_sh_fila, \"eliminar_sh_compromiso\");\n                $plantilla->reemplazaEnBloque(\"celda_nume_celda_sh\", $cont_sh_celda, \"eliminar_sh_compromiso\");\n            }\n\n            $cont_sh_celda++;\n            $cont_sh++;\n        }\n    }\n\n    $plantilla->reemplaza(\"cant_sh\", $cont_sh);\n\n    $plantilla->reemplaza(\"nume_fila_compromiso_sh\", $cont_sh_fila);\n    $plantilla->reemplaza(\"nume_celda_compromiso_sh\", $cont_sh_celda);\n\n    ///\n    while ($cont_sh_celda < 5) {\n        $plantilla->iniciaBloque(\"td_sh_compromiso\");\n        $plantilla->reemplazaEnBloque(\"sh\", \"&nbsp;\", \"td_sh_compromiso\");\n        $plantilla->reemplazaEnBloque(\"celda_nume_fila_sh\", $cont_sh_fila, \"td_sh_compromiso\");\n        $plantilla->reemplazaEnBloque(\"celda_nume_celda_sh\", $cont_sh_celda, \"td_sh_compromiso\");\n\n        $cont_sh_celda++;\n    }\n\n    //documento\n\n    $result = $oicompromiso->lista_archivo($idcompromiso, $idmodulo_compromiso);\n\n    while ($fila = mysql_fetch_array($result)) {\n        $plantilla->iniciaBloque(\"archivo\");\n        $plantilla->reemplazaEnBloque(\"idcompromiso_archivo\", $fila[idcompromiso_archivo], \"archivo\");\n        $plantilla->reemplazaEnBloque(\"idmodulo_compromiso_archivo\", $fila[idmodulo_compromiso_archivo], \"archivo\");\n        $plantilla->reemplazaEnBloque(\"archivo\", $fila[archivo], \"archivo\");\n        $plantilla->reemplazaEnBloque(\"activo\", $fila[activo], \"archivo\");\n        $plantilla->reemplazaEnBloque(\"ruta\", $idcompromiso . '_' . $fila[archivo], \"archivo\");\n        $plantilla->reemplazaEnBloque(\"fecha\", date(\"d/m/Y\", strtotime($fila[fecha_c])), \"archivo\");\n    }\n\n\n    $plantilla->reemplaza(\"idmodulo_interaccion_compromiso\", \"$idmodulo_interaccion\");\n\n    $plantilla->reemplaza(\"idinteraccion_compromiso\", \"$idinteraccion\");\n\n\n    $plantilla->presentaPlantilla();\n\n    ###########################################################\n}\n\nfunction ver_compromiso_stakeholder($idpersona, $idmodulo, $idinteraccion = \"\", $idmodulo_interaccion = \"\", $idcompromiso = \"\", $idmodulo_compromiso = \"\") {\n\n    $plantilla = new DmpTemplate(\"../../../plantillas/stakeholder/compromiso/compromiso.html\");\n    $plantilla->reemplaza(\"fecha_compromiso\", date('d/m/Y'));\n    $plantilla->reemplaza(\"op_stakeholder\", \"guardar_compromiso_stakeholder\");\n    $compromiso_estado = new icompromiso_estado();\n    $result = $compromiso_estado->lista_compromiso_estado();\n\n    while ($fila = mysql_fetch_array($result)) {\n        $plantilla->iniciaBloque(\"compromiso_estado\");\n        $plantilla->reemplazaEnBloque(\"compromiso_estado\", $fila[compromiso_estado], \"compromiso_estado\");\n        $plantilla->reemplazaEnBloque(\"idcompromiso_estado\", $fila[idcompromiso_estado], \"compromiso_estado\");\n    }\n\n    $max_upload = (int) (ini_get('upload_max_filesize'));\n    $max_post = (int) (ini_get('post_max_size'));\n    $memory_limit = (int) (ini_get('memory_limit'));\n    $upload_mb = min($max_upload, $max_post, $memory_limit);\n\n    $plantilla->reemplaza(\"maximo\", $upload_mb);\n\n\n    $compromiso_prioridad = new icompromiso_prioridad();\n    $result = $compromiso_prioridad->lista_compromiso_prioridad();\n\n    while ($fila = mysql_fetch_array($result)) {\n        $plantilla->iniciaBloque(\"compromiso_prioridad\");\n        $plantilla->reemplazaEnBloque(\"compromiso_prioridad\", $fila[compromiso_prioridad], \"compromiso_prioridad\");\n        $plantilla->reemplazaEnBloque(\"idcompromiso_prioridad\", $fila[idcompromiso_prioridad], \"compromiso_prioridad\");\n    }\n\n    for ($h = 0; $h < 24; $h++) {\n        $plantilla->iniciaBloque(\"hora_compromiso\");\n        if ($h > 9) {\n            $plantilla->reemplazaEnBloque(\"hora\", $h, \"hora_compromiso\");\n        } else {\n            $plantilla->reemplazaEnBloque(\"hora\", \"0\" . $h, \"hora_compromiso\");\n        }\n        $plantilla->iniciaBloque(\"hora_fin_compromiso\");\n        if ($h > 9) {\n            $plantilla->reemplazaEnBloque(\"hora\", $h, \"hora_fin_compromiso\");\n        } else {\n            $plantilla->reemplazaEnBloque(\"hora\", \"0\" . $h, \"hora_fin_compromiso\");\n        }\n    }\n    for ($m = 0; $m < 6; $m++) {\n        $plantilla->iniciaBloque(\"minuto_compromiso\");\n        if ($m * 10 > 9) {\n            $plantilla->reemplazaEnBloque(\"minuto\", ($m * 10), \"minuto_compromiso\");\n        } else {\n            $plantilla->reemplazaEnBloque(\"minuto\", \"0\" . ($m * 10), \"minuto_compromiso\");\n        }\n        $plantilla->iniciaBloque(\"minuto_fin_compromiso\");\n        if ($m * 10 > 9) {\n            $plantilla->reemplazaEnBloque(\"minuto\", ($m * 10), \"minuto_fin_compromiso\");\n        } else {\n            $plantilla->reemplazaEnBloque(\"minuto\", \"0\" . ($m * 10), \"minuto_fin_compromiso\");\n        }\n    }\n\n    //rc\n    $ointeraccion = new iinteraccion();\n    $result_rc = $ointeraccion->lista_interaccion_rc($idinteraccion, $idmodulo_interaccion);\n    $cont_rc = 0;\n    $cont_rc_fila = 0;\n\n    while (!!$fila_rc = mysql_fetch_array($result_rc)) {\n        if ($cont_rc % 5 == 0) {\n            $plantilla->iniciaBloque(\"tr_rc_compromiso\");\n            $cont_rc_fila++;\n            $cont_rc_celda = 0;\n        }\n\n        $plantilla->iniciaBloque(\"td_rc_compromiso\");\n        $plantilla->reemplazaEnBloque(\"rc\", utf8_encode($fila_rc[nombre] . \" \" . $fila_rc[apellido_p] . \" \" . $fila_rc[apellido_m]), \"td_rc_compromiso\");\n        $plantilla->reemplazaEnBloque(\"celda_nume_fila_rc\", $cont_rc_fila, \"td_rc_compromiso\");\n        $plantilla->reemplazaEnBloque(\"celda_nume_celda_rc\", $cont_rc_celda, \"td_rc_compromiso\");\n\n        $plantilla->iniciaBloque(\"idcompromiso_complejo_rc\");\n\n        $plantilla->reemplazaEnBloque(\"idcompromiso_complejo_rc\", $fila_rc[idpersona] . \"---\" . $fila_rc[idmodulo], \"idcompromiso_complejo_rc\");\n        $plantilla->reemplazaEnBloque(\"celda_nume_fila_rc\", $cont_rc_fila, \"idcompromiso_complejo_rc\");\n        $plantilla->reemplazaEnBloque(\"celda_nume_celda_rc\", $cont_rc_celda, \"idcompromiso_complejo_rc\");\n\n        //if ($_SESSION[idusu] . \"-\" . $_SESSION[idmodulo_a] != $fila_rc[idpersona] . \"-\" . $fila_rc[idmodulo]) {\n        $plantilla->iniciaBloque(\"eliminar_rc_compromiso\");\n        $plantilla->reemplazaEnBloque(\"celda_nume_fila_rc\", $cont_rc_fila, \"eliminar_rc_compromiso\");\n        $plantilla->reemplazaEnBloque(\"celda_nume_celda_rc\", $cont_rc_celda, \"eliminar_rc_compromiso\");\n        //}\n        $cont_rc++;\n        $cont_rc_celda++;\n    }\n\n    $plantilla->reemplaza(\"cant_rc\", $cont_rc);\n    ////antes coloco el numero real de celdas y filas\n    $plantilla->reemplaza(\"nume_fila_compromiso_rc\", $cont_rc_fila);\n    $plantilla->reemplaza(\"nume_celda_compromiso_rc\", $cont_rc_celda);\n\n    ///\n    while ($cont_rc_celda < 5) {\n        $plantilla->iniciaBloque(\"td_rc_compromiso\");\n        $plantilla->reemplazaEnBloque(\"rc\", \"&nbsp;\", \"td_rc_compromiso\");\n        $plantilla->reemplazaEnBloque(\"celda_nume_fila_rc\", $cont_rc_fila, \"td_rc_compromiso\");\n        $plantilla->reemplazaEnBloque(\"celda_nume_celda_rc\", $cont_rc_celda, \"td_rc_compromiso\");\n\n        $cont_rc_celda++;\n    }\n\n\n    //sh\n    $resulta_sh = $ointeraccion->lista_interaccion_sh($idinteraccion, $idmodulo_interaccion);\n    $cont_sh = 0;\n    $cont_sh_fila = 0;\n    while (!!$fila_sh = mysql_fetch_array($resulta_sh)) {\n        if ($cont_sh % 5 == 0) {\n            $plantilla->iniciaBloque(\"tr_sh_compromiso\");\n            $cont_sh_fila++;\n            $cont_sh_celda = 0;\n        }\n        $plantilla->iniciaBloque(\"td_sh_compromiso\");\n        $plantilla->reemplazaEnBloque(\"sh\", utf8_encode($fila_sh[nombre] . \" \" . $fila_sh[apellido_p] . \" \" . $fila_sh[apellido_m]), \"td_sh_compromiso\");\n        $plantilla->reemplazaEnBloque(\"celda_nume_fila_sh\", $cont_sh_fila, \"td_sh_compromiso\");\n        $plantilla->reemplazaEnBloque(\"celda_nume_celda_sh\", $cont_sh_celda, \"td_sh_compromiso\");\n\n        $plantilla->iniciaBloque(\"idcompromiso_complejo_sh\");\n        $plantilla->reemplazaEnBloque(\"idcompromiso_complejo_sh\", $fila_sh[idpersona] . \"---\" . $fila_sh[idmodulo], \"idcompromiso_complejo_sh\");\n        $plantilla->reemplazaEnBloque(\"celda_nume_fila_sh\", $cont_sh_fila, \"idcompromiso_complejo_sh\");\n        $plantilla->reemplazaEnBloque(\"celda_nume_celda_sh\", $cont_sh_celda, \"idcompromiso_complejo_sh\");\n\n\n        //if ($idpersona . \"-\" . $idmodulo != $fila_sh[idpersona] . \"-\" . $fila_sh[idmodulo]) {\n        $plantilla->iniciaBloque(\"eliminar_sh_compromiso\");\n        //***1 el estado activo, al cambiar a 0, el estado desactivo\n\n        $plantilla->reemplazaEnBloque(\"celda_nume_fila_sh\", $cont_sh_fila, \"eliminar_sh_compromiso\");\n        $plantilla->reemplazaEnBloque(\"celda_nume_celda_sh\", $cont_sh_celda, \"eliminar_sh_compromiso\");\n        //}\n        $cont_sh++;\n        $cont_sh_celda++;\n    }\n\n    $plantilla->reemplaza(\"cant_sh\", $cont_sh);\n\n    $plantilla->reemplaza(\"nume_fila_compromiso_sh\", $cont_sh_fila);\n    $plantilla->reemplaza(\"nume_celda_compromiso_sh\", $cont_sh_celda);\n\n    $max_upload = (int) (ini_get('upload_max_filesize'));\n    $max_post = (int) (ini_get('post_max_size'));\n    $memory_limit = (int) (ini_get('memory_limit'));\n    $upload_mb = min($max_upload, $max_post, $memory_limit);\n\n    $plantilla->reemplaza(\"maximo\", $upload_mb);\n\n    ///\n    while ($cont_sh_celda < 5) {\n        $plantilla->iniciaBloque(\"td_sh_compromiso\");\n        $plantilla->reemplazaEnBloque(\"rc\", \"&nbsp;\", \"td_sh_compromiso\");\n        $plantilla->reemplazaEnBloque(\"celda_nume_fila_sh\", $cont_sh_fila, \"td_sh_compromiso\");\n        $plantilla->reemplazaEnBloque(\"celda_nume_celda_sh\", $cont_sh_celda, \"td_sh_compromiso\");\n\n        $cont_sh_celda++;\n    }\n    $plantilla->reemplaza(\"idmodulo_interaccion_compromiso\", \"$idmodulo_interaccion\");\n\n    $plantilla->reemplaza(\"idinteraccion_compromiso\", \"$idinteraccion\");\n\n\n    $plantilla->presentaPlantilla();\n}\n\nfunction eliminar_interaccion_stakeholder($idinteraccion, $idmodulo_interaccion) {\n    $gstakeholder = new gstakeholder();\n    $respuesta = $gstakeholder->eliminar_interaccion($idinteraccion, $idmodulo_interaccion);\n\n    if ($respuesta[0] == 0) {\n        if ($respuesta[1] == 0) {\n            $data['success'] = true;\n            $data['mensaje'] = coloca_mensaje(\"elimina_ok\", \" de la interaccion \");\n        } else {\n            $data['success'] = false;\n            $data['mensaje'] = \"No se puede eliminar la interaccion porque tiene compromisos\";\n        }\n    } else {\n        $data['success'] = false;\n        $data['mensaje'] = coloca_mensaje(\"elimina_error\", \" de la interaccion \");\n    }\n\n    echo json_encode($data);\n}\n\nfunction createThumbs($folder) {\n\n    $pathToImages = dirname(dirname(dirname(dirname(__FILE__)))) . DIRECTORY_SEPARATOR . \"archivo\" . DIRECTORY_SEPARATOR . $_SESSION['proyecto'] . DIRECTORY_SEPARATOR . $folder . DIRECTORY_SEPARATOR;\n    // open the directory\n    $dir = opendir($pathToImages);\n\n    // loop through it, looking for any/all JPG files:\n    while (false !== ($fname = readdir($dir))) {\n        // parse path for the extension\n        $thumb = new thumb();\n\n        // continue only if this is a JPEG image\n        if ($thumb->loadImage($pathToImages . $fname)) {\n            echo \"Creating thumbnail for {$fname} <br />\";\n            $thumbfile = $pathToImages . \"thumbnail\" . DIRECTORY_SEPARATOR . $fname;\n            $thumb->resize(100, 'height');\n            $thumb->save($thumbfile);\n        }\n    }\n    // close the directory\n    closedir($dir);\n}\n\nfunction ver_predio_stakolder_complejo($idpredio, $idmodulo_predio, $nombre) {\n\n    $plantilla = new DmpTemplate(\"../../../plantillas/stakeholder/stakeholder/predio_complejo.html\");\n\n    $max_upload = (int) (ini_get('upload_max_filesize'));\n    $max_post = (int) (ini_get('post_max_size'));\n    $memory_limit = (int) (ini_get('memory_limit'));\n    $upload_mb = min($max_upload, $max_post, $memory_limit);\n\n    $plantilla->reemplaza(\"maximo\", $upload_mb);\n\n    ///actualizar\n    //solo uno xq se sobre entiende que viene el idmodulo\n    $plantilla->reemplaza(\"idpredio\", $idpredio);\n    $plantilla->reemplaza(\"idmodulo_predio\", $idmodulo_predio);\n\n\n    $plantilla->reemplaza(\"op_stakeholder\", \"actualizar_predio_stakeholder\");\n\n\n    $ostakeholder = new istakeholder();\n\n    //tag\n    $result_tag = $ostakeholder->lista_tag_predio($idpredio, $idmodulo_predio);\n    $cont_tag = 0;\n    $cont_tag_fila = 0;\n    $cont_tag_celda = 0;\n\n    while (!!$fila_tag = mysql_fetch_array($result_tag)) {\n        if ($cont_tag % 5 == 0) {\n            $plantilla->iniciaBloque(\"tr_tag_predio\");\n            $cont_tag_fila++;\n            $cont_tag_celda = 0;\n        }\n        $plantilla->iniciaBloque(\"td_tag_predio\");\n        $plantilla->reemplazaEnBloque(\"tag\", utf8_encode($fila_tag[tag]), \"td_tag_predio\");\n        $plantilla->reemplazaEnBloque(\"celda_nume_fila\", $cont_tag_fila, \"td_tag_predio\");\n        $plantilla->reemplazaEnBloque(\"celda_nume_celda\", $cont_tag_celda, \"td_tag_predio\");\n        $plantilla->iniciaBloque(\"spinner_tag_predio\");\n        $plantilla->reemplazaEnBloque(\"prioridad\", $fila_tag[prioridad], \"spinner_tag_predio\");\n\n        $plantilla->reemplazaEnBloque(\"celda_nume_fila\", $cont_tag_fila, \"spinner_tag_predio\");\n        $plantilla->reemplazaEnBloque(\"celda_nume_celda\", $cont_tag_celda, \"spinner_tag_predio\");\n        $plantilla->iniciaBloque(\"eliminar_tag_predio\");\n        $plantilla->reemplazaEnBloque(\"predio_complejo_tag\", $fila_tag[idpredio_tag] . \"***\" . $fila_tag[idmodulo_predio_tag] . \"***1\", \"eliminar_tag_predio\");\n\n        $plantilla->reemplazaEnBloque(\"celda_nume_fila\", $cont_tag_fila, \"eliminar_tag_predio\");\n        $plantilla->reemplazaEnBloque(\"celda_nume_celda\", $cont_tag_celda, \"eliminar_tag_predio\");\n\n\n        $cont_tag++;\n        $cont_tag_celda++;\n    }\n\n    ////antes coloco el numero real de celdas y filas\n    $plantilla->reemplaza(\"nume_fila_predio_tag_complejo\", $cont_tag_fila);\n    $plantilla->reemplaza(\"nume_celda_predio_tag_complejo\", $cont_tag_celda);\n\n    ///\n    while ($cont_tag_celda < 5) {\n        $plantilla->iniciaBloque(\"td_tag_predio\");\n        $plantilla->reemplazaEnBloque(\"tag\", \"&nbsp;\", \"td_tag_predio\");\n        $plantilla->reemplazaEnBloque(\"celda_nume_fila\", $cont_tag_fila, \"td_tag_predio\");\n        $plantilla->reemplazaEnBloque(\"celda_nume_celda\", $cont_tag_celda, \"td_tag_predio\");\n\n        $cont_tag_celda++;\n    }\n\n    $result = $ostakeholder->get_predio($idpredio, $idmodulo_predio);\n\n    if ($fila = mysql_fetch_array($result)) {\n\n        $plantilla->reemplaza(\"comentario_predio\", utf8_encode($fila[comentario]));\n\n        //documento\n\n        $result = $ostakeholder->lista_archivo_predio($idpredio);\n\n        while ($fila = mysql_fetch_array($result)) {\n            $plantilla->iniciaBloque(\"archivo\");\n            $plantilla->reemplazaEnBloque(\"idpredio_archivo\", $fila[idpredio_archivo], \"archivo\");\n            $plantilla->reemplazaEnBloque(\"idmodulo_predio_archivo\", $fila[idmodulo_predio_archivo], \"archivo\");\n            $plantilla->reemplazaEnBloque(\"archivo\", $fila[archivo], \"archivo\");\n            $plantilla->reemplazaEnBloque(\"activo\", $fila[activo], \"archivo\");\n            $plantilla->reemplazaEnBloque(\"ruta\", $idpredio . '_' . $fila[archivo], \"archivo\");\n            //$plantilla->reemplazaEnBloque(\"fecha\", date(\"d/m/Y\", strtotime($fila[fecha_c]) ), \"archivo\");\n        }\n    }\n\n\n    $plantilla->presentaPlantilla();\n}\n\nfunction ver_item_compromiso($idcompromiso, $idmodulo_compromiso) {\n\n    $plantilla = new DmpTemplate(\"../../../plantillas/stakeholder/compromiso/item_compromiso.html\");\n    //listar interaccion stakeholder\n    $icompromiso = new icompromiso();\n\n\n    $acompromiso = $icompromiso->lista_item_compromiso($idcompromiso, $idmodulo_compromiso);\n\n    $seguridad = new Seguridad();\n\n    if (count($acompromiso) > 0) {\n        $numero = 0;\n        foreach ($acompromiso[idcompromiso] as $key => $valor) {\n            $count++;\n            $numero ++;\n\n            $plantilla->iniciaBloque(\"item_compromiso\");\n            $plantilla->reemplazaEnBloque(\"numero\", $numero, \"item_compromiso\");\n            $plantilla->reemplazaEnBloque(\"fecha_compromiso\", $acompromiso['fecha'][$key], \"item_compromiso\");\n            $plantilla->reemplazaEnBloque(\"compromiso\", $acompromiso['compromiso'][$key], \"item_compromiso\");\n            $plantilla->reemplazaEnBloque(\"idcompromiso\", $acompromiso['idcompromiso'][$key], \"item_compromiso\");\n            $plantilla->reemplazaEnBloque(\"idmodulo_compromiso\", $acompromiso['idmodulo_compromiso'][$key], \"item_compromiso\");\n\n\n            //RC\n            if (sizeof($acompromiso['rc'][$key]) > 0) {\n\n                foreach ($acompromiso['rc'][$key] as $rc_key => $rc) {\n                    if ($rc_key == \"$idpersona-$idmodulo\") {\n                        $nombre = $rc;\n                    }\n\n                    $plantilla->iniciaBloque(\"rc_compromiso\");\n                    $plantilla->reemplazaEnBloque(\"rc\", $rc, \"rc_compromiso\");\n                }\n            }\n\n            ///sh\n            if (sizeof($acompromiso['sh'][$key]) > 0) {\n\n                foreach ($acompromiso['sh'][$key] as $sh_key => $sh) {\n                    //echo \"sh: $sh\";\n\n                    $plantilla->iniciaBloque(\"sh_compromiso\");\n                    $plantilla->reemplazaEnBloque(\"idsh\", $acompromiso['idsh'][$key][$sh_key], \"sh_compromiso\");\n                    $plantilla->reemplazaEnBloque(\"idmodulo\", $acompromiso['sh_idmodulo'][$key][$sh_key], \"sh_compromiso\");\n                    $plantilla->reemplazaEnBloque(\"sh\", $sh, \"sh_compromiso\");\n\n                    $plantilla->reemplazaEnBloque(\"idpersona_tipo\", $acompromiso['sh_idpersona_tipo'][$key][$sh_key], \"sh_compromiso\");\n                    if ($acompromiso['sh_imagen'][$key][$sh_key] != \"\") {\n                        $plantilla->reemplazaEnBloque(\"imagen\", \"../../../archivo/\" . $_SESSION['proyecto'] . \"/imagen/\" . $acompromiso['sh_imagen'][$key][$sh_key], \"sh_compromiso\");\n                    } else {\n                        $plantilla->reemplazaEnBloque(\"imagen\", \"../../../img/imagen.png\", \"sh_compromiso\");\n                    }\n                }\n            }\n\n            //imagenes\n            if (sizeof($acompromiso['archivo'][$key]) > 0) {\n\n                foreach ($acompromiso['archivo'][$key] as $archivo_key => $archivo) {\n                    $thumbfile = dirname(dirname(dirname(dirname(__FILE__)))) . DIRECTORY_SEPARATOR . \"archivo\" . DIRECTORY_SEPARATOR . $_SESSION['proyecto'] . DIRECTORY_SEPARATOR . \"compromiso\" . DIRECTORY_SEPARATOR . \"thumbnail\" . DIRECTORY_SEPARATOR . $acompromiso[idcompromiso][$key] . '_' . $archivo;\n                    $thumb = new thumb();\n                    if ($thumb->loadImage($thumbfile)) {\n                        $plantilla->iniciaBloque(\"imagen\");\n                        $plantilla->reemplazaEnBloque(\"proyecto\", $_SESSION['proyecto'], \"imagen\");\n                        $plantilla->reemplazaEnBloque(\"archivo\", $acompromiso[idcompromiso][$key] . '_' . $archivo, \"imagen\");\n                        $plantilla->reemplazaEnBloque(\"nombre\", $archivo, \"imagen\");\n                    }\n                }\n            }\n\n            $archivos = array();\n            //archivos\n            if (sizeof($acompromiso['archivo'][$key]) > 0) {\n\n                foreach ($acompromiso['archivo'][$key] as $archivo_key => $archivo) {\n                    $thumbfile = dirname(dirname(dirname(dirname(__FILE__)))) . DIRECTORY_SEPARATOR . \"archivo\" . DIRECTORY_SEPARATOR . $_SESSION['proyecto'] . DIRECTORY_SEPARATOR . \"compromiso\" . DIRECTORY_SEPARATOR . \"thumbnail\" . DIRECTORY_SEPARATOR . $acompromiso[idcompromiso][$key] . '_' . $archivo;\n                    $thumb = new thumb();\n                    if (!$thumb->loadImage($thumbfile)) {\n                        $archivos[] = $acompromiso[idcompromiso][$key] . '_' . $archivo;\n                    }\n                }\n                $aux = 0;\n                foreach ($archivos as $archivo) {\n                    $aux++;\n                    $plantilla->iniciaBloque(\"archivo\");\n                    $plantilla->reemplazaEnBloque(\"archivo\", $archivo, \"archivo\");\n                    if ($aux < count($archivos)) {\n                        $plantilla->reemplazaEnBloque(\"coma\", \" , \", \"archivo\");\n                    }\n                }\n            }\n\n\n            if ($seguridad->verifica_permiso(\"Editar\", \"Compromiso\", $acompromiso['idusu_c'][$key], $acompromiso['idmodulo_c'][$key])) {\n                $plantilla->iniciaBloque(\"editar_compromiso\");\n                $plantilla->reemplazaEnBloque(\"idcompromiso\", $acompromiso['idcompromiso'][$key], \"editar_compromiso\");\n                $plantilla->reemplazaEnBloque(\"idmodulo_compromiso\", $acompromiso['idmodulo_compromiso'][$key], \"editar_compromiso\");\n            }\n\n            if ($seguridad->verifica_permiso(\"Eliminar\", \"Compromiso\", $acompromiso['idusu_c'][$key], $acompromiso['idmodulo_c'][$key])) {\n                $plantilla->iniciaBloque(\"eliminar_compromiso\");\n                $plantilla->reemplazaEnBloque(\"idcompromiso\", $acompromiso['idcompromiso'][$key], \"eliminar_compromiso\");\n                $plantilla->reemplazaEnBloque(\"idmodulo_compromiso\", $acompromiso['idmodulo_compromiso'][$key], \"eliminar_compromiso\");\n            }\n        }\n    }\n\n\n    return $plantilla->getPlantillaCadena();\n    //return $plantilla->presentaPlantilla();\n}\n\nfunction ver_cuerpo_compromiso($idpersona, $idmodulo, $inicio) {\n    $modo = 1;\n    $limite = $inicio;\n    $seguridad = new Seguridad();\n    $plantilla = new DmpTemplate(\"../../../plantillas/stakeholder/compromiso/lateral_compromiso.html\");\n    $count = 0;\n    $icompromiso = new icompromiso();\n    if ($seguridad->verifica_permiso(\"Ver\", \"Inicio-Compromisos\") && $modo == 1) {\n        $acompromiso = $icompromiso->lista_compromiso($idpersona, $idmodulo, $inicio, 1);\n    } else {\n        $acompromiso = $icompromiso->lista_compromiso($idpersona, $idmodulo, $inicio, 0);\n    }\n\n\n    $seguridad = new Seguridad();\n\n    if (count($acompromiso) > 0) {\n        $numero = 0;\n        foreach ($acompromiso[idcompromiso] as $key => $valor) {\n            $count++;\n            $numero ++;\n            if ($count < $limite) {\n                $plantilla->iniciaBloque(\"item_compromiso\");\n                $plantilla->reemplazaEnBloque(\"numero\", $numero, \"item_compromiso\");\n                $plantilla->reemplazaEnBloque(\"fecha_compromiso\", $acompromiso['fecha'][$key], \"item_compromiso\");\n                $plantilla->reemplazaEnBloque(\"compromiso\", $acompromiso['compromiso'][$key], \"item_compromiso\");\n                $plantilla->reemplazaEnBloque(\"idcompromiso\", $acompromiso['idcompromiso'][$key], \"item_compromiso\");\n                $plantilla->reemplazaEnBloque(\"idmodulo_compromiso\", $acompromiso['idmodulo_compromiso'][$key], \"item_compromiso\");\n\n\n                //RC\n                if (sizeof($acompromiso['rc'][$key]) > 0) {\n                    $aux = 0;\n                    foreach ($acompromiso['rc'][$key] as $rc_key => $rc) {\n                        $aux++;\n                        if ($rc_key == \"$idpersona-$idmodulo\") {\n                            $nombre = $rc;\n                        }\n\n                        $plantilla->iniciaBloque(\"rc_compromiso\");\n                        $plantilla->reemplazaEnBloque(\"rc\", $rc, \"rc_compromiso\");\n                        if ($aux < sizeof($acompromiso['rc'][$key]) - 1) {\n                            $plantilla->reemplazaEnBloque(\"coma\", \" , \", \"rc_compromiso\");\n                        } elseif ($aux == sizeof($acompromiso['rc'][$key]) - 1) {\n                            $plantilla->reemplazaEnBloque(\"coma\", \" y \", \"rc_compromiso\");\n                        } else {\n                            $plantilla->reemplazaEnBloque(\"coma\", \".\", \"rc_compromiso\");\n                        }\n                    }\n                }\n\n                ///sh\n                if (sizeof($acompromiso['sh'][$key]) > 0) {\n\n                    foreach ($acompromiso['sh'][$key] as $sh_key => $sh) {\n                        //echo \"sh: $sh\";\n\n                        $plantilla->iniciaBloque(\"sh_compromiso\");\n                        $plantilla->reemplazaEnBloque(\"idsh\", $acompromiso['idsh'][$key][$sh_key], \"sh_compromiso\");\n                        $plantilla->reemplazaEnBloque(\"idmodulo\", $acompromiso['sh_idmodulo'][$key][$sh_key], \"sh_compromiso\");\n                        $plantilla->reemplazaEnBloque(\"sh\", $sh, \"sh_compromiso\");\n\n                        $plantilla->reemplazaEnBloque(\"idpersona_tipo\", $acompromiso['sh_idpersona_tipo'][$key][$sh_key], \"sh_compromiso\");\n                        if ($acompromiso['sh_imagen'][$key][$sh_key] != \"\") {\n                            $plantilla->reemplazaEnBloque(\"imagen\", \"../../../archivo/\" . $_SESSION['proyecto'] . \"/imagen/\" . $acompromiso['sh_imagen'][$key][$sh_key], \"sh_compromiso\");\n                        } else {\n                            $plantilla->reemplazaEnBloque(\"imagen\", \"../../../img/imagen.png\", \"sh_compromiso\");\n                        }\n                    }\n                }\n\n                //imagenes\n                if (sizeof($acompromiso['archivo'][$key]) > 0) {\n\n                    foreach ($acompromiso['archivo'][$key] as $archivo_key => $archivo) {\n                        $thumbfile = dirname(dirname(dirname(dirname(__FILE__)))) . DIRECTORY_SEPARATOR . \"archivo\" . DIRECTORY_SEPARATOR . $_SESSION['proyecto'] . DIRECTORY_SEPARATOR . \"compromiso\" . DIRECTORY_SEPARATOR . \"thumbnail\" . DIRECTORY_SEPARATOR . $acompromiso[idcompromiso][$key] . '_' . $archivo;\n                        $thumb = new thumb();\n                        if ($thumb->loadImage($thumbfile)) {\n                            $plantilla->iniciaBloque(\"imagen\");\n                            $plantilla->reemplazaEnBloque(\"proyecto\", $_SESSION['proyecto'], \"imagen\");\n                            $plantilla->reemplazaEnBloque(\"archivo\", $acompromiso[idcompromiso][$key] . '_' . $archivo, \"imagen\");\n                            $plantilla->reemplazaEnBloque(\"nombre\", $archivo, \"imagen\");\n                        }\n                    }\n                }\n\n                $archivos = array();\n                //archivos\n                if (sizeof($acompromiso['archivo'][$key]) > 0) {\n\n                    foreach ($acompromiso['archivo'][$key] as $archivo_key => $archivo) {\n                        $thumbfile = dirname(dirname(dirname(dirname(__FILE__)))) . DIRECTORY_SEPARATOR . \"archivo\" . DIRECTORY_SEPARATOR . $_SESSION['proyecto'] . DIRECTORY_SEPARATOR . \"compromiso\" . DIRECTORY_SEPARATOR . \"thumbnail\" . DIRECTORY_SEPARATOR . $acompromiso[idcompromiso][$key] . '_' . $archivo;\n                        $thumb = new thumb();\n                        if (!$thumb->loadImage($thumbfile)) {\n                            $archivos[] = $acompromiso[idcompromiso][$key] . '_' . $archivo;\n                        }\n                    }\n                    $aux = 0;\n                    foreach ($archivos as $archivo) {\n                        $aux++;\n                        $plantilla->iniciaBloque(\"archivo\");\n                        $plantilla->reemplazaEnBloque(\"archivo\", $archivo, \"archivo\");\n                        if ($aux < count($archivos)) {\n                            $plantilla->reemplazaEnBloque(\"coma\", \" , \", \"archivo\");\n                        }\n                    }\n                }\n\n\n                if ($seguridad->verifica_permiso(\"Editar\", \"Compromiso\", $acompromiso['idusu_c'][$key], $acompromiso['idmodulo_c'][$key])) {\n                    $plantilla->iniciaBloque(\"editar_compromiso\");\n                    $plantilla->reemplazaEnBloque(\"idcompromiso\", $acompromiso['idcompromiso'][$key], \"editar_compromiso\");\n                    $plantilla->reemplazaEnBloque(\"idmodulo_compromiso\", $acompromiso['idmodulo_compromiso'][$key], \"editar_compromiso\");\n                }\n\n                if ($seguridad->verifica_permiso(\"Eliminar\", \"Compromiso\", $acompromiso['idusu_c'][$key], $acompromiso['idmodulo_c'][$key])) {\n                    $plantilla->iniciaBloque(\"eliminar_compromiso\");\n                    $plantilla->reemplazaEnBloque(\"idcompromiso\", $acompromiso['idcompromiso'][$key], \"eliminar_compromiso\");\n                    $plantilla->reemplazaEnBloque(\"idmodulo_compromiso\", $acompromiso['idmodulo_compromiso'][$key], \"eliminar_compromiso\");\n                }\n            }\n        }\n    }\n    if ($count == $limite) {\n        $limite = $limite + 10;\n        $plantilla->reemplaza(\"limite\", $limite);\n        $plantilla->reemplaza(\"ver_mas\", \"ver m&aacute;s\");\n    }\n\n\n    $plantilla_tabla = new DmpTemplate(\"../../../plantillas/stakeholder/compromiso/tabla_compromiso.html\");\n    $plantilla_tabla->reemplaza(\"bloque_compromiso\", $plantilla->getPlantillaCadena());\n    $plantilla_tabla->reemplaza(\"inicio\", $inicio + 10);\n    $plantilla_tabla->reemplaza(\"idpersona\", $idpersona);\n    $plantilla_tabla->reemplaza(\"idmodulo\", $idmodulo);\n    $plantilla_tabla->reemplaza(\"persona\", $persona); // ver mas\n    $plantilla_tabla->reemplaza(\"presenta\", 1); // ver mas\n\n    if ($modo == 1) {\n        $plantilla_tabla->iniciaBloque(\"enlaces\");\n        $plantilla_tabla->reemplazaEnBloque(\"nombre\", $nombre, \"enlaces\");\n        $plantilla_tabla->reemplazaEnBloque(\"idpersona\", $idpersona, \"enlaces\");\n        $plantilla_tabla->reemplazaEnBloque(\"idmodulo\", $idmodulo, \"enlaces\");\n        /*\n          if($seguridad->verifica_permiso(\"Crear\", \"Interaccion\"))\n          $plantilla_tabla->iniciaBloque (\"crear_interaccion\");\n          if($seguridad->verifica_permiso(\"Crear\", \"Reclamo\"))\n          $plantilla_tabla->iniciaBloque (\"crear_reclamo\");\n         * \n         */\n    } else {\n        //$plantilla_tabla->reemplaza(\"titulo\", \"Compromisos\");\n    }\n\n    if ($numero > 0) {\n\n        $plantilla_tabla->reemplazaEnBloque(\"numero\", $numero, \"enlaces\");\n        $plantilla_tabla->reemplazaEnBloque(\"de\", \"de\", \"enlaces\");\n        $plantilla_tabla->reemplazaEnBloque(\"total\", $acompromiso['total'], \"enlaces\");\n        if ($numero < $acompromiso['total']) {\n            /*\n              $plantilla_tabla->iniciaBloque(\"ver_mas\");\n              $plantilla_tabla->reemplazaEnBloque(\"inicio\", $inicio + 10,\"ver_mas\");\n              //$plantilla_tabla->reemplazaEnBloque(\"nombre\", $nombre, \"ver_mas\");\n              $plantilla_tabla->reemplazaEnBloque(\"idpersona\", $idpersona , \"ver_mas\");\n              $plantilla_tabla->reemplazaEnBloque(\"idmodulo\", $idmodulo , \"ver_mas\");\n              $plantilla_tabla->reemplazaEnBloque(\"persona\", $persona , \"ver_mas\"); // ver mas\n              $plantilla_tabla->reemplazaEnBloque(\"presenta\", 1, \"ver_mas\"); // ver mas\n              $plantilla_tabla->reemplazaEnBloque(\"modo\", $modo, \"ver_mas\"); // ver mas\n             * \n             */\n        }\n    }\n\n    if ($numero == 0) {\n        $plantilla_tabla->iniciaBloque(\"mensaje\");\n    }\n\n    $plantilla = $plantilla_tabla;\n\n\n    $plantilla->presentaPlantilla();\n    //return $plantilla->getPlantillaCadena();\n}\n\nfunction ver_cuerpo_reclamo($todos = 0, $flag_estado = 1, $limite = \"\") {\n\n    $plantilla = new DmpTemplate(\"../../../plantillas/reclamo/reclamo/lateral_reclamo.html\");\n    $count = 0;\n    $ireclamo = new ireclamo();\n    $areclamo = $ireclamo->lista_relacionista_reclamo($_SESSION[\"idpersona\"], $_SESSION[\"idmodulo_persona\"], $limite);\n\n    $seguridad = new Seguridad();\n\n    if (count($areclamo) > 0) {\n\n        foreach ($areclamo[idreclamo] as $key => $valor) {\n            $count++;\n            if ($count < $limite) {\n                $plantilla->iniciaBloque(\"item_reclamo\");\n                $plantilla->reemplazaEnBloque(\"fecha_reclamo\", $areclamo['fecha'][$key], \"item_reclamo\");\n                $plantilla->reemplazaEnBloque(\"reclamo\", $areclamo['reclamo'][$key], \"item_reclamo\");\n                $plantilla->reemplazaEnBloque(\"idreclamo\", $areclamo['idreclamo'][$key], \"item_reclamo\");\n                $plantilla->reemplazaEnBloque(\"idmodulo_reclamo\", $areclamo['idmodulo_reclamo'][$key], \"item_reclamo\");\n                if ($seguridad->verifica_permiso(\"Editar\", \"Reclamo\", $areclamo['idusu_c'][$key], $areclamo['idmodulo_c'][$key])) {\n                    $plantilla->iniciaBloque(\"editar_reclamo\");\n                    $plantilla->reemplazaEnBloque(\"idreclamo\", $areclamo['idreclamo'][$key], \"editar_reclamo\");\n                    $plantilla->reemplazaEnBloque(\"idmodulo_reclamo\", $areclamo['idmodulo_reclamo'][$key], \"editar_reclamo\");\n                }\n\n                if ($seguridad->verifica_permiso(\"Eliminar\", \"Reclamo\", $areclamo['idusu_c'][$key], $areclamo['idmodulo_c'][$key])) {\n                    $plantilla->iniciaBloque(\"eliminar_reclamo\");\n                    $plantilla->reemplazaEnBloque(\"idreclamo\", $areclamo['idreclamo'][$key], \"eliminar_reclamo\");\n                    $plantilla->reemplazaEnBloque(\"idmodulo_reclamo\", $areclamo['idmodulo_reclamo'][$key], \"eliminar_reclamo\");\n                }\n            }\n        }\n    }\n    if ($count == $limite) {\n        $limite = $limite + 10;\n        $plantilla->reemplaza(\"limite\", $limite);\n        $plantilla->reemplaza(\"ver_mas\", \"ver m&aacute;s\");\n    }\n    //echo $plantilla->presentaPlantilla();\n    return $plantilla->getPlantillaCadena();\n}\n\nfunction ver_interaccion_stakeholder($idpersona = \"\", $idmodulo = \"\", $idinteraccion = \"\", $idmodulo_interaccion = \"\", $persona = \"\", $presenta) {\n    $seguridad = new Seguridad();\n    //echo $idpersona.\" \".$idmodulo;\n    $plantilla = new DmpTemplate(\"../../../plantillas/stakeholder/interaccion/interaccion.html\");\n\n    if (!$seguridad->verifica_permiso(\"Crear\", \"Interaccion\"))\n        $plantilla->iniciaBloque(\"crear_interaccion\");\n\n    $plantilla_interaccion = new DmpTemplate(\"../../../plantillas/stakeholder/interaccion/bloque_interaccion.html\");\n    $plantilla->reemplaza(\"idpersona\", $idpersona);\n    $plantilla->reemplaza(\"idmodulo\", $idmodulo);\n    $plantilla->reemplaza(\"persona\", $persona);\n    //$plantilla->reemplaza(\"idinteraccion_sh\", $idpersona . \"---\" . $idmodulo);\n    //echo $_SESSION[idusu] . \"---\" . $_SESSION[idmodulo_a];\n    //$plantilla->reemplaza(\"idinteraccion_rc\", $_SESSION[idpersona] . \"---\" . $_SESSION[idmodulo_persona]);\n    $plantilla->iniciaBloque(\"tr_rc_interaccion\");\n    $plantilla->iniciaBloque(\"td_rc_interaccion\");\n    $plantilla->reemplazaEnBloque(\"rc\", $_SESSION[nombre] . \" \" . $_SESSION[apellido_p] . \" \" . $_SESSION[apellido_m], \"td_rc_interaccion\");\n    $plantilla->reemplazaEnBloque(\"celda_nume_fila_rc\", 1, \"td_rc_interaccion\");\n    $plantilla->reemplazaEnBloque(\"celda_nume_celda_rc\", 1, \"td_rc_interaccion\");\n\n    $plantilla->reemplaza(\"cant_rc\", 1);\n\n    $plantilla->iniciaBloque(\"idinteraccion_complejo_rc\");\n    $plantilla->reemplazaEnBloque(\"idinteraccion_complejo_rc\", $_SESSION[idpersona] . \"---\" . $_SESSION[idmodulo_persona], \"idinteraccion_complejo_rc\");\n    $plantilla->reemplazaEnBloque(\"celda_nume_fila_rc\", 1, \"idinteraccion_complejo_rc\");\n    $plantilla->reemplazaEnBloque(\"celda_nume_celda_rc\", 1, \"idinteraccion_complejo_rc\");\n\n    $plantilla->iniciaBloque(\"eliminar_rc_interaccion\");\n    $plantilla->reemplazaEnBloque(\"celda_nume_fila_rc\", 1, \"eliminar_rc_interaccion\");\n    $plantilla->reemplazaEnBloque(\"celda_nume_celda_rc\", 1, \"eliminar_rc_interaccion\");\n\n    for ($cont_rc_celda = 2; $cont_rc_celda <= 5; $cont_rc_celda++) {\n        $plantilla->iniciaBloque(\"td_rc_interaccion\");\n        $plantilla->reemplazaEnBloque(\"rc\", \"&nbsp;\", \"td_rc_interaccion\");\n        $plantilla->reemplazaEnBloque(\"celda_nume_fila_rc\", 1, \"td_rc_interaccion\");\n        $plantilla->reemplazaEnBloque(\"celda_nume_celda_rc\", $cont_rc_celda, \"td_rc_interaccion\");\n    }\n\n    $ipersona = new ipersona();\n\n    $result_persona = $ipersona->get_persona($idpersona, $idmodulo);\n    $fila_sh = mysql_fetch_array($result_persona);\n\n    $plantilla->iniciaBloque(\"tr_sh_interaccion\");\n    $plantilla->iniciaBloque(\"td_sh_interaccion\");\n    $plantilla->reemplazaEnBloque(\"sh\", $fila_sh[nombre] . \" \" . $fila_sh[apellido_p] . \" \" . $fila_sh[apellido_m], \"td_sh_interaccion\");\n    $plantilla->reemplazaEnBloque(\"idsh\", $fila_sh[idpersona], \"td_sh_interaccion\");\n    $plantilla->reemplazaEnBloque(\"idmodulo\", $fila_sh[idmodulo], \"td_sh_interaccion\");\n    $plantilla->reemplazaEnBloque(\"celda_nume_fila_sh\", 1, \"td_sh_interaccion\");\n    $plantilla->reemplazaEnBloque(\"celda_nume_celda_sh\", 1, \"td_sh_interaccion\");\n\n    $plantilla->reemplaza(\"cant_sh\", 1);\n\n    $plantilla->iniciaBloque(\"idinteraccion_complejo_sh\");\n\n    $plantilla->reemplazaEnBloque(\"idinteraccion_complejo_sh\", $fila_sh[idpersona] . \"---\" . $fila_sh[idmodulo], \"idinteraccion_complejo_sh\");\n    $plantilla->reemplazaEnBloque(\"celda_nume_fila_sh\", 1, \"idinteraccion_complejo_sh\");\n    $plantilla->reemplazaEnBloque(\"celda_nume_celda_sh\", 1, \"idinteraccion_complejo_sh\");\n\n    $plantilla->iniciaBloque(\"eliminar_sh_interaccion\");\n    //***1 el estado activo, al cambiar a 0, el estado desactivo\n\n    $plantilla->reemplazaEnBloque(\"celda_nume_fila_sh\", 1, \"eliminar_sh_interaccion\");\n    $plantilla->reemplazaEnBloque(\"celda_nume_celda_sh\", 1, \"eliminar_sh_interaccion\");\n\n    for ($cont_sh_celda = 2; $cont_sh_celda <= 5; $cont_sh_celda++) {\n        $plantilla->iniciaBloque(\"td_sh_interaccion\");\n        $plantilla->reemplazaEnBloque(\"sh\", \"&nbsp;\", \"td_sh_interaccion\");\n        $plantilla->reemplazaEnBloque(\"celda_nume_fila_sh\", 1, \"td_sh_interaccion\");\n        $plantilla->reemplazaEnBloque(\"celda_nume_celda_sh\", $cont_sh_celda, \"td_sh_interaccion\");\n    }\n\n    $plantilla->reemplaza(\"nume_fila_interaccion_sh_complejo\", 1);\n    $plantilla->reemplaza(\"nume_celda_interaccion_sh_complejo\", 2);\n\n\n    $plantilla->reemplaza(\"maximo\", 2);\n\n    $plantilla->reemplaza(\"fecha_interaccion\", date('d/m/Y'));\n    //echo \"idinteraccion\".$idinteraccion.\" idmodulo\".$idmodulo_interaccion;\n\n\n    $iinteraccion_estado = new iinteraccion_estado();\n\n    $result_interaccion_estado = $iinteraccion_estado->lista_interaccion_estado();\n\n    while (!!$fila = mysql_fetch_array($result_interaccion_estado)) {\n\n        $plantilla->iniciaBloque(\"interaccion_estado\");\n        $plantilla->reemplazaEnBloque(\"idinteraccion_estado\", $fila[idinteraccion_estado], \"interaccion_estado\");\n        $plantilla->reemplazaEnBloque(\"interaccion_estado\", $fila[interaccion_estado], \"interaccion_estado\");\n    }\n\n    $iinteraccion_tipo = new iinteraccion_tipo();\n\n    $result_interaccion_tipo = $iinteraccion_tipo->lista_interaccion_tipo();\n\n    while (!!$fila = mysql_fetch_array($result_interaccion_tipo)) {\n\n        $plantilla->iniciaBloque(\"interaccion_tipo\");\n        $plantilla->reemplazaEnBloque(\"idinteraccion_tipo\", $fila[idinteraccion_tipo], \"interaccion_tipo\");\n        $plantilla->reemplazaEnBloque(\"interaccion_tipo\", utf8_encode($fila[interaccion_tipo]), \"interaccion_tipo\");\n    }\n    //listar interaccion stakeholder\n    $plantilla_interaccion = ver_bloque_interaccion($fila_sh[idpersona_tipo], $fila_sh[apellido_p] . \" \" . $fila_sh[apellido_m] . \", \" . $fila_sh[nombre], $idpersona, $idmodulo, 50, $persona, $presenta, 0);\n\n    $plantilla->reemplaza(\"tabla_interaccion\", $plantilla_interaccion);\n\n    if ($presenta == 0) {\n        $plantilla->presentaPlantilla();\n    } else {\n        return $plantilla->getPlantillaCadena();\n    }\n}\n\nfunction ver_bloque_interaccion($idpersona_tipo, $nombre, $idpersona, $idmodulo, $inicio, $persona = 1, $presenta, $modo, $idsh_compuesto) {\n    // $presenta = 1;\n    //$tabla_interaccion = 1;\n    //persona 2 ve las interacciones del relacionista comunitario, usuario\n    //persona 1 ve las interacciones del stakeholder\n    //con cuerpo, si incluye los div y la tabla de interaccion\n    //echo \"nombre : $nombre\";\n    //echo \"modo : $modo\";\n\n    $seguridad = new Seguridad();\n\n    $plantilla = new DmpTemplate(\"../../../plantillas/stakeholder/interaccion/bloque_interaccion.html\");\n    $plantilla_tabla = new DmpTemplate(\"../../../plantillas/stakeholder/interaccion/tabla_interaccion.html\");\n\n    $flag = false;\n\n    if (!is_array($idsh_compuesto) && count($idsh_compuesto) == 0) {\n        $idsh_compuesto = array();\n        $flag = true;\n    }\n\n    //listar interaccion stakeholder\n    $istakeholder = new istakeholder();\n    //depende si estoy en la pantalla principal o vengo de organizaciones\n    if ($seguridad->verifica_permiso(\"Ver\", \"Inicio-Interacciones\") && $modo == 1) {\n        $ainteraccion = $istakeholder->lista_stakeholder_interaccion($idpersona, $idmodulo, $inicio, 0);\n    } elseif ($modo == 2) {\n        $ipersona = new ipersona ();\n        $result = $ipersona->lista_organizacion_sh($idpersona, $idmodulo);\n        $count = 0;\n        while ($fila = mysql_fetch_array($result)) {\n            //print_r($fila);\n            if ($fila['idpersona_tipo'] > 1) {\n                $datos['sh'][$count]['level'] = 0;\n                $datos['sh'][$count]['sh'] = utf8_encode($fila['apellido_p']);\n                $id = $fila['idpersona'] . '-' . $fila['idmodulo'];\n                $valor = $id;\n            } else {\n                $id = $fila['idpersona'] . '-' . $fila['idmodulo'] . '-' . $fila['idorganizacion'] . '-' . $fila['idmodulo_organizacion'];\n                $valor = $fila['idpersona'] . '-' . $fila['idmodulo'];\n            }\n\n            $datos['sh'][$count]['id'] = $id;\n\n            $datos['sh'][$count]['sh'] = utf8_encode($fila['apellido_p'] . \" \" . $fila['apellido_m'] . \" \" . $fila['nombre']);\n            $datos['sh'][$count]['check'] = \"<input id=\\\"$id\\\" type=\\\"checkbox\\\" name=\\\"shs[]\\\"  value=\\\"$valor\\\" class=\\\"$valor\\\" onclick=\\\"actualiza_estado_sh('$id')\\\" checked /><input id=\\\"id$id\\\" type=\\\"hidden\\\"   value=\\\"$valor\\\" name=\\\"idsh_compuesto[]\\\" />\";\n            $datos['sh'][$count]['level'] = 1;\n\n            $datos['sh'][$count]['loaded'] = true;\n            $datos['sh'][$count]['parent'] = null;\n            if ($datos['sh'][$count]['level'] > 0) {\n                $datos['sh'][$count]['parent'] = $fila['idorganizacion'] . '-' . $fila['idmodulo_organizacion'];\n                //$datos['tags']['response'][$count]['parent']=$fila['idtag_padre'];\n            }\n            $datos['sh'][$count]['isLeaf'] = true;\n            $datos['sh'][$count]['expanded'] = false;\n            if ($fila['idpersona_tipo'] > 1) {\n                $datos['sh'][$count]['isLeaf'] = false;\n                $datos['sh'][$count]['expanded'] = true;\n            }\n            if ($flag) {\n                $idsh_compuesto[] = $valor;\n            }\n            $count++;\n        }\n\n        /*\n          $plantilla_tabla->iniciaBloque(\"ver_filtro\");\n\n          $plantilla_tabla->reemplazaEnBloque(\"idpersona\", $idpersona, \"ver_filtro\");\n          $plantilla_tabla->reemplazaEnBloque(\"idmodulo\", $idmodulo, \"ver_filtro\");\n          $plantilla_tabla->reemplazaEnBloque(\"idpersona_tipo\", $idpersona_tipo, \"ver_filtro\");\n         */\n\n        $ainteraccion = $istakeholder->lista_stakeholder_interaccion($idpersona, $idmodulo, $inicio, 0, $idsh_compuesto);\n    } elseif ($modo == 3) {\n        $ihogar = new ihogar ();\n        $ahogar = $ihogar->get_hogar_sh($idpersona, $idmodulo);\n        $count = 0;\n        $aux_hogar = array();\n        foreach ($ahogar[fecha_hogar] as $idhogar_complejo => $fecha_hogar) {\n            //print_r($fila);\n\n            foreach ($ahogar[sh][$idhogar_complejo] as $idhogar_sh_complejo => $nombre_sh) {\n                $idhogar_sh = explode('---', $idhogar_sh_complejo);\n                $id = $idhogar_sh[0] . '-' . $idhogar_sh[1];\n                $valor = $idhogar_sh[0] . '-' . $idhogar_sh[1];\n\n                if ($aux_hogar[$id] != $id) {\n                    $aux_hogar[$id]=$id;\n                    $datos['sh'][$count]['id'] = $id;\n\n                    $datos['sh'][$count]['sh'] = utf8_encode($nombre_sh);\n                    $datos['sh'][$count]['check'] = \"<input id=\\\"$id\\\" type=\\\"checkbox\\\" name=\\\"shs[]\\\"  value=\\\"$valor\\\" class=\\\"$valor\\\" onclick=\\\"actualiza_estado_sh('$id')\\\" checked /><input id=\\\"id$id\\\" type=\\\"hidden\\\"   value=\\\"$valor\\\" name=\\\"idsh_compuesto[]\\\" />\";\n                    $datos['sh'][$count]['level'] = 1;\n\n                    $datos['sh'][$count]['loaded'] = true;\n                    $datos['sh'][$count]['parent'] = null;\n                    //if ($datos['sh'][$count]['level'] > 0) {\n                    //$datos['sh'][$count]['parent'] = $fila['idorganizacion'] . '-' . $fila['idmodulo_organizacion'];\n                    //$datos['tags']['response'][$count]['parent']=$fila['idtag_padre'];\n                    //}\n                    $datos['sh'][$count]['isLeaf'] = true;\n                    $datos['sh'][$count]['expanded'] = false;\n                    if ($fila['idpersona_tipo'] > 1) {\n                        $datos['sh'][$count]['isLeaf'] = false;\n                        $datos['sh'][$count]['expanded'] = true;\n                    }\n                    if ($flag) {\n                        $idsh_compuesto[] = $valor;\n                    }\n                    $count++;\n                }\n            }\n        }\n        $ainteraccion = $istakeholder->lista_stakeholder_interaccion($idpersona, $idmodulo, $inicio, 0, $idsh_compuesto);\n    } else {\n        //en predio esta entrando a este\n        $ainteraccion = $istakeholder->lista_stakeholder_interaccion($idpersona, $idmodulo, $inicio, $persona);\n    }\n    //lo cambio para ordenarlo\n    if (sizeof($ainteraccion[interaccion]) > 0) {\n\n        $numero = 0;\n\n        foreach ($ainteraccion[interaccion] as $key => $interaccion) {\n\n            $numero++;\n\n            $plantilla->iniciaBloque(\"item_interaccion\");\n            /*\n              if (strlen($interaccion) > 400) {\n\n              $interaccion = substr($interaccion, 0, 400) . \"......\";\n              }\n             * \n             */\n            $plantilla->reemplazaEnBloque(\"fecha_interaccion\", $ainteraccion[fecha][$key], \"item_interaccion\");\n            $plantilla->reemplazaEnBloque(\"numero\", $numero, \"item_interaccion\");\n            $plantilla->reemplazaEnBloque(\"interaccion\", $interaccion, \"item_interaccion\");\n\n\n            $plantilla->reemplazaEnBloque(\"idinteraccion\", $ainteraccion[idinteraccion][$key], \"item_interaccion\");\n            //echo \"iddd\".$ainteraccion[idinteraccion][$key];\n            $plantilla->reemplazaEnBloque(\"idmodulo_interaccion\", $ainteraccion[idmodulo_interaccion][$key], \"item_interaccion\");\n            $plantilla->reemplazaEnBloque(\"persona\", $persona, \"item_interaccion\");\n            //$plantilla->reemplazaEnBloque(\"tabla_interaccion\", $tabla_interaccion, \"item_interaccion\");\n            if ($seguridad->verifica_permiso(\"Crear\", \"Compromiso\")) {\n                $plantilla->iniciaBloque(\"crear_compromiso\");\n                $plantilla->reemplazaEnBloque(\"idinteraccion\", $ainteraccion[idinteraccion][$key], \"crear_compromiso\");\n                //echo \"Editar \". \" Interaccion \". $ainteraccion[idusu_c][$key] .\" , \". $ainteraccion[idmodulo_c][$key];\n                $plantilla->reemplazaEnBloque(\"idmodulo_interaccion\", $ainteraccion[idmodulo_interaccion][$key], \"crear_compromiso\");\n            }\n\n            if ($seguridad->verifica_permiso(\"Editar\", \"Interaccion\", $ainteraccion[idusu_c][$key], $ainteraccion[idmodulo_c][$key])) {\n                $plantilla->iniciaBloque(\"editar_interaccion\");\n                $plantilla->reemplazaEnBloque(\"idinteraccion\", $ainteraccion[idinteraccion][$key], \"editar_interaccion\");\n                //echo \"Editar \". \" Interaccion \". $ainteraccion[idusu_c][$key] .\" , \". $ainteraccion[idmodulo_c][$key];\n                $plantilla->reemplazaEnBloque(\"idmodulo_interaccion\", $ainteraccion[idmodulo_interaccion][$key], \"editar_interaccion\");\n                $plantilla->reemplazaEnBloque(\"persona\", $persona, \"editar_interaccion\");\n            }\n\n            if ($seguridad->verifica_permiso(\"Eliminar\", \"Interaccion\", $ainteraccion[idusu_c][$key], $ainteraccion[idmodulo_c][$key])) {\n                $plantilla->iniciaBloque(\"eliminar_interaccion\");\n                $plantilla->reemplazaEnBloque(\"idinteraccion\", $ainteraccion[idinteraccion][$key], \"eliminar_interaccion\");\n                $plantilla->reemplazaEnBloque(\"idmodulo_interaccion\", $ainteraccion[idmodulo_interaccion][$key], \"eliminar_interaccion\");\n            }\n\n\n            //imagenes\n            if (sizeof($ainteraccion['archivo'][$key]) > 0) {\n\n                foreach ($ainteraccion['archivo'][$key] as $archivo_key => $archivo) {\n                    $thumbfile = dirname(dirname(dirname(dirname(__FILE__)))) . DIRECTORY_SEPARATOR . \"archivo\" . DIRECTORY_SEPARATOR . $_SESSION['proyecto'] . DIRECTORY_SEPARATOR . \"interaccion\" . DIRECTORY_SEPARATOR . \"thumbnail\" . DIRECTORY_SEPARATOR . $ainteraccion[idinteraccion][$key] . '_' . $archivo;\n                    $thumb = new thumb();\n                    if ($thumb->loadImage($thumbfile)) {\n                        $plantilla->iniciaBloque(\"imagen\");\n                        $plantilla->reemplazaEnBloque(\"proyecto\", $_SESSION['proyecto'], \"imagen\");\n                        $plantilla->reemplazaEnBloque(\"archivo\", $ainteraccion[idinteraccion][$key] . '_' . $archivo, \"imagen\");\n                        $plantilla->reemplazaEnBloque(\"nombre\", $archivo, \"imagen\");\n                    }\n                }\n            }\n\n            $archivos = array();\n            //archivos\n            if (sizeof($ainteraccion['archivo'][$key]) > 0) {\n\n                foreach ($ainteraccion['archivo'][$key] as $archivo_key => $archivo) {\n                    $thumbfile = dirname(dirname(dirname(dirname(__FILE__)))) . DIRECTORY_SEPARATOR . \"archivo\" . DIRECTORY_SEPARATOR . $_SESSION['proyecto'] . DIRECTORY_SEPARATOR . \"interaccion\" . DIRECTORY_SEPARATOR . \"thumbnail\" . DIRECTORY_SEPARATOR . $ainteraccion[idinteraccion][$key] . '_' . $archivo;\n                    $thumb = new thumb();\n                    if (!$thumb->loadImage($thumbfile)) {\n                        $archivos[] = $ainteraccion[idinteraccion][$key] . '_' . $archivo;\n                    }\n                }\n                $aux = 0;\n                foreach ($archivos as $archivo) {\n                    $aux++;\n                    $plantilla->iniciaBloque(\"archivo\");\n                    $plantilla->reemplazaEnBloque(\"archivo\", $archivo, \"archivo\");\n                    if ($aux < count($archivos)) {\n                        $plantilla->reemplazaEnBloque(\"coma\", \" , \", \"archivo\");\n                    }\n                }\n            }\n\n\n\n            $cant = sizeof($ainteraccion['idcompromiso'][$key]);\n            $count = 0;\n            if ($cant > 0) {\n                 \n                foreach ($ainteraccion['compromiso'][$key] as $compromiso_key => $compromiso) {\n                    $count++;\n\n                    $plantilla->iniciaBloque(\"item_compromiso\");\n                    if ($count > 1) {\n                        $plantilla->reemplazaEnBloque(\"idinteraccion\", $ainteraccion[idinteraccion][$key], \"item_compromiso\");\n                        $plantilla->reemplazaEnBloque(\"idmodulo_interaccion\", $ainteraccion[idmodulo_interaccion][$key], \"item_compromiso\");\n                        $plantilla->reemplazaEnBloque(\"estilo\", \"display:none;\", \"item_compromiso\");\n                    }\n                    $plantilla->reemplazaEnBloque(\"fecha_compromiso\", $ainteraccion['fecha_compromiso'][$key][$compromiso_key], \"item_compromiso\");\n                    //echo $compromiso;\n                    $plantilla->reemplazaEnBloque(\"compromiso\", $compromiso, \"item_compromiso\");\n                    $plantilla->reemplazaEnBloque(\"idcompromiso\", $ainteraccion['idcompromiso'][$key][$compromiso_key], \"item_compromiso\");\n                    $plantilla->reemplazaEnBloque(\"idmodulo_compromiso\", $ainteraccion['idmodulo_compromiso'][$key][$compromiso_key], \"item_compromiso\");\n                    if ($seguridad->verifica_permiso(\"Editar\", \"Compromiso\", $ainteraccion['compromiso_idusu_c'][$key][$compromiso_key], $ainteraccion['compromiso_idmodulo_c'][$key][$compromiso_key])) {\n                        $plantilla->iniciaBloque(\"editar_compromiso\");\n                        $plantilla->reemplazaEnBloque(\"idcompromiso\", $ainteraccion['idcompromiso'][$key][$compromiso_key], \"editar_compromiso\");\n                        $plantilla->reemplazaEnBloque(\"idmodulo_compromiso\", $ainteraccion['idmodulo_compromiso'][$key][$compromiso_key], \"editar_compromiso\");\n                    }\n\n                    if ($seguridad->verifica_permiso(\"Eliminar\", \"Compromiso\", $ainteraccion['compromiso_idusu_c'][$key][$compromiso_key], $ainteraccion['compromiso_idmodulo_c'][$key][$compromiso_key])) {\n                        $plantilla->iniciaBloque(\"eliminar_compromiso\");\n                        $plantilla->reemplazaEnBloque(\"idcompromiso\", $ainteraccion['idcompromiso'][$key][$compromiso_key], \"eliminar_compromiso\");\n                        $plantilla->reemplazaEnBloque(\"idmodulo_compromiso\", $ainteraccion['idmodulo_compromiso'][$key][$compromiso_key], \"eliminar_compromiso\");\n                    }\n                }\n            }\n\n            $plantilla->iniciaBloque(\"menu_compromiso\");\n            $plantilla->reemplazaEnBloque(\"idinteraccion\", $ainteraccion[idinteraccion][$key], \"menu_compromiso\");\n            $plantilla->reemplazaEnBloque(\"idmodulo_interaccion\", $ainteraccion[idmodulo_interaccion][$key], \"menu_compromiso\");\n            if ($count > 1) {\n                $plantilla->iniciaBloque(\"boton_ocultar\");\n                $plantilla->reemplazaEnBloque(\"idinteraccion\", $ainteraccion[idinteraccion][$key], \"boton_ocultar\");\n                $plantilla->reemplazaEnBloque(\"idmodulo_interaccion\", $ainteraccion[idmodulo_interaccion][$key], \"boton_ocultar\");\n            }\n\n\n            //RC\n            if (sizeof($ainteraccion['rc'][$key]) > 0) {\n\n                $aux = 0;\n                foreach ($ainteraccion['rc'][$key] as $rc_key => $rc) {\n                    if ($rc_key == \"$idpersona-$idmodulo\") {\n                        $nombre = $rc;\n                        $rc= ucwords(strtolower($rc));\n                    }\n                    $aux++;\n                    $plantilla->iniciaBloque(\"rc_interaccion\");\n                    $plantilla->reemplazaEnBloque(\"rc\", $rc, \"rc_interaccion\");\n                    if ($aux < sizeof($ainteraccion['rc'][$key]) - 1) {\n                        $plantilla->reemplazaEnBloque(\"coma\", \" , \", \"rc_interaccion\");\n                    } elseif ($aux == sizeof($ainteraccion['rc'][$key]) - 1) {\n                        $plantilla->reemplazaEnBloque(\"coma\", \" y \", \"rc_interaccion\");\n                    } else {\n                        $plantilla->reemplazaEnBloque(\"coma\", \".\", \"rc_interaccion\");\n                    }\n                }\n            }\n            ///sh\n            if (sizeof($ainteraccion['sh'][$key]) > 0) {\n\n                foreach ($ainteraccion['sh'][$key] as $sh_key => $sh) {\n                    //echo \"sh: $sh\";\n                    \n                    //$sh=  ucfirst(strtolower($sh));\n                    $tokens = preg_split(\"/[-]+/\", $sh);\n                    $plantilla->iniciaBloque(\"sh_interaccion\");\n                    $plantilla->reemplazaEnBloque(\"idsh\", $tokens[0], \"sh_interaccion\");\n                    $plantilla->reemplazaEnBloque(\"idmodulo\", $tokens[1], \"sh_interaccion\");\n                   \n                    $plantilla->reemplazaEnBloque(\"sh\", ucwords(strtolower($tokens[2])), \"sh_interaccion\");\n\n                    $plantilla->reemplazaEnBloque(\"idpersona_tipo\", $tokens[3], \"sh_interaccion\");\n                    if ($tokens[4] != \"\") {\n                        $plantilla->reemplazaEnBloque(\"imagen\", \"../../../archivo/\" . $_SESSION['proyecto'] . \"/imagen/\" . $tokens[4], \"sh_interaccion\");\n                    } else {\n                        $plantilla->reemplazaEnBloque(\"imagen\", \"../../../img/imagen.png\", \"sh_interaccion\");\n                    }\n                }\n            }\n        }\n    }\n    //echo \"tabla in\" . $tabla_interaccion;\n    if ($persona < 3) {\n\n        $plantilla_tabla->reemplaza(\"bloque_interaccion\", $plantilla->getPlantillaCadena());\n\n        if ($modo == 1) {\n            $plantilla_tabla->iniciaBloque(\"enlaces\");\n            //Â´plkk$plantilla_tabla->reemplazaEnBloque(\"nombre\", $nombre, \"enlaces\");\n            $plantilla_tabla->reemplazaEnBloque(\"idpersona\", $idpersona, \"enlaces\");\n            $plantilla_tabla->reemplazaEnBloque(\"idmodulo\", $idmodulo, \"enlaces\");\n            if ($seguridad->verifica_permiso(\"Crear\", \"Interaccion\"))\n                $plantilla_tabla->iniciaBloque(\"crear_interaccion\");\n            /*\n              if($seguridad->verifica_permiso(\"Crear\", \"Reclamo\"))\n              $plantilla_tabla->iniciaBloque (\"crear_reclamo\");\n             * \n             */\n        }else {\n            $plantilla_tabla->reemplaza(\"titulo\", \"Interacciones\");\n            $plantilla_tabla->iniciaBloque(\"ver_organizacion\");\n            $plantilla_tabla->reemplazaEnBloque(\"idpersona\", $idpersona, \"ver_organizacion\");\n            $plantilla_tabla->reemplazaEnBloque(\"idmodulo\", $idmodulo, \"ver_organizacion\");\n            $plantilla_tabla->reemplazaEnBloque(\"idpersona_tipo\", $idpersona_tipo, \"ver_organizacion\");\n        }\n\n        //echo \"numero $numero total $ainteraccion[total]\";\n\n        if ($numero > 0) {\n            $plantilla_tabla->reemplaza(\"numero\", $numero);\n            $plantilla_tabla->reemplaza(\"de\", \"de\");\n            $plantilla_tabla->reemplaza(\"total\", $ainteraccion['total']);\n            if ($numero < $ainteraccion['total']) {\n\n                $plantilla_tabla->iniciaBloque(\"ver_mas\");\n                $plantilla_tabla->reemplazaEnBloque(\"inicio\", $inicio + 10, \"ver_mas\");\n                //$plantilla_tabla->reemplazaEnBloque(\"nombre\", $nombre, \"ver_mas\");\n                $plantilla_tabla->reemplazaEnBloque(\"idpersona\", $idpersona, \"ver_mas\");\n                $plantilla_tabla->reemplazaEnBloque(\"idmodulo\", $idmodulo, \"ver_mas\");\n                $plantilla_tabla->reemplazaEnBloque(\"persona\", $persona, \"ver_mas\"); // ver mas\n                $plantilla_tabla->reemplazaEnBloque(\"presenta\", 1, \"ver_mas\"); // ver mas\n                $plantilla_tabla->reemplazaEnBloque(\"modo\", $modo, \"ver_mas\"); // ver mas\n            }\n        }\n\n        if ($numero == 0) {\n            $plantilla_tabla->iniciaBloque(\"mensaje\");\n        }\n\n        $plantilla = $plantilla_tabla;\n    }\n\n\n    if ($presenta == 1) {\n        $plantilla->presentaPlantilla();\n    } elseif ($presenta == 2) {\n        $datos[\"html\"] = $plantilla->getPlantillaCadena();\n        echo json_encode($datos);\n    } else {\n        return $plantilla->getPlantillaCadena();\n    }\n}\n\nfunction eliminar_red_stakeholder($idpersona_red_stakeholder, $idpersona, $idmodulo, $idmodulo_persona_red) {\n\n    $gstake_holder = new gstakeholder();\n    $error = $gstake_holder->eliminar_red($idpersona_red_stakeholder, $idmodulo_persona_red);\n    if ($error == 0) {\n        $data['success'] = true;\n        $data['mensaje'] = coloca_mensaje(\"elimina_ok\", \" de la red \");\n    } else {\n        $data['success'] = false;\n        $data['mensaje'] = coloca_mensaje(\"elimina_error\", \" de la red\");\n    }\n    echo json_encode($data);\n    //ver_editar_red_stakeholder($idpersona, $idmodulo);\n}\n\nfunction guardar_red_stakeholder($idpersona_compuesto_red, $idpersona, $idmodulo) {\n\n    $idmodulo_a = $_SESSION[idmodulo_a];\n    $apersona_red = split(\"---\", $idpersona_compuesto_red);\n    $idpersona_red = $apersona_red[0];\n    $idmodulo_red = $apersona_red[1];\n    $gstakeholder = new gstakeholder();\n    $error = $gstakeholder->agregar_red($idpersona, $idmodulo, $idpersona_red, $idmodulo_red, $idmodulo_a);\n\n\n    if ($error == 0) {\n        $data['success'] = true;\n        $data['mensaje'] = coloca_mensaje(\"guarda_ok\", \" de la red \");\n    } else {\n        $data['success'] = false;\n        $data['mensaje'] = coloca_mensaje(\"guarda_error\", \" de la red\");\n    }\n    echo json_encode($data);\n    //ver_editar_red_stakeholder($idpersona,$idmodulo);\n}\n\nfunction guardar_predio_stakeholder($idpredio, $idpersona, $idmodulo) {\n\n    $idmodulo_predio_sh = $_SESSION[idmodulo];\n\n    $gstakeholder = new gstakeholder();\n    $error = $gstakeholder->agregar_predio($idpersona, $idmodulo, $idpredio, $idmodulo_predio_sh);\n\n\n    if ($error == 0) {\n        $data['success'] = true;\n        $data['mensaje'] = coloca_mensaje(\"guarda_ok\", \" del predio \");\n    } else {\n        $data['success'] = false;\n        $data['mensaje'] = coloca_mensaje(\"guarda_error\", \" del predio \");\n    }\n    echo json_encode($data);\n    //ver_editar_red_stakeholder($idpersona,$idmodulo);\n}\n\nfunction ver_editar_red_stakeholder($idpersona, $idmodulo) {\n\n    $seguridad = new Seguridad();\n\n    $plantilla = new DmpTemplate(\"../../../plantillas/stakeholder/stakeholder/red.html\");\n\n    if ($seguridad->verifica_permiso(\"Crear\", \"Stakeholder-Redes\")) {\n        $plantilla->iniciaBloque(\"crear_red_stakeholder\");\n    }\n\n    $istakeholder = new istakeholder();\n    $persona = new ipersona();\n    $result_stakeholder = $istakeholder->lista_stakeholder_red($idpersona, $idmodulo);\n\n    if (mysql_num_rows($result_stakeholder)) {\n        while (!!$fila = mysql_fetch_array($result_stakeholder)) {\n\n            //stakeholder\n            $plantilla->iniciaBloque(\"detalle_red\");\n            $nombre_stakeholder = \"\";\n            if ($fila[nombre] != \"\") {\n                $nombre_stakeholder = $fila[nombre];\n            }\n            $nombre_stakeholder = $nombre_stakeholder . \" \" . $fila[apellido_p] . \" \" . $fila[apellido_m];\n            $plantilla->reemplazaEnBloque('nombre_stakeholder', $fila[apellido_p] . \" \" . $fila[apellido_m] . \", \" . $fila[nombre], \"detalle_red\");\n            $plantilla->reemplazaEnBloque(\"idpersona\", $fila[idpersona_red], \"detalle_red\");\n            $plantilla->reemplazaEnBloque(\"idmodulo\", $fila[idmodulo_red], \"detalle_red\");\n            $plantilla->reemplazaEnBloque(\"idpersona_tipo\", $fila[idpersona_tipo], \"detalle_red\");\n\n            if ($fila[imagen] != \"\") {\n                $plantilla->reemplazaEnBloque(\"imagen\", \"../../../archivo/\" . $_SESSION['proyecto'] . \"/imagen/\" . $fila[imagen], \"detalle_red\");\n            } else {\n                $plantilla->reemplazaEnBloque(\"imagen\", \"../../../img/imagen.png\", \"detalle_red\");\n            }\n\n            //organizacion\n            /* $apersona_organizacion=$persona->get_persona_organizacion($fila[idpersona_red], $fila[idmodulo_red]);\n              while(!!$fila_organizacion=mysql_fetch_array($apersona_organizacion)){\n              organizacion\n              $plantilla->iniciaBloque(\"organizacion\");\n              $plantilla->reemplazaEnBloque(\"organizacion\",$fila_organizacion[razon_social].\" (\".$fila_organizacion[nombre_comercial].\")\",\"organizacion\");\n              $plantilla->reemplazaEnBloque(\"cargo\",$fila_organizacion[cargo],\"organizacion\");\n              } */\n\n            //tag\n            /* $result_tag=$persona->get_persona_tag($fila[idpersona_red], $fila[idmodulo_red]);\n              $cont_tag=0;\n              while($fila_tag=mysql_fetch_array($result_tag)){\n              if($cont_tag%4==0){\n              $plantilla->iniciaBloque(\"tr_tag\");\n              }\n              $plantilla->iniciaBloque(\"td_tag\");\n\n\n              $plantilla->reemplazaEnBloque(\"tag\", $fila_tag[tag].$entro, \"td_tag\");\n              $cont_tag++;\n              }\n             */\n            //Calificacion\n            $idimension_matriz_sh = new idimension_matriz_sh();\n            $result = $idimension_matriz_sh->lista_dimension_matriz_sh($fila[idpersona_red], $fila[idmodulo_red]);\n            $votos = array();\n            $count = 0;\n            while ($fila1 = mysql_fetch_array($result)) {\n                $count++;\n                $votos[$fila1[iddimension_matriz_sh]] = $fila1;\n            }\n\n            $valor1 = ruta_images . \"00.png\";\n            $valor2 = ruta_images . \"0.png\";\n            $valor3 = ruta_images . \"0.png\";\n\n            if ($count > 0) {\n\n                $valor1 = ruta_images . $votos[1][valor];\n                $valor2 = ruta_images . $votos[2][valor];\n                $valor3 = ruta_images . $votos[3][valor];\n            }\n\n            $plantilla->iniciaBloque(\"tr_calificacion\");\n            $plantilla->reemplazaEnBloque(\"posicion\", $valor1, \"tr_calificacion\");\n            $plantilla->reemplazaEnBloque(\"idpersona\", $fila[idpersona_red], \"tr_calificacion\");\n            $plantilla->reemplazaEnBloque(\"idmodulo\", $fila[idmodulo_red], \"tr_calificacion\");\n            $plantilla->reemplazaEnBloque('idpersona_red_stakeholder', $fila[idred], \"tr_calificacion\");\n            $plantilla->reemplazaEnBloque('idmodulo_persona_red', $fila[idmodulo_persona_red], \"tr_calificacion\");\n\n\n            $plantilla->iniciaBloque(\"tr_dimension\");\n            $plantilla->reemplazaEnBloque(\"valor\", $valor2, \"tr_dimension\");\n\n            $plantilla->iniciaBloque(\"tr_dimension\");\n            $plantilla->reemplazaEnBloque(\"valor\", $valor3, \"tr_dimension\");\n\n            if ($seguridad->verifica_permiso(\"Editar\", \"Stakeholder-Redes\")) {\n                $plantilla->iniciaBloque(\"eliminar_red_stakeholder\");\n                $plantilla->reemplazaEnBloque('idpersona_red_stakeholder', $fila[idred], \"eliminar_red_stakeholder\");\n                $plantilla->reemplazaEnBloque('idmodulo_persona_red', $fila[idmodulo_persona_red], \"eliminar_red_stakeholder\");\n            }\n        }\n    }\n\n\n    $plantilla->presentaPlantilla();\n}\n\nfunction ver_editar_predio_stakeholder($idpersona, $idmodulo, $idmapa) {\n\n    $seguridad = new Seguridad();\n\n    $plantilla = new DmpTemplate(\"../../../plantillas/stakeholder/stakeholder/predio.html\");\n\n    $plantilla->iniciaBloque(\"asignar_predio_stakeholder\");\n\n    $istakeholder = new istakeholder();\n\n    $apredio = $istakeholder->lista_stakeholder_predio($idpersona, $idmodulo, $idmapa);\n\n    $num = 0;\n    foreach ($apredio['idpredio'] as $key => $predio) {\n\n        //stakeholder\n        $num++;\n        $plantilla->iniciaBloque(\"detalle_predio\");\n\n        $akey = explode('***', $key);\n        $plantilla->reemplazaEnBloque('idpredio', $akey[0], \"detalle_predio\");\n        $plantilla->reemplazaEnBloque('idmodulo_predio', $akey[1], \"detalle_predio\");\n        $plantilla->reemplazaEnBloque('numero', $num, \"detalle_predio\");\n        $plantilla->reemplazaEnBloque('nombre_predio', $predio, \"detalle_predio\");\n        $plantilla->reemplazaEnBloque('direccion', $apredio['direccion'][$key], \"detalle_predio\");\n        $fid_string = ' ';\n        $aux = 0;\n        //print_r($apredio['idgis_item']);\n        foreach ($apredio['idgis_item_predio'][$key] as $item_key => $idgis_item) {\n            //echo $idgis_item;\n            $aux++;\n            $fid_string.=\"$idgis_item\";\n            if ($aux < count($apredio['idgis_item_predio'][$key])) {\n                $fid_string.=\",\";\n            }\n        }\n\n        $plantilla->reemplazaEnBloque('fid_string', $fid_string, \"detalle_predio\");\n\n        if (sizeof($apredio['tag'][$key]) > 0) {\n            $plantilla->iniciaBloque(\"tag\");\n            $count = 0;\n            foreach ($apredio['tag'][$key] as $tag_key => $tag) {\n                $count++;\n                $plantilla->iniciaBloque(\"detalle_tag\");\n                $plantilla->reemplazaEnBloque('tag', $tag, \"detalle_tag\");\n                if ($count < sizeof($apredio['tag'][$key])) {\n                    $plantilla->reemplazaEnBloque('coma', \" , \", \"detalle_tag\");\n                } else {\n                    $plantilla->reemplazaEnBloque('coma', \" . \", \"detalle_tag\");\n                }\n            }\n        }\n\n        //imagenes\n        if (sizeof($apredio['archivo'][$key]) > 0) {\n\n            foreach ($apredio['archivo'][$key] as $archivo_key => $archivo) {\n                $thumbfile = dirname(dirname(dirname(dirname(__FILE__)))) . DIRECTORY_SEPARATOR . \"archivo\" . DIRECTORY_SEPARATOR . $_SESSION['proyecto'] . DIRECTORY_SEPARATOR . \"predio\" . DIRECTORY_SEPARATOR . \"thumbnail\" . DIRECTORY_SEPARATOR . $key . '_' . $archivo;\n                $thumb = new thumb();\n                if ($thumb->loadImage($thumbfile)) {\n                    $plantilla->iniciaBloque(\"imagen\");\n                    $plantilla->reemplazaEnBloque(\"proyecto\", $_SESSION['proyecto'], \"imagen\");\n                    $plantilla->reemplazaEnBloque(\"archivo\", $key . '_' . $archivo, \"imagen\");\n                    $plantilla->reemplazaEnBloque(\"nombre\", $archivo, \"imagen\");\n                }\n            }\n        }\n\n        $archivos = array();\n        //archivos\n        if (sizeof($apredio['archivo'][$key]) > 0) {\n\n            foreach ($apredio['archivo'][$key] as $archivo_key => $archivo) {\n                $thumbfile = dirname(dirname(dirname(dirname(__FILE__)))) . DIRECTORY_SEPARATOR . \"archivo\" . DIRECTORY_SEPARATOR . $_SESSION['proyecto'] . DIRECTORY_SEPARATOR . \"predio\" . DIRECTORY_SEPARATOR . \"thumbnail\" . DIRECTORY_SEPARATOR . $key . '_' . $archivo;\n                $thumb = new thumb();\n                if (!$thumb->loadImage($thumbfile)) {\n                    $archivos[] = $key . '_' . $archivo;\n                }\n            }\n            $aux = 0;\n            foreach ($archivos as $archivo) {\n                $aux++;\n                $plantilla->iniciaBloque(\"archivo\");\n                $plantilla->reemplazaEnBloque(\"archivo\", $archivo, \"archivo\");\n                if ($aux < count($archivos)) {\n                    $plantilla->reemplazaEnBloque(\"coma\", \" , \", \"archivo\");\n                }\n            }\n        }\n    }\n    $fid_string = ' ';\n    $aux = 0;\n    //print_r($apredio['idgis_item']);\n    foreach ($apredio['idgis_item'] as $key => $idgis_item) {\n        //echo $idgis_item;\n        $aux++;\n        $fid_string.=\"$idgis_item\";\n        if ($aux < count($apredio['idgis_item'])) {\n            $fid_string.=\",\";\n        }\n    }\n\n    $plantilla->reemplazaEnBloque('fid_string', $fid_string, \"detalle_predio\");\n\n    $plantilla->reemplaza(\"ver_mapa\", ver_buscar_mapa($fid_string, 0, $idmapa));\n\n    $plantilla->presentaPlantilla();\n}\n\nfunction ver_reporte_predio_entidad($entidad, $identidad, $idmodulo) {\n\n    $seguridad = new Seguridad();\n\n\n\n\n    $istakeholder = new istakeholder();\n\n    $apredio = $istakeholder->lista_predio_entidad($entidad, $identidad, $idmodulo);\n\n    $fid_string = ' ';\n    $aux = 0;\n    //print_r($apredio['idgis_item']);\n    foreach ($apredio['idgis_item'] as $key => $idgis_item) {\n        //echo $idgis_item;\n        $aux++;\n        $fid_string.=\"$idgis_item\";\n        if ($aux < count($apredio['idgis_item'])) {\n            $fid_string.=\",\";\n        }\n    }\n\n    //echo $fid_string;\n\n    ver_buscar_mapa($fid_string, 1);\n}\n\nfunction ver_predio_entidad($fid_string, $intensidad) {\n\n    $seguridad = new Seguridad();\n\n    $plantilla = new DmpTemplate(\"../../../plantillas/stakeholder/mapa/ver_mapa.html\");\n\n    ver_buscar_mapa($fid_string, 1, 0, $intensidad);\n}\n\nfunction ver_tab_stakeholder($idpersona = \"\", $idmodulo = \"\", $idpersona_tipo = \"\", $idpersona_compuesto = \"\") {\n    $seguridad = new Seguridad();\n    $plantilla = new DmpTemplate(\"../../../plantillas/stakeholder/stakeholder/tab.html\");\n    $apersona = split(\"---\", $idpersona_compuesto);\n    $idpersona = $apersona[0];\n    $idmodulo = $apersona[1];\n    $idpersona_tipo = $apersona[2]; // ver si carga persona u organizacion\n    $plantilla->reemplaza(\"idpersona\", $idpersona);\n    $plantilla->reemplaza(\"idmodulo\", $idmodulo);\n    $plantilla->reemplaza(\"idpersona_tipo\", $idpersona_tipo);\n\n    if ($seguridad->verifica_permiso(\"Ver\", \"Stakeholder-Redes\")) {\n        $plantilla->iniciaBloque(\"ver_red_stakeholder\");\n        $plantilla->reemplazaEnBloque(\"idpersona\", $idpersona, \"ver_red_stakeholder\");\n        $plantilla->reemplazaEnBloque(\"idmodulo\", $idmodulo, \"ver_red_stakeholder\");\n    }\n\n    $plantilla->presentaPlantilla();\n}\n\nfunction ver_tag_stakeholder($idpersona, $idmodulo) {\n    $seguridad = new Seguridad();\n\n    $plantilla_ver_tag = new DmpTemplate(\"../../../plantillas/stakeholder/stakeholder/ver_tag.html\");\n    $persona = new ipersona();\n    $result_tag = $persona->get_persona_tag($idpersona, $idmodulo);\n    $cont_tag = 0;\n\n\n    while ($fila_tag = mysql_fetch_array($result_tag)) {\n\n        if ($cont_tag % 4 == 0) {\n            $plantilla_ver_tag->iniciaBloque(\"tr_tag\");\n        }\n        $plantilla_ver_tag->iniciaBloque(\"td_tag\");\n\n        $plantilla_ver_tag->reemplazaEnBloque(\"tag\", utf8_encode($fila_tag[tag]), \"td_tag\");\n        $plantilla_ver_tag->reemplazaEnBloque(\"prioridad\", $fila_tag[prioridad], \"td_tag\");\n        $plantilla_ver_tag->reemplazaEnBloque(\"idmodulo_tag\", $fila_tag[idmodulo_tag], \"td_tag\");\n        $plantilla_ver_tag->reemplazaEnBloque(\"idtag\", $fila_tag[idtag], \"td_tag\");\n\n        $cont_tag++;\n    }\n\n    if ($seguridad->verifica_permiso(\"Editar\", \"Stakeholder\", $fila[idusu_c], $fila[idmodulo_c]))\n        $plantilla_ver_tag->iniciaBloque(\"editar_tag_sh\");\n\n\n    $plantilla_ver_tag->presentaPlantilla();\n}\n\nfunction ver_editar_tag_stakeholder($idpersona, $idmodulo) {\n    $seguridad = new Seguridad();\n    $plantilla_editar_tag = new DmpTemplate(\"../../../plantillas/stakeholder/stakeholder/editar_tag.html\");\n    $persona = new ipersona();\n    $result_tag = $persona->get_persona_tag($idpersona, $idmodulo);\n    $cont_tag = 0;\n    $cont_tag_fila = 0;\n\n    while ($fila_tag = mysql_fetch_array($result_tag)) {\n\n        if ($cont_tag % 5 == 0) {\n            $plantilla_editar_tag->iniciaBloque(\"tr_editar_tag\");\n            $cont_tag_fila++;\n            $cont_tag_celda = 0;\n        }\n\n        $plantilla_editar_tag->iniciaBloque(\"td_editar_tag\");\n\n        //print_r($fila_tag);\n        $plantilla_editar_tag->reemplazaEnBloque(\"idpersona_tag\", $fila_tag[idpersona_tag], \"td_editar_tag\");\n        $plantilla_editar_tag->reemplazaEnBloque(\"idmodulo_persona_tag\", $fila_tag[idmodulo_persona_tag], \"td_editar_tag\");\n        $plantilla_editar_tag->reemplazaEnBloque(\"idpersona\", $idpersona, \"td_editar_tag\");\n        $plantilla_editar_tag->reemplazaEnBloque(\"idmodulo\", $idmodulo, \"td_editar_tag\");\n        $plantilla_editar_tag->reemplazaEnBloque(\"idtag\", $fila_tag[idtag], \"td_editar_tag\");\n        $plantilla_editar_tag->reemplazaEnBloque(\"tag\", utf8_encode($fila_tag[tag]), \"td_editar_tag\");\n        $plantilla_editar_tag->reemplazaEnBloque(\"idmodulo_tag\", $fila_tag[idmodulo_tag], \"td_editar_tag\");\n        $plantilla_editar_tag->reemplazaEnBloque(\"celda_nume_fila\", $cont_tag_fila, \"td_editar_tag\");\n        $plantilla_editar_tag->reemplazaEnBloque(\"celda_nume_celda\", $cont_tag_celda, \"td_editar_tag\");\n        if ($seguridad->verifica_permiso(\"Editar\", \"Tag\", $fila_tag[idusu_c], $fila_tag[idmodulo_c])) {\n            $plantilla_editar_tag->iniciaBloque(\"editar_tag\");\n            $plantilla_editar_tag->reemplazaEnBloque(\"tag\", $fila_tag[tag], \"editar_tag\");\n            $plantilla_editar_tag->reemplazaEnBloque(\"idmodulo_tag\", $fila_tag[idmodulo_tag], \"editar_tag\");\n            $plantilla_editar_tag->reemplazaEnBloque(\"idtag\", $fila_tag[idtag], \"editar_tag\");\n            $plantilla_editar_tag->reemplazaEnBloque(\"celda_nume_fila\", $cont_tag_fila, \"editar_tag\");\n            $plantilla_editar_tag->reemplazaEnBloque(\"celda_nume_celda\", $cont_tag_celda, \"editar_tag\");\n\n            $plantilla_editar_tag->iniciaBloque(\"spinner_tag\");\n            $plantilla_editar_tag->reemplazaEnBloque(\"prioridad\", $fila_tag[prioridad], \"spinner_tag\");\n\n            $plantilla_editar_tag->reemplazaEnBloque(\"celda_nume_fila\", $cont_tag_fila, \"spinner_tag\");\n            $plantilla_editar_tag->reemplazaEnBloque(\"celda_nume_celda\", $cont_tag_celda, \"spinner_tag\");\n        }\n\n        if ($seguridad->verifica_permiso(\"Eliminar\", \"Tag\", $fila_tag[idusu_c], $fila_tag[idmodulo_c])) {\n            $plantilla_editar_tag->iniciaBloque(\"eliminar_tag\");\n            $plantilla_editar_tag->reemplazaEnBloque(\"idpersona_tag\", $fila_tag[idpersona_tag], \"eliminar_tag\");\n            $plantilla_editar_tag->reemplazaEnBloque(\"idmodulo_persona_tag\", $fila_tag[idmodulo_persona_tag], \"eliminar_tag\");\n            $plantilla_editar_tag->reemplazaEnBloque(\"stakeholder_complejo_tag\", $fila_tag[idpersona_tag] . \"***\" . $fila_tag[idmodulo_persona_tag] . \"***1\", \"eliminar_tag\");\n\n            $plantilla_editar_tag->reemplazaEnBloque(\"celda_nume_fila\", $cont_tag_fila, \"eliminar_tag\");\n            $plantilla_editar_tag->reemplazaEnBloque(\"celda_nume_celda\", $cont_tag_celda, \"eliminar_tag\");\n        }\n\n        $cont_tag++;\n        $cont_tag_celda++;\n    }\n\n    ////antes coloco el numero real de celdas y filas\n    $plantilla_editar_tag->reemplaza(\"nume_fila_stakeholder_tag_complejo\", $cont_tag_fila);\n    $plantilla_editar_tag->reemplaza(\"nume_celda_stakeholder_tag_complejo\", $cont_tag_celda);\n\n    ///\n    while ($cont_tag_celda < 5) {\n        $plantilla_editar_tag->iniciaBloque(\"td_editar_tag\");\n        $plantilla_editar_tag->reemplazaEnBloque(\"tag\", \"&nbsp;\", \"td_editar_tag\");\n        $plantilla_editar_tag->reemplazaEnBloque(\"celda_nume_fila\", $cont_tag_fila, \"td_editar_tag\");\n        $plantilla_editar_tag->reemplazaEnBloque(\"celda_nume_celda\", $cont_tag_celda, \"td_editar_tag\");\n\n        $cont_tag_celda++;\n    }\n\n\n    $plantilla_editar_tag->presentaPlantilla();\n}\n\nfunction guardar_tag_stakeholder($idstakeholder_complejo_tag, $orden_complejo_tag, $idpersona, $idmodulo) {\n    $idmodulo_a = $_SESSION[idmodulo_a];\n\n    //echo \"ver \".$idtag_compuesto.\" \".$atag[0].\" \".$atag[1];\n    $gstake_holder = new gstakeholder();\n\n    $respuesta = $gstake_holder->agregar_tag_complejo($idstakeholder_complejo_tag, $orden_complejo_tag, $idpersona, $idmodulo, $idmodulo_a);\n    //ver_tag_stakeholder($idpersona, $idmodulo,$idtag_compuesto);\n    if ($respuesta == 0) {\n        $data['success'] = true;\n        $data['mensaje'] = coloca_mensaje(\"guarda_ok\", \" del tag \");\n    } else {\n        $data['success'] = false;\n        $data['mensaje'] = coloca_mensaje(\"guarda_error\", \" del tag\");\n    }\n    echo json_encode($data);\n}\n\nfunction eliminar_tag_stakeholder($idpersona_tag, $idpersona, $idmodulo, $idmodulo_persona_tag) {\n\n    $gstake_holder = new gstakeholder();\n\n    $respuesta = $gstake_holder->eliminar_tag($idpersona_tag, $idmodulo_persona_tag);\n\n    if ($respuesta == 0) {\n        $data['success'] = true;\n        $data['mensaje'] = coloca_mensaje(\"elimina_ok\", \" del tag \");\n    } else {\n        $data['success'] = false;\n        $data['mensaje'] = coloca_mensaje(\"elimina_error\", \" del tag\");\n    }\n    echo json_encode($data);\n\n    //ver_tag_stakeholder($idpersona, $idmodulo);\n}\n\nfunction busqueda_rapida_predio_stakeholder($busca_rapida_predio_stakeholder) {\n    $arrayElementos = array();\n    $stakeholder = new istakeholder();\n    $ayudante = new Ayudante();\n    $busca_rapida_predio_stakeholder = $ayudante->caracter($busca_rapida_predio_stakeholder);\n\n    $result_predio = $stakeholder->lista_predio($busca_rapida_predio_stakeholder);\n    //if(mysql_num_rows($result_stakeholder)>0){\n\n    $count = 0;\n    while ($fila = mysql_fetch_array($result_predio)) {\n        $count++;\n        array_push($arrayElementos, new autocompletar(utf8_encode($fila[\"nombre\"]), $fila[\"idpredio\"]));\n    }\n    //}else{\n    //}\n    //array_push($arrayElementos, new autocompletar(utf8_encode(\" -- NUEVO STAKEHOLDER --\"), 'nuevo_stake_holder'));\n    if ($count == 0)\n        array_push($arrayElementos, new autocompletar(utf8_encode(\"No se hallaron resultados\"), 'nuevo_stake_holder'));\n\n    print_r(json_encode($arrayElementos));\n    //json_encode($arrayElementos);\n}\n\nfunction ver_cuerpo_inicial($idpersona, $idmodulo, $nombre, $modo) {\n    $seguridad = new Seguridad();\n    echo \"<br/><div id='cargando' style='width: 100px; margin:0 auto;'><img src='../../../img/bar-ajax-loader.gif'></div><br/>\";\n    flush();\n    $plantilla = new DmpTemplate(\"../../../plantillas/stakeholder/stakeholder/cuerpo.html\");\n\n    $dias = array(\"Domingo\", \"Lunes\", \"Martes\", \"Miercoles\", \"Jueves\", \"Viernes\", \"Sabado\");\n    $meses = array(\"\", \"Enero\", \"Febrero\", \"Marzo\", \"Abril\", \"Mayo\", \"Junio\", \"Julio\", \"Agosto\", \"Setiembre\", \"Octubre\", \"Noviembre\", \"Diciembre\");\n    //$tiempo =\"Bienvenido \".date(\"G\");\n\n    if (date(\"G\") >= 4 && date(\"G\") <= 11) {\n        $tiempo = \"Buenos d&iacute;as \";\n    }\n    if (date(\"G\") > 11 && date(\"G\") <= 19) {\n        $tiempo = \"Buenas tardes \";\n    }\n    if (date(\"G\") > 19 && date(\"G\") <= 24) {\n        $tiempo = \"Buenas noches \";\n    }\n    $plantilla->reemplaza(\"version\", version);\n    $plantilla->reemplaza(\"idpersona\", $_SESSION[idpersona]);\n    $plantilla->reemplaza(\"idusuario\", $_SESSION[idusuario]);\n    $plantilla->reemplaza(\"idmodulo\", $_SESSION[idmodulo_persona]);\n    $plantilla->reemplaza(\"idmodulo_usuario\", $_SESSION[idmodulo_usuario]);\n    $plantilla->reemplaza(\"quien\", \"<span style=\\\"font-weight: normal;\\\">\" . $tiempo . \"</span>\" . substr($_SESSION[nombre], 0, 12) . \" <span style=\\\"font-weight: normal;\\\">bienvenido a</span> \" . strtoupper($_SESSION['proyecto']));\n    $plantilla->reemplaza(\"fecha\", $dias[date('w')] . \", \" . date(\"j\") . \" de \" . $meses[date('n')] . \" del \" . date(\"Y\"));\n    $plantilla->reemplaza(\"sesion\", $_SESSION[sesion]);\n    $plantilla->reemplaza(\"idproyecto\", $_SESSION[idproyecto]);\n    $plantilla->reemplaza(\"zona\", date_default_timezone_get());\n\n\n    if ($seguridad->verifica_permiso(\"Crear\", \"Relacionista\"))\n        $plantilla->iniciaBloque(\"crear_rc\");\n\n    if ($seguridad->verifica_permiso(\"Crear\", \"Stakeholder\"))\n        $plantilla->iniciaBloque(\"crear_sh\");\n\n    if ($seguridad->verifica_permiso(\"Crear\", \"Tag\"))\n        $plantilla->iniciaBloque(\"crear_tag\");\n\n    if ($seguridad->verifica_permiso(\"Crear\", \"Interaccion\"))\n        $plantilla->iniciaBloque(\"crear_interaccion\");\n\n    if ($seguridad->verifica_permiso(\"Crear\", \"Reclamo\"))\n        $plantilla->iniciaBloque(\"crear_reclamo\");\n\n\n\n    if ($seguridad->verifica_permiso(\"Ver\", \"Sincronizacion\"))\n        $plantilla->iniciaBloque(\"ver_sincronizacion\");\n\n    if ($seguridad->verifica_permiso(\"Ver\", \"Stakeholder-Estadistico\"))\n        $plantilla->iniciaBloque(\"ver_stakeholder_estadistico\");\n\n    if ($seguridad->verifica_permiso(\"Ver\", \"Stakeholder-Interes-Poder\"))\n        $plantilla->iniciaBloque(\"ver_interes_poder\");\n\n    if ($seguridad->verifica_permiso(\"Ver\", \"Stakeholder-Posicion-Importancia\"))\n        $plantilla->iniciaBloque(\"ver_posicion_importancia\");\n\n    if ($seguridad->verifica_permiso(\"Ver\", \"Stakeholder-Posicion-Tiempo\"))\n        $plantilla->iniciaBloque(\"ver_posicion_tiempo\");\n\n    if ($seguridad->verifica_permiso(\"Ver\", \"Stakeholder-Interaccion-Tiempo\"))\n        $plantilla->iniciaBloque(\"ver_interaccion_tiempo\");\n\n    if ($seguridad->verifica_permiso(\"Ver\", \"Stakeholder-Buscar-Interaccion\"))\n        $plantilla->iniciaBloque(\"ver_buscar_interaccion\");\n\n    if ($seguridad->verifica_permiso(\"Ver\", \"Stakeholder-Buscar-Compromiso\"))\n        $plantilla->iniciaBloque(\"ver_buscar_compromiso\");\n\n    if ($seguridad->verifica_permiso(\"Ver\", \"Reclamo-Estadistico\"))\n        $plantilla->iniciaBloque(\"ver_reclamo_estadistico\");\n\n    if ($seguridad->verifica_permiso(\"Ver\", \"Reclamo-Buscar\"))\n        $plantilla->iniciaBloque(\"ver_reclamo_buscar\");\n\n    if ($seguridad->verifica_permiso(\"Administrar\", \"Usuario-Rol\"))\n        $plantilla->iniciaBloque(\"ver_rol\");\n\n\n    if (!isset($modo)) {\n        $modo = 1;\n    }\n\n    //\n\n    if (isset($nombre) && $nombre != \"\") {\n        $plantilla->reemplaza(\"cuerpo_interaccion\", ver_bloque_interaccion(1, $nombre, $idpersona, $idmodulo, 50, 2, 0, $modo)); //persona 2 ve las interacciones del relacionista comunitario\n    } else {\n        $plantilla->reemplaza(\"cuerpo_interaccion\", ver_bloque_interaccion($_SESSION[\"idpersona_tipo\"], $_SESSION[nombre], $_SESSION[idpersona], $_SESSION[idmodulo_a], 50, 2, 0, $modo)); //persona 2 ve las interacciones del relacionista comunitario\n    }\n\n    echo $plantilla->getPlantillaCadena();\n}\n\nfunction ver_cabecera_stakeholder($idpersona = \"\", $idmodulo = \"\", $idpersona_compuesto = \"\") {\n\n    $seguridad = new Seguridad();\n\n    if ($idpersona_compuesto != \"\") {\n        $apersona_compuesto = split(\"---\", $idpersona_compuesto);\n        $idpersona = $apersona_compuesto[0];\n        $idmodulo = $apersona_compuesto[1];\n    }\n    $plantilla_cabecera = new DmpTemplate(\"../../../plantillas/stakeholder/stakeholder/cabecera.html\");\n    $plantilla_cuerpo_cabecera_tag = new DmpTemplate(\"../../../plantillas/stakeholder/stakeholder/cuerpo_cabecera_tag.html\");\n    $plantilla_ver_tag = new DmpTemplate(\"../../../plantillas/stakeholder/stakeholder/ver_tag.html\");\n    $plantilla_cabecera->reemplaza(\"idpersona\", $idpersona);\n    $plantilla_cabecera->reemplaza(\"idmodulo\", $idmodulo);\n    $persona = new ipersona();\n    $result_persona = $persona->get_persona($idpersona, $idmodulo);\n\n\n    if ($fila = mysql_fetch_array($result_persona)) {\n        $nombre_stakeholder = \"\";\n        if ($fila[nombre] != \"\") {\n            $nombre_stakeholder = $fila[nombre];\n        }\n        $nombre_stakeholder = $nombre_stakeholder . \" \" . $fila[apellido_p] . \" \" . $fila[apellido_m];\n        if ($fila[idpersona_tipo] > 1) {\n            $nombre_stakeholder = $fila[apellido_p];\n        }\n        $plantilla_cabecera->reemplaza('nombre_stakeholder', utf8_encode($nombre_stakeholder));\n\n        $result_organizacion = $persona->get_persona_organizacion($idpersona, $idmodulo);\n\n        while ($fila_organizacion = mysql_fetch_array($result_organizacion)) {\n            $plantilla_cabecera->iniciaBloque(\"organizacion\");\n            if ($fila_organizacion[apellido_m] != \"\") {\n                $nombre_comercial = \" (\" . $fila_organizacion[apellido_m] . \")\";\n            }\n            $nombre_organizacion = $fila_organizacion[apellido_p] . $nombre_comercial;\n\n            $plantilla_cabecera->reemplazaEnBloque(\"idpersona\", $fila_organizacion['idorganizacion'], \"organizacion\");\n            $plantilla_cabecera->reemplazaEnBloque(\"idmodulo\", $fila_organizacion['idmodulo_organizacion'], \"organizacion\");\n            $plantilla_cabecera->reemplazaEnBloque(\"idpersona_tipo\", $fila_organizacion['idpersona_tipo'], \"organizacion\");\n            $plantilla_cabecera->reemplazaEnBloque(\"organizacion\", utf8_encode($nombre_organizacion), \"organizacion\");\n            $plantilla_cabecera->reemplazaEnBloque(\"cargo\", utf8_encode($fila_organizacion[cargo]), \"organizacion\");\n        }\n\n        $result_tag = $persona->get_persona_tag($idpersona, $idmodulo);\n        $cont_tag = 0;\n\n        if ($seguridad->verifica_permiso(\"Editar\", \"Stakeholder\", $fila[idusu_c], $fila[idmodulo_c]))\n            $plantilla_ver_tag->iniciaBloque(\"editar_tag_sh\");\n\n        while ($fila_tag = mysql_fetch_array($result_tag)) {\n            if ($cont_tag % 4 == 0) {\n                $plantilla_ver_tag->iniciaBloque(\"tr_tag\");\n                //$plantilla_editar_tag->iniciaBloque(\"tr_editar_tag\");\n            }\n            $plantilla_ver_tag->iniciaBloque(\"td_tag\");\n\n            $plantilla_ver_tag->reemplazaEnBloque(\"tag\", utf8_encode($fila_tag[tag]), \"td_tag\");\n            $plantilla_ver_tag->reemplazaEnBloque(\"prioridad\", $fila_tag[prioridad], \"td_tag\");\n            $plantilla_ver_tag->reemplazaEnBloque(\"idmodulo_tag\", $fila_tag[idmodulo_tag], \"td_tag\");\n            $plantilla_ver_tag->reemplazaEnBloque(\"idtag\", $fila_tag[idtag], \"td_tag\");\n\n\n            $cont_tag++;\n        }\n        if ($fila[imagen] != \"\") {\n            $plantilla_cabecera->reemplaza(\"imagen\", \"../../../archivo/\" . $_SESSION['proyecto'] . \"/imagen/\" . $fila[imagen]);\n        } else {\n            $plantilla_cabecera->reemplaza(\"imagen\", \"../../../img/imagen.png\");\n        }\n\n        $plantilla_cabecera->reemplaza(\"ver_calificacion_stakeholder\", ver_calificacion_stakeholder($idpersona, $idmodulo, $fila[idusu_c], $fila[idmodulo_c]));\n\n        $plantilla_cuerpo_cabecera_tag->reemplaza(\"ver_tag\", $plantilla_ver_tag->getPlantillaCadena());\n\n        $plantilla_cabecera->reemplaza(\"cuerpo_cabecera_tag\", $plantilla_cuerpo_cabecera_tag->getPlantillaCadena());\n    }\n\n    $plantilla_cabecera->presentaPlantilla();\n}\n\nfunction ver_dimension_matriz() {\n    $plantilla = new DmpTemplate(\"../../../plantillas/stakeholder/calificacion/ver_dimension_matriz.html\");\n    $idimension_matriz_sh = new idimension_matriz_sh();\n\n    $result1 = $idimension_matriz_sh->lista_dimension();\n\n    $fila1 = mysql_fetch_array($result1);\n\n    $plantilla->iniciaBloque(\"dimension_relevancia\");\n    $plantilla->reemplazaEnBloque(\"nombre_dimension\", utf8_encode($fila1[dimension]), \"dimension_relevancia\");\n    $plantilla->reemplazaEnBloque(\"id_dimension\", $fila1[iddimension_matriz_sh], \"dimension_relevancia\");\n\n    $result2 = $idimension_matriz_sh->lista_dimension_valor($fila1[iddimension_matriz_sh]);\n    while ($fila2 = mysql_fetch_array($result2)) {\n\n        //print_r($fila2);\n        $plantilla->iniciaBloque(\"dimension_relevancia_valor\");\n        $plantilla->reemplazaEnBloque(\"valor_dimension\", $fila2[valor], \"dimension_relevancia_valor\");\n        $plantilla->reemplazaEnBloque(\"ruta_dimension\", ruta_images, \"dimension_relevancia_valor\");\n        $plantilla->reemplazaEnBloque(\"iddimension_matriz\", $fila2[iddimension_matriz_sh_valor], \"dimension_relevancia_valor\");\n        $plantilla->reemplazaEnBloque(\"id_dimension\", $fila1[iddimension_matriz_sh], \"dimension_relevancia_valor\");\n    }\n\n\n    while ($fila1 = mysql_fetch_array($result1)) {\n\n        $plantilla->iniciaBloque(\"dimension_matriz_sh\");\n        $plantilla->reemplazaEnBloque(\"nombre_dimension\", $fila1[dimension], \"dimension_matriz_sh\");\n        $plantilla->reemplazaEnBloque(\"id_dimension\", $fila1[iddimension_matriz_sh], \"dimension_matriz_sh\");\n\n        $result2 = $idimension_matriz_sh->lista_dimension_valor($fila1[iddimension_matriz_sh]);\n        while ($fila2 = mysql_fetch_array($result2)) {\n\n            //print_r($fila2);\n            $plantilla->iniciaBloque(\"dimension_matriz_sh_valor\");\n            $plantilla->reemplazaEnBloque(\"valor_dimension\", $fila2[valor], \"dimension_matriz_sh_valor\");\n            $plantilla->reemplazaEnBloque(\"ruta_dimension\", ruta_images, \"dimension_matriz_sh_valor\");\n            $plantilla->reemplazaEnBloque(\"iddimension_matriz\", $fila2[iddimension_matriz_sh_valor], \"dimension_matriz_sh_valor\");\n            $plantilla->reemplazaEnBloque(\"id_dimension\", $fila1[iddimension_matriz_sh], \"dimension_matriz_sh_valor\");\n        }\n    }\n\n    $plantilla->presentaPlantilla();\n    //return $plantilla->getPlantillaCadena();\n}\n\nfunction guardar_calificacion_stakeholder($idpersona, $idmodulo, $fecha, $dimension, $comentario) {\n\n    $gdimension_matriz_sh = new gdimension_matriz_sh();\n\n    $idmodulo_a = $_SESSION[idmodulo_a];\n\n    $respuesta = $gdimension_matriz_sh->agregar_calificacion($idpersona, $idmodulo, $idmodulo_a, $fecha, $dimension, $comentario);\n\n    if ($respuesta == 0) {\n        $data['success'] = true;\n        $data['mensaje'] = coloca_mensaje(\"guarda_ok\", \" del voto \");\n    } else {\n        $data['success'] = false;\n        $data['mensaje'] = coloca_mensaje(\"guarda_error\", \" del voto\");\n    }\n    echo json_encode($data);\n\n    //echo ver_calificacion_stakeholder($idpersona, $idmodulo);\n}\n\nfunction eliminar_calificacion_stakeholder($idpersona, $idmodulo, $idsh_dimension, $idmodulo_sh_dimension) {\n    $gdimension_matriz_sh = new gdimension_matriz_sh();\n    //echo (\"idpersona: $idpersona,idmodulo: $idmodulo,idsh_dimension: $idsh_dimension,idmodulo_sh_dimension: $idmodulo_sh_dimension\");\n    $respuesta = $gdimension_matriz_sh->eliminar_calificacion($idpersona, $idmodulo, $idsh_dimension, $idmodulo_sh_dimension);\n    if ($respuesta == 0) {\n        $data['success'] = true;\n        $data['mensaje'] = coloca_mensaje(\"elimina_ok\", \" del voto \");\n    } else {\n        $data['success'] = false;\n        $data['mensaje'] = coloca_mensaje(\"elimina_error\", \" del voto\");\n    }\n    echo json_encode($data);\n}\n\nfunction refrescar_tag_stakeholder($idpersona, $idmodulo) {\n\n    ver_tag_stakeholder($idpersona, $idmodulo);\n}\n\nfunction ver_analisis_red($idpersona, $idmodulo, $rango_fecha) {\n    $plantilla1 = new DmpTemplate(\"../../../plantillas/stakeholder/stakeholder/analisis_red.html\");\n    $plantilla2 = new DmpTemplate(\"../../../plantillas/stakeholder/stakeholder/legend.html\");\n    $plantilla3 = new DmpTemplate(\"../../../plantillas/stakeholder/stakeholder/tabla_analisis_red.html\");\n\n    $idimension_matriz_sh = new idimension_matriz_sh();\n\n    $result1 = $idimension_matriz_sh->lista_dimension();\n\n\n    $count = 0;\n\n    while ($fila1 = mysql_fetch_array($result1)) {\n\n        $count++;\n\n        $plantilla2->iniciaBloque(\"dimension_sh\");\n        $plantilla2->reemplazaEnBloque(\"dimension\", $fila1[dimension], \"dimension_sh\");\n\n\n        $result2 = $idimension_matriz_sh->lista_dimension_puntaje($fila1[iddimension_matriz_sh]);\n        while ($fila2 = mysql_fetch_array($result2)) {\n\n            //print_r($fila2);\n            $plantilla2->iniciaBloque(\"dimension_sh_valor\");\n            $plantilla2->reemplazaEnBloque(\"comentario\", $fila2[comentario], \"dimension_sh_valor\");\n            if ($count == 1) {\n                $plantilla2->reemplazaEnBloque(\"valor\", $fila2[valor], \"dimension_sh_valor\");\n                $plantilla2->reemplazaEnBloque(\"ruta\", ruta_images, \"dimension_sh_valor\");\n            }\n            if ($count > 1) {\n                $plantilla2->reemplazaEnBloque(\"puntaje\", $fila2[puntaje], \"dimension_sh_valor\");\n            }\n        }\n    }\n    $plantilla1->reemplaza(\"legend\", $plantilla2->getPlantillaCadena());\n\n    $format = 'YW';\n\n    $date = date($format);\n\n    $days = array();\n\n    $dia = date('d/m/y');\n    $dia_aux = date('d-m-Y');\n    // - 7 days from today\n\n    for ($i = 1; $i < 7; $i++) {\n\n        $days[] = $date;\n        $plantilla3->iniciaBloque(\"td_fecha\");\n        $plantilla3->reemplazaEnBloque(\"fecha\", $dia, \"td_fecha\");\n        $dia = date('d/m/y', strtotime(\"-$rango_fecha week\" . $dia_aux));\n        $date = date($format, strtotime($dia));\n    }\n\n    $persona = new ipersona();\n    $result = $persona->get_analisis_red_semana($idpersona, $idmodulo);\n\n    $results = array();\n\n    while ($fila = mysql_fetch_array($result)) {\n        $results[] = $fila;\n    }\n\n    $result = $persona->get_persona($idpersona, $idmodulo);\n\n    //print_r($results);\n    $nombre = \"\";\n    if ($fila = mysql_fetch_array($result)) {\n        if ($fila[idpersona_tipo] > 1) {\n            $nombre = $fila[apellido_p];\n        } else {\n            $nombre = $fila[apellido_p] . \" \" . $fila[apellido_m] . \", \" . $fila[nombre];\n        }\n    }\n\n    $comentario = \"\";\n\n    foreach ($days as $day) {\n\n        $valor_1 = \"00.png\";\n        $puntaje_2 = \"?\";\n        $puntaje_3 = \"?\";\n        foreach ($results as $result) {\n            //echo $result[periodo].\" vs \".$day.\"<br/>\";\n            if ($result[periodo] == $day && $result[iddimension_matriz_sh] == 1) {\n                $valor_1 = $result[valor];\n                $comentario = $result[comentario];\n            }\n            if ($result[periodo] == $day && $result[iddimension_matriz_sh] == 2) {\n                $puntaje_2 = $result[puntaje];\n                $comentario = $result[comentario];\n            }\n            if ($result[periodo] == $day && $result[iddimension_matriz_sh] == 3) {\n                $puntaje_3 = $result[puntaje];\n                $comentario = $result[comentario];\n            }\n        }\n\n\n        $plantilla3->iniciaBloque(\"td_dimension\");\n        $plantilla3->reemplazaEnBloque(\"posicion\", $valor_1, \"td_dimension\");\n        $plantilla3->reemplazaEnBloque(\"ruta\", ruta_images, \"td_dimension\");\n        $plantilla3->reemplazaEnBloque(\"poder\", $puntaje_2, \"td_dimension\");\n        $plantilla3->reemplazaEnBloque(\"interes\", $puntaje_3, \"td_dimension\");\n        $plantilla3->reemplazaEnBloque(\"comentario\", $comentario, \"td_dimension\");\n    }\n\n    $plantilla3->reemplaza(\"nombre\", utf8_encode($nombre));\n    $plantilla3->reemplaza(\"idpersona\", $fila[idpersona]);\n    $plantilla3->reemplaza(\"idmodulo\", $fila[idmodulo]);\n    $plantilla3->reemplaza(\"idpersona_tipo\", $fila[idpersona_tipo]);\n\n\n    $result1 = $persona->lista_persona_red($idpersona, $idmodulo);\n    $count = 0;\n    while ($fila1 = mysql_fetch_array($result1)) {\n        $count++;\n        $result2 = $persona->get_analisis_red_semana($fila1[idpersona], $fila1[idmodulo]);\n        $results = array();\n        while ($fila2 = mysql_fetch_array($result2)) {\n            $results[] = $fila2;\n        }\n        $plantilla3->iniciaBloque(\"tr_red\");\n        $plantilla3->reemplazaEnBloque(\"numero_red\", $count, \"tr_red\");\n        $plantilla3->reemplazaEnBloque(\"nombre_red\", utf8_encode($fila1[nombre] . \" \" . $fila1[apellido_p] . \" \" . $fila1[apellido_m]), \"tr_red\");\n        $plantilla3->reemplazaEnBloque(\"idpersona\", $fila1[idpersona], \"tr_red\");\n        $plantilla3->reemplazaEnBloque(\"idmodulo\", $fila1[idmodulo], \"tr_red\");\n        $plantilla3->reemplazaEnBloque(\"idpersona_tipo\", $fila1[idpersona_tipo], \"tr_red\");\n\n        $comentario = \"\";\n        foreach ($days as $day) {\n\n            $valor_1 = \"00.png\";\n            $puntaje_2 = \"?\";\n            $puntaje_3 = \"?\";\n            foreach ($results as $result) {\n                //echo $result[periodo].\" vs \".$day.\"<br/>\";\n                if ($result[periodo] == $day && $result[iddimension_matriz_sh] == 1) {\n                    $valor_1 = $result[valor];\n                    $comentario = $result[comentario];\n                }\n                if ($result[periodo] == $day && $result[iddimension_matriz_sh] == 2) {\n                    $puntaje_2 = $result[puntaje];\n                    $comentario = $result[comentario];\n                }\n                if ($result[periodo] == $day && $result[iddimension_matriz_sh] == 3) {\n                    $puntaje_3 = $result[puntaje];\n                    $comentario = $result[comentario];\n                }\n            }\n\n\n            $plantilla3->iniciaBloque(\"td_red\");\n            $plantilla3->reemplazaEnBloque(\"posicion\", $valor_1, \"td_red\");\n            $plantilla3->reemplazaEnBloque(\"ruta\", ruta_images, \"td_red\");\n            $plantilla3->reemplazaEnBloque(\"poder\", $puntaje_2, \"td_red\");\n            $plantilla3->reemplazaEnBloque(\"interes\", $puntaje_3, \"td_red\");\n            $plantilla3->reemplazaEnBloque(\"comentario\", $comentario, \"td_red\");\n        }\n    }\n\n    $plantilla1->reemplaza(\"analisis_red\", $plantilla3->getPlantillaCadena());\n    $plantilla1->presentaPlantilla();\n}\n\nfunction actualizar_analisis_red($idpersona, $idmodulo, $rango_fecha) {\n\n    $plantilla = new DmpTemplate(\"../../../plantillas/stakeholder/stakeholder/tabla_analisis_red.html\");\n    $format = 'Ym';\n    $date = date($format);\n    $days = array();\n    $dia = date('d-m-Y');\n\n    // - 7 days from today\n\n    for ($i = 1; $i < 7; $i++) {\n\n        $days[] = $date;\n        $plantilla->iniciaBloque(\"td_fecha\");\n        $plantilla->reemplazaEnBloque(\"fecha\", $dia, \"td_fecha\");\n        $dia = date('d-m-Y', strtotime(\"-$rango_fecha week\" . $dia));\n        $date = date($format, strtotime($dia));\n    }\n\n    $persona = new ipersona();\n    $result = $persona->get_analisis_red_mes($idpersona, $idmodulo);\n\n    $results = array();\n\n    while ($fila = mysql_fetch_array($result)) {\n        $results[] = $fila;\n    }\n\n    $result = $persona->get_persona($idpersona, $idmodulo);\n\n    //print_r($results);\n    $nombre = \"\";\n    if ($fila = mysql_fetch_array($result)) {\n        $nombre = $fila[apellido_p] . \" \" . $fila[apellido_m] . \", \" . $fila[nombre];\n    }\n    $comentario = \"\";\n    foreach ($days as $day) {\n\n        $valor_1 = \"00.png\";\n        $puntaje_2 = \"?\";\n        $puntaje_3 = \"?\";\n        foreach ($results as $result) {\n            //echo $result[periodo].\" vs \".$day.\"<br/>\";\n            if ($result[periodo] == $day && $result[iddimension_matriz_sh] == 1) {\n                $valor_1 = $result[valor];\n                $comentario = $result[comentario];\n            }\n            if ($result[periodo] == $day && $result[iddimension_matriz_sh] == 2) {\n                $puntaje_2 = $result[puntaje];\n                $comentario = $result[comentario];\n            }\n            if ($result[periodo] == $day && $result[iddimension_matriz_sh] == 3) {\n                $puntaje_3 = $result[puntaje];\n                $comentario = $result[comentario];\n            }\n        }\n\n\n        $plantilla->iniciaBloque(\"td_dimension\");\n        $plantilla->reemplazaEnBloque(\"posicion\", $valor_1, \"td_dimension\");\n        $plantilla->reemplazaEnBloque(\"ruta\", ruta_images, \"td_dimension\");\n        $plantilla->reemplazaEnBloque(\"poder\", $puntaje_2, \"td_dimension\");\n        $plantilla->reemplazaEnBloque(\"interes\", $puntaje_3, \"td_dimension\");\n        $plantilla->reemplazaEnBloque(\"comentario\", $comentario, \"td_dimension\");\n    }\n\n    $plantilla->reemplaza(\"nombre\", $nombre);\n    $plantilla->reemplaza(\"idpersona\", $fila[idpersona]);\n    $plantilla->reemplaza(\"idmodulo\", $fila[idmodulo]);\n    $plantilla->reemplaza(\"idpersona_tipo\", $fila[idpersona_tipo]);\n\n    $result1 = $persona->lista_persona_red($idpersona, $idmodulo);\n    $count = 0;\n    while ($fila1 = mysql_fetch_array($result1)) {\n        $count++;\n        $result2 = $persona->get_analisis_red_mes($fila1[idpersona_red], $fila1[idmodulo_red]);\n        $results = array();\n        while ($fila2 = mysql_fetch_array($result2)) {\n            $results[] = $fila2;\n        }\n        $plantilla->iniciaBloque(\"tr_red\");\n        $plantilla->reemplazaEnBloque(\"numero_red\", $count, \"tr_red\");\n        $plantilla->reemplazaEnBloque(\"nombre_red\", $fila1[apellido_p] . \" \" . $fila1[apellido_m] . \", \" . $fila1[nombre], \"tr_red\");\n        $plantilla->reemplazaEnBloque(\"idpersona\", $fila1[idpersona], \"tr_red\");\n        $plantilla->reemplazaEnBloque(\"idmodulo\", $fila1[idmodulo], \"tr_red\");\n        $plantilla->reemplazaEnBloque(\"idpersona_tipo\", $fila1[idpersona_tipo], \"tr_red\");\n        $comenatrio = \"\";\n        foreach ($days as $day) {\n\n            $valor_1 = \"00.png\";\n            $puntaje_2 = \"?\";\n            $puntaje_3 = \"?\";\n            foreach ($results as $result) {\n                //echo $result[periodo].\" vs \".$day.\"<br/>\";\n                if ($result[periodo] == $day && $result[iddimension_matriz_sh] == 1) {\n                    $valor_1 = $result[valor];\n                    $comentario = $result[comentario];\n                }\n                if ($result[periodo] == $day && $result[iddimension_matriz_sh] == 2) {\n                    $puntaje_2 = $result[puntaje];\n                    $comentario = $result[comentario];\n                }\n                if ($result[periodo] == $day && $result[iddimension_matriz_sh] == 3) {\n                    $puntaje_3 = $result[puntaje];\n                    $comentario = $result[comentario];\n                }\n            }\n\n            $nombre = $result[nombre] . \" \" . $result[apellido_p];\n            $plantilla->iniciaBloque(\"td_red\");\n            $plantilla->reemplazaEnBloque(\"posicion\", $valor_1, \"td_red\");\n            $plantilla->reemplazaEnBloque(\"ruta\", ruta_images, \"td_red\");\n            $plantilla->reemplazaEnBloque(\"poder\", $puntaje_2, \"td_red\");\n            $plantilla->reemplazaEnBloque(\"interes\", $puntaje_3, \"td_red\");\n            $plantilla->reemplazaEnBloque(\"comentario\", $comentario, \"td_red\");\n        }\n    }\n\n\n\n    $plantilla->presentaPlantilla();\n}\n\nfunction ver_buscar_interaccion() {\n\n\n    $plantilla = new DmpTemplate(\"../../../plantillas/stakeholder/interaccion/buscar.html\");\n\n    //tipo\n    $iinteraccion_tipo = new iinteraccion_tipo();\n\n    $result_interaccion_tipo = $iinteraccion_tipo->lista_interaccion_tipo();\n\n    while (!!$fila_tipo = mysql_fetch_array($result_interaccion_tipo)) {\n\n        $plantilla->iniciaBloque(\"interaccion_tipo\");\n        $plantilla->reemplazaEnBloque(\"idinteraccion_tipo\", $fila_tipo[idinteraccion_tipo], \"interaccion_tipo\");\n        $plantilla->reemplazaEnBloque(\"interaccion_tipo\", utf8_encode($fila_tipo[interaccion_tipo]), \"interaccion_tipo\");\n    }\n\n    //estado\n    $iinteraccion_estado = new iinteraccion_estado();\n\n    $result_interaccion_estado = $iinteraccion_estado->lista_interaccion_estado();\n\n    while (!!$fila_estado = mysql_fetch_array($result_interaccion_estado)) {\n\n        $plantilla->iniciaBloque(\"interaccion_estado\");\n        $plantilla->reemplazaEnBloque(\"idinteraccion_estado\", $fila_estado[idinteraccion_estado], \"interaccion_estado\");\n        $plantilla->reemplazaEnBloque(\"interaccion_estado\", $fila_estado[interaccion_estado], \"interaccion_estado\");\n    }\n\n    $plantilla->presentaPlantilla();\n}\n\nfunction buscar_interaccion($idinteraccion, $idmodulo_interaccion, $idinteraccion_estado, $prioridades, $tipos, $fecha_del, $fecha_al, $idinteraccion_complejo_tag, $idinteraccion_complejo_rc, $idinteraccion_complejo_sh, $interaccion) {\n\n    $seguridad = new Seguridad();\n\n    $ayudante = new Ayudante();\n\n    $iinteraccion = new iinteraccion();\n\n    $result_interaccion = $iinteraccion->lista($idinteraccion, $idmodulo_interaccion, $idinteraccion_estado, $prioridades, $tipos, $fecha_del, $fecha_al, $idinteraccion_complejo_tag, $idinteraccion_complejo_rc, $idinteraccion_complejo_sh, $interaccion);\n    $total = 0;\n    $datos = array();\n    $aux_cursor = \"X\";\n    while ($fila = mysql_fetch_array($result_interaccion)) {\n        if ($aux_cursor != ($fila[idinteraccion] . '---' . $fila[idmodulo_interaccion])) {\n            $total++;\n            $idinteraccion = $fila[idinteraccion];\n            $idmodulo_interaccion = $fila[idmodulo_interaccion];\n            $interaccion = $fila[interaccion];\n            $prioridad = $fila[idinteraccion_prioridad];\n            $estado = $fila[interaccion_estado];\n            $tipo = $fila[interaccion_tipo];\n            $fecha = $ayudante->FechaRevez($fila[fecha]);\n\n            $accion = \"<a href='javascript:modal_ver_predio_entidad(\\\"interaccion\\\",$idinteraccion,$idmodulo_interaccion)' title='Ver GIS'><img src='../../../img/layers.png' alt='GIS'/></a>\";\n            $accion.=\"<a href='javascript:exportar_pdf_interaccion(\\\"frame3\\\",$idinteraccion,$idmodulo_interaccion)' title='Ver PDF'><img src='../../../img/pdf.png' alt='PDF'/></a>\";\n\n            if ($seguridad->verifica_permiso(\"Editar\", \"Interaccion\", $fila[idusu_c], $fila[idmodulo_c]))\n                $accion.=\"<a href='javascript:modal_interaccion($idinteraccion,$idmodulo_interaccion,2)' title='Editar interacci&oacute;n'><img src='../../../img/edit.png' alt='Editar'/></a>\";\n\n            if ($seguridad->verifica_permiso(\"Eliminar\", \"Interaccion\", $fila[idusu_c], $fila[idmodulo_c]))\n                $accion.=\"<a href='javascript:eliminar_interaccion($idinteraccion,$idmodulo_interaccion)' title='Eliminar interacci&oacute;n'><img src='../../../img/trash.png' alt='Eliminar'/></a>\";\n\n            if ($fila[archivos] > 0)\n                $accion.=\"<img src='../../../img/attach.png' alt='adjuntos'/>\";\n\n            if (isset($fila[idgis_item]) && $fila[idgis_item] != \"\") {\n                $datos['idgis_item'][$fila[idgis_item]] = $fila[interacciones];\n            }\n\n            $datos[\"data\"][] = array(\"interaccion\" => utf8_encode($interaccion), \"estado\" => $estado, \"prioridad\" => $prioridad, \"tipo\" => utf8_encode($tipo), \"fecha\" => $fecha, \"accion\" => $accion);\n\n\n            $aux_cursor = $fila[idinteraccion] . '---' . $fila[idmodulo_interaccion];\n        }\n    }\n    $datos[\"total\"] = $total;\n\n    $fid_string = \" \";\n\n    foreach ($datos['idgis_item'] as $idgis_item => $interacciones) {\n        $fid_string .= $idgis_item . \",\";\n    }\n\n\n    $fid_string = substr($fid_string, 0, -1);\n\n    $datos[\"fid_string\"] = $fid_string;\n    //$plantilla->presentaPlantilla();\n    echo json_encode($datos);\n}\n\nfunction exportar_interaccion($idinteraccion_estado, $prioridades, $tipos, $fecha_del, $fecha_al, $idinteraccion_complejo_tag, $idinteraccion_complejo_rc, $idinteraccion_complejo_sh, $interaccion) {\n\n    $ayudante = new Ayudante();\n\n    $iinteraccion = new iinteraccion();\n\n    $result_interaccion = $iinteraccion->lista(\"\", \"\", $idinteraccion_estado, $prioridades, $tipos, $fecha_del, $fecha_al, $idinteraccion_complejo_tag, $idinteraccion_complejo_rc, $idinteraccion_complejo_sh, $interaccion);\n\n    $datos = array();\n    while ($fila = mysql_fetch_array($result_interaccion)) {\n\n        $idinteraccion = $fila[idinteraccion];\n        $idmodulo_interaccion = $fila[idmodulo_interaccion];\n        $interaccion = $fila[interaccion];\n        $estado = $fila[interaccion_estado];\n        $prioridad = $fila[idinteraccion_prioridad];\n        $tipo = $fila[interaccion_tipo];\n        $fecha = $ayudante->FechaRevez($fila[fecha]);\n        $tags = \"   \";\n        $result = $iinteraccion->lista_tag_interaccion($idinteraccion, $idmodulo_interaccion);\n        while ($fila = mysql_fetch_array($result)) {\n            $tags.= $fila[tag] . \" , \";\n        }\n        $tags = substr($tags, 0, -3);\n        $rcs = \"   \";\n        $result = $iinteraccion->lista_interaccion_rc($idinteraccion, $idmodulo_interaccion);\n        while ($fila = mysql_fetch_array($result)) {\n            $rcs.= $fila[apellido_p] . \" \" . $fila[apellido_m] . \" \" . $fila[nombre] . \" , \";\n        }\n        $rcs = substr($rcs, 0, -3);\n        $shs = \"   \";\n        $result = $iinteraccion->lista_interaccion_sh($idinteraccion, $idmodulo_interaccion);\n        while ($fila = mysql_fetch_array($result)) {\n            $shs.= $fila[apellido_p] . \" \" . $fila[apellido_m] . \" \" . $fila[nombre] . \" , \";\n        }\n        $shs = substr($shs, 0, -3);\n\n        $datos[] = array(\"interaccion\" => utf8_encode($interaccion), \"estado\" => $estado, \"prioridad\" => $prioridad, \"tipo\" => $tipo, \"fecha\" => $fecha, \"tags\" => utf8_encode($tags), \"rcs\" => utf8_encode($rcs), \"shs\" => utf8_encode($shs));\n    }\n\n    $fecha = date('d-m-Y');\n\n    //objeto de PHP Excel\n    $objPHPExcel = new PHPExcel();\n\n    //algunos datos sobre autorÃ­a\n    $objPHPExcel->getProperties()->setCreator(\"Francisco Mora(@Itrativo)\");\n    $objPHPExcel->getProperties()->setLastModifiedBy(\"Francisco Mora(@itrativo)\");\n    $objPHPExcel->getProperties()->setTitle(\"Office 2007 XLSX Reporte de Clientes\");\n    $objPHPExcel->getProperties()->setSubject(\"Office 2007 XLSX Reporte de Clientes\");\n    $objPHPExcel->getProperties()->setDescription(\"Reporte de Clientes para Office 2007 XLSX, Usando PHPExcel.\");\n\n    //Trabajamos con la hoja activa principal\n    $objPHPExcel->setActiveSheetIndex(0);\n    $objDrawing = new PHPExcel_Worksheet_Drawing();\n    $objDrawing->setName('Test Logo');\n    $objDrawing->setDescription('Test Logo');\n    $objDrawing->setPath('../../../img/logo2.png');\n    $objDrawing->setCoordinates('H1');\n    $objDrawing->setWorksheet($objPHPExcel->getActiveSheet());\n    $objPHPExcel->getActiveSheet()->SetCellValue(\"A1\", \"Social Capital Group\");\n    $styleArray = array(\n        'font' => array(\n            'bold' => true\n        )\n    );\n\n    $objPHPExcel->getActiveSheet()->getStyle(\"A1\")->applyFromArray($styleArray);\n    $objPHPExcel->getActiveSheet()->mergeCells('A1:I2');\n    $objPHPExcel->getActiveSheet()->getStyle('A2:I2')->getBorders()->getBottom()->setBorderStyle(PHPExcel_Style_Border::BORDER_MEDIUM);\n\n    $objPHPExcel->getActiveSheet()->SetCellValue(\"A4\", \"Reporte de Interacciones al $fecha\");\n    $objPHPExcel->getActiveSheet()->getStyle(\"A4:I4\")->getFont()->setSize(16);\n    $objPHPExcel->getActiveSheet()->getStyle('A4:I4')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);\n    $styleArray = array(\n        'font' => array(\n            'bold' => true\n        )\n    );\n\n    $objPHPExcel->getActiveSheet()->getStyle(\"A4\")->applyFromArray($styleArray);\n    $objPHPExcel->getActiveSheet()->mergeCells('A4:H4');\n\n    $count = 8;\n\n    $objPHPExcel->getActiveSheet()->SetCellValue(\"B\" . $count, utf8_encode(\"InteracciÃ³n\"));\n    $objPHPExcel->getActiveSheet()->SetCellValue(\"C\" . $count, \"Prioridad\");\n    $objPHPExcel->getActiveSheet()->SetCellValue(\"D\" . $count, \"Tipo\");\n    $objPHPExcel->getActiveSheet()->SetCellValue(\"E\" . $count, \"Fecha\");\n    $objPHPExcel->getActiveSheet()->SetCellValue(\"F\" . $count, \"Tags\");\n    $objPHPExcel->getActiveSheet()->SetCellValue(\"G\" . $count, \"RC\");\n    $objPHPExcel->getActiveSheet()->SetCellValue(\"H\" . $count, \"SH\");\n    $objPHPExcel->getActiveSheet()->SetCellValue(\"I\" . $count, \"Estado\");\n\n    $styleArray = array(\n        'font' => array(\n            'bold' => true\n        )\n    );\n\n    $objPHPExcel->getActiveSheet()->getStyle(\"B\" . $count)->applyFromArray($styleArray);\n    $objPHPExcel->getActiveSheet()->getStyle(\"C\" . $count)->applyFromArray($styleArray);\n    $objPHPExcel->getActiveSheet()->getStyle(\"D\" . $count)->applyFromArray($styleArray);\n    $objPHPExcel->getActiveSheet()->getStyle(\"E\" . $count)->applyFromArray($styleArray);\n    $objPHPExcel->getActiveSheet()->getStyle(\"F\" . $count)->applyFromArray($styleArray);\n    $objPHPExcel->getActiveSheet()->getStyle(\"G\" . $count)->applyFromArray($styleArray);\n    $objPHPExcel->getActiveSheet()->getStyle(\"H\" . $count)->applyFromArray($styleArray);\n    $objPHPExcel->getActiveSheet()->getStyle(\"I\" . $count)->applyFromArray($styleArray);\n\n    $objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(100);\n    //iteramos para los resultados\n    $count++;\n    foreach ($datos as $row) {\n        $objPHPExcel->getActiveSheet()->SetCellValue(\"B\" . $count, $row[\"interaccion\"]);\n        $objPHPExcel->getActiveSheet()->SetCellValue(\"C\" . $count, $row[\"prioridad\"]);\n        $objPHPExcel->getActiveSheet()->SetCellValue(\"D\" . $count, $row[\"tipo\"]);\n        $objPHPExcel->getActiveSheet()->SetCellValue(\"E\" . $count, $row[\"fecha\"]);\n        $objPHPExcel->getActiveSheet()->SetCellValue(\"F\" . $count, $row[\"tags\"]);\n        $objPHPExcel->getActiveSheet()->SetCellValue(\"G\" . $count, $row[\"rcs\"]);\n        $objPHPExcel->getActiveSheet()->SetCellValue(\"H\" . $count, $row[\"shs\"]);\n        $objPHPExcel->getActiveSheet()->SetCellValue(\"I\" . $count, $row[\"estado\"]);\n        $count++;\n    }\n\n    $objPHPExcel->getActiveSheet()->getStyle('B1:B' . $objPHPExcel->getActiveSheet()->getHighestRow())->getAlignment()->setWrapText(true);\n\n    //Titulo del libro y seguridad \n    $objPHPExcel->getActiveSheet()->setTitle('Reporte');\n    $objPHPExcel->getSecurity()->setLockWindows(true);\n    $objPHPExcel->getSecurity()->setLockStructure(true);\n\n\n    // Se modifican los encabezados del HTTP para indicar que se envia un archivo de Excel.\n    header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');\n    header(\"Content-Disposition: attachment;filename=reporte_interacciones_al_$fecha.xlsx \");\n    header('Cache-Control: max-age=0');\n    $objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');\n\n    ob_clean();\n    flush();\n    //readfile($fichero);\n    $objWriter->save('php://output');\n\n\n    exit;\n}\n\nfunction exportar_pdf_organizacion($idpersona, $idmodulo) {\n\n    $ipersona = new ipersona();\n\n    $personas = \"\";\n    //$rcs= substr($rcs, 0, -3);\n    $result = $ipersona->lista_persona_organizacion($idpersona, $idmodulo);\n    $i = 1;\n    while ($fila = mysql_fetch_array($result)) {\n        $personas.= \"$i. \" . $fila[apellido_p] . \" \" . $fila[apellido_m] . \" \" . $fila[nombre] . \" ( \" . $fila[cargo] . \" ) \\n\";\n        $i++;\n    }\n\n    $result = $ipersona->lista_organizacion($idpersona, $idmodulo);\n    $organizacion = \"\";\n    if ($fila = mysql_fetch_array($result)) {\n        $organizacion = $fila[apellido_p];\n    }\n\n\n    $pdf = new PDF();\n    // Primera pÃ¡gina\n    $pdf->AddPage();\n\n    $pdf->SetFont('Arial', 'B', 14);\n\n    $pdf->Cell(0, 10, 'Lista de Miembros de la Organizacion', 0, 1, 'C');\n    $pdf->Cell(0, 10, \"$organizacion\", 0, 1, 'C');\n    $pdf->SetFont('Arial', 'B', 12);\n    $pdf->Ln(10);\n    $pdf->Cell(20);\n    $pdf->Cell(30, 10, ' Miembros :', 0, 1, 'L');\n    $pdf->SetFont('Arial', '', 12);\n    $pdf->Cell(20);\n    $pdf->MultiCell(120, 5, $personas, 0, 'L');\n    // Close and output PDF document\n    // This method has several options, check the source code documentation for more information.\n    $pdf->Output(\"Organizacion_$idpersona-$idmodulo.pdf\", 'D');\n\n    //============================================================+\n    // END OF FILE\n    //============================================================+\n}\n\nfunction exportar_pdf_compromiso($idcompromiso, $idmodulo_compromiso) {\n\n    $icompromiso = new icompromiso();\n\n\n    $acompromiso = $icompromiso->get_compromiso($idcompromiso, $idmodulo_compromiso);\n\n    $codigo = \"\";\n    $compromiso = \"\";\n    $estado = \"\";\n    $prioridad = \"\";\n    $tipo = \"\";\n    $fecha = \"\";\n    $fecha_fin = \"\";\n    $tags = \"\";\n    $rcs = \"\";\n    $shs = \"\";\n    $archivos = \"\";\n    $interaccion = \"\";\n\n    $codigo = $idcompromiso . \"-\" . $idmodulo_compromiso;\n    $compromiso = utf8_decode($acompromiso['compromiso'][$idcompromiso . \"-\" . $idmodulo_compromiso]);\n    $estado = $acompromiso['estado'][$idcompromiso . \"-\" . $idmodulo_compromiso];\n    $prioridad = $acompromiso['prioridad'][$idcompromiso . \"-\" . $idmodulo_compromiso];\n    $fecha = $acompromiso['fecha'][$idcompromiso . \"-\" . $idmodulo_compromiso] . \" \" . $acompromiso['hora'][$idcompromiso . \"-\" . $idmodulo_compromiso] . \":\" . $acompromiso['minuto'][$idcompromiso . \"-\" . $idmodulo_compromiso] . \"h\";\n    $fecha_fin = $acompromiso['fecha_fin'][$idcompromiso . \"-\" . $idmodulo_compromiso] . \" \" . $acompromiso['hora_fin'][$idcompromiso . \"-\" . $idmodulo_compromiso] . \":\" . $acompromiso['minuto_fin'][$idcompromiso . \"-\" . $idmodulo_compromiso] . \"h\";\n    $interaccion = $acompromiso['idinteraccion'][$idcompromiso . \"-\" . $idmodulo_compromiso] . \"-\" . $acompromiso['idmodulo_interaccion'][$idcompromiso . \"-\" . $idmodulo_compromiso];\n\n    foreach ($acompromiso['rc'][$idcompromiso . \"-\" . $idmodulo_compromiso] as $fila) {\n        $rcs.= \"- \" . $fila . \"\\n\";\n    }\n\n    foreach ($acompromiso['sh'][$idcompromiso . \"-\" . $idmodulo_compromiso] as $fila) {\n        $shs.= \"- \" . $fila . \"\\n\";\n    }\n\n    $result = $icompromiso->lista_archivo($idcompromiso, $idmodulo_compromiso);\n    while ($fila = mysql_fetch_array($result)) {\n        $archivos.= \"- \" . $fila[archivo] . \"\\n\";\n    }\n\n    $pdf = new PDF();\n    // Primera pÃ¡gina\n    $pdf->AddPage();\n\n    $pdf->SetFont('Arial', 'B', 14);\n\n    $pdf->Cell(0, 10, 'Compromiso', 0, 1, 'C');\n    $pdf->SetFont('Arial', 'B', 12);\n    $pdf->Ln(10);\n    $pdf->Cell(20);\n    $pdf->Cell(30, 10, '1. CÃ³digo :', 0, 0, 'L');\n    $pdf->SetFont('Arial', '', 12);\n    $pdf->Cell(30, 10, $codigo, 0, 0, 'L');\n    $pdf->Cell(10);\n    $pdf->SetFont('Arial', 'B', 12);\n    $pdf->Cell(50, 10, 'CÃ³digo de InteracciÃ³n :', 0, 0, 'L');\n    $pdf->SetFont('Arial', '', 12);\n    $pdf->Cell(50, 10, $interaccion, 0, 1, 'L');\n    $pdf->SetFont('Arial', 'B', 12);\n    $pdf->Cell(20);\n    $pdf->Cell(30, 10, '2. Compromiso :', 0, 1, 'L');\n    $pdf->SetFont('Arial', '', 12);\n    $pdf->Cell(20);\n    $pdf->MultiCell(150, 5, $compromiso, 0, 'J');\n    $pdf->SetFont('Arial', 'B', 12);\n    $pdf->Cell(20);\n    $pdf->Cell(30, 10, '3. Prioridad :', 0, 0, 'L');\n    $pdf->SetFont('Arial', '', 12);\n    $pdf->Cell(50, 10, $prioridad, 0, 0, 'L');\n    $pdf->SetFont('Arial', 'B', 12);\n    $pdf->Cell(10);\n    $pdf->Cell(30, 10, 'Estado :', 0, 0, 'L');\n    $pdf->SetFont('Arial', '', 12);\n    $pdf->Cell(50, 10, $estado, 0, 1, 'L');\n    $pdf->SetFont('Arial', 'B', 12);\n    $pdf->Cell(20);\n    $pdf->Cell(30, 10, '4. Fecha :', 0, 0, 'L');\n    $pdf->SetFont('Arial', '', 12);\n    $pdf->Cell(50, 10, $fecha, 0, 0, 'L');\n    $pdf->SetFont('Arial', 'B', 12);\n    $pdf->Cell(10);\n    $pdf->Cell(30, 10, 'Fecha Fin :', 0, 0, 'L');\n    $pdf->SetFont('Arial', '', 12);\n    $pdf->Cell(50, 10, $fecha_fin, 0, 1, 'L');\n    $pdf->SetFont('Arial', 'B', 12);\n    $pdf->Cell(20);\n    $pdf->Cell(30, 10, '5. Relacionistas :', 0, 1, 'L');\n    $pdf->SetFont('Arial', '', 12);\n    $pdf->Cell(20);\n    $pdf->MultiCell(120, 5, utf8_decode($rcs), 0, 'L');\n    $pdf->SetFont('Arial', 'B', 12);\n    $pdf->Cell(20);\n    $pdf->Cell(30, 10, '6. Stakeholders :', 0, 1, 'L');\n    $pdf->SetFont('Arial', '', 12);\n    $pdf->Cell(20);\n    $pdf->MultiCell(120, 5, utf8_decode($shs), 0, 'L');\n    $pdf->SetFont('Arial', 'B', 12);\n    $pdf->Cell(20);\n    $pdf->Cell(30, 10, '7. Archivos :', 0, 1, 'L');\n    $pdf->SetFont('Arial', '', 12);\n    $pdf->Cell(20);\n    $pdf->MultiCell(120, 5, $archivos, 0, 'L');\n\n\n    // Close and output PDF document\n    // This method has several options, check the source code documentation for more information.\n    $pdf->Output(\"Compromiso_$idcompromiso-$idmodulo_compromiso.pdf\", 'D');\n\n    //============================================================+\n    // END OF FILE\n    //============================================================+\n}\n\nfunction ver_buscar_compromiso() {\n\n\n    $plantilla = new DmpTemplate(\"../../../plantillas/stakeholder/compromiso/buscar.html\");\n\n    $icompromiso_estado = new icompromiso_estado();\n\n    $result = $icompromiso_estado->lista_compromiso_estado();\n\n    while ($fila = mysql_fetch_array($result)) {\n\n        $plantilla->iniciaBloque(\"compromiso_estado\");\n        $plantilla->reemplazaEnBloque(\"idcompromiso_estado\", $fila[idcompromiso_estado], \"compromiso_estado\");\n        $plantilla->reemplazaEnBloque(\"compromiso_estado\", $fila[compromiso_estado], \"compromiso_estado\");\n    }\n\n    $icompromiso_prioridad = new icompromiso_prioridad();\n\n    $result = $icompromiso_prioridad->lista_compromiso_prioridad();\n\n    while ($fila = mysql_fetch_array($result)) {\n\n        $plantilla->iniciaBloque(\"compromiso_prioridad\");\n        $plantilla->reemplazaEnBloque(\"idcompromiso_prioridad\", $fila[idcompromiso_prioridad], \"compromiso_prioridad\");\n        $plantilla->reemplazaEnBloque(\"compromiso_prioridad\", $fila[compromiso_prioridad], \"compromiso_prioridad\");\n    }\n\n    $plantilla->presentaPlantilla();\n}\n\nfunction buscar_compromiso($idcompromiso, $idmodulo_compromiso, $idcompromiso_estado, $idcompromiso_prioridad, $fecha_del, $fecha_al, $idinteraccion_complejo_rc, $idinteraccion_complejo_sh, $compromiso) {\n\n    $icompromiso = new icompromiso();\n    $seguridad = new Seguridad();\n\n    $result = $icompromiso->lista($idcompromiso, $idmodulo_compromiso, $idcompromiso_estado, $idcompromiso_prioridad, $fecha_del, $fecha_al, $idinteraccion_complejo_rc, $idinteraccion_complejo_sh, $compromiso);\n\n    $total = 0;\n    $datos = array();\n    while ($fila = mysql_fetch_array($result)) {\n\n        $total++;\n        $idcompromiso = $fila[idcompromiso];\n        $idmodulo_compromiso = $fila[idmodulo_compromiso];\n        $compromiso = $fila[compromiso];\n\n        $compromiso_estado = $fila[compromiso_estado];\n        $compromiso_prioridad = $fila[compromiso_prioridad];\n        $fecha = $fila[fecha];\n        $accion = \"<a href='javascript:modal_ver_predio_entidad(\\\"compromiso\\\",$idcompromiso,$idmodulo_compromiso)' title='Ver GIS'><img src='../../../img/layers.png' alt='GIS'/></a>\";\n        $accion.=\"<a href='javascript:exportar_pdf_compromiso(\\\"frame4\\\",$idcompromiso,$idmodulo_compromiso)' title='Ver PDF'><img src='../../../img/pdf.png' alt='PDF'/></a>\";\n\n        if ($seguridad->verifica_permiso(\"Editar\", \"Compromiso\", $fila[idusu_c], $fila[idmodulo_c]))\n            $accion.=\"<a href='javascript:modal_editar_compromiso($idcompromiso,$idmodulo_compromiso)' title='Editar compromiso'><img src='../../../img/edit.png' alt='Editar'/></a>\";\n\n        if ($fila[archivos] > 0)\n            $accion.=\"<img src='../../../img/attach.png' alt='adjuntos'/>\";\n\n        if (isset($fila[idgis_item])) {\n            $datos['idgis_item'][$fila[idgis_item]] = $fila[compromisos];\n        }\n\n        $datos[\"data\"][] = array(\"compromiso\" => utf8_encode($compromiso), \"estado\" => $compromiso_estado, \"prioridad\" => $compromiso_prioridad, \"fecha\" => $fecha, \"accion\" => $accion);\n    }\n\n    $datos[\"total\"] = $total;\n\n    $fid_string = \" \";\n\n    foreach ($datos['idgis_item'] as $idgis_item => $compromiso) {\n        $fid_string .= $idgis_item . \",\";\n    }\n\n\n    $fid_string = substr($fid_string, 0, -1);\n\n    $datos[\"fid_string\"] = $fid_string;\n    //$plantilla->presentaPlantilla();\n    echo json_encode($datos);\n}\n\nfunction exportar_compromiso($idcompromiso_estado, $idcompromiso_prioridad, $fecha_del, $fecha_al, $idinteraccion_complejo_rc, $idinteraccion_complejo_sh, $compromiso) {\n\n    $ayudante = new Ayudante();\n\n    $icompromiso = new icompromiso();\n\n    $result_compromiso = $icompromiso->lista(\"\", \"\", $idcompromiso_estado, $idcompromiso_prioridad, $fecha_del, $fecha_al, $idinteraccion_complejo_rc, $idinteraccion_complejo_sh, $compromiso);\n\n    $datos = array();\n    while ($fila = mysql_fetch_array($result_compromiso)) {\n\n        $idcompromiso = $fila[idcompromiso];\n        $idmodulo_compromiso = $fila[idmodulo_compromiso];\n        $compromiso = $fila[compromiso];\n\n        $compromiso_estado = $fila[compromiso_estado];\n        $compromiso_prioridad = $fila[compromiso_prioridad];\n        $fecha = $fila[fecha];\n\n        $rcs = \"   \";\n        $result = $icompromiso->lista_compromiso_rc($idcompromiso, $idmodulo_compromiso);\n        while ($fila = mysql_fetch_array($result)) {\n            $rcs.= $fila[apellido_p] . \" \" . $fila[apellido_m] . \" \" . $fila[nombre] . \" , \";\n        }\n        $rcs = substr($rcs, 0, -3);\n\n        $shs = \"   \";\n        $result = $icompromiso->lista_compromiso_sh($idcompromiso, $idmodulo_compromiso);\n        while ($fila = mysql_fetch_array($result)) {\n            $shs.= $fila[apellido_p] . \" \" . $fila[apellido_m] . \" \" . $fila[nombre] . \" , \";\n        }\n        $shs = substr($shs, 0, -3);\n\n\n        $datos[] = array(\"compromiso\" => utf8_encode($compromiso), \"estado\" => $compromiso_estado, \"prioridad\" => $compromiso_prioridad, \"fecha\" => $fecha, \"rcs\" => utf8_encode($rcs), \"shs\" => utf8_encode($shs));\n    }\n    $fecha = date('d-m-Y');\n\n    //objeto de PHP Excel\n    $objPHPExcel = new PHPExcel();\n\n    //algunos datos sobre autorÃ­a\n    $objPHPExcel->getProperties()->setCreator(\"Francisco Mora(@Itrativo)\");\n    $objPHPExcel->getProperties()->setLastModifiedBy(\"Francisco Mora(@itrativo)\");\n    $objPHPExcel->getProperties()->setTitle(\"Office 2007 XLSX Reporte de Clientes\");\n    $objPHPExcel->getProperties()->setSubject(\"Office 2007 XLSX Reporte de Clientes\");\n    $objPHPExcel->getProperties()->setDescription(\"Reporte de Clientes para Office 2007 XLSX, Usando PHPExcel.\");\n\n    //Trabajamos con la hoja activa principal\n    //Trabajamos con la hoja activa principal\n    $objPHPExcel->setActiveSheetIndex(0);\n    $objDrawing = new PHPExcel_Worksheet_Drawing();\n    $objDrawing->setName('Test Logo');\n    $objDrawing->setDescription('Test Logo');\n    $objDrawing->setPath('../../../img/logo2.png');\n    $objDrawing->setCoordinates('H1');\n    $objDrawing->setWorksheet($objPHPExcel->getActiveSheet());\n    $objPHPExcel->getActiveSheet()->SetCellValue(\"A1\", \"Social Capital Group\");\n    $styleArray = array(\n        'font' => array(\n            'bold' => true\n        )\n    );\n\n    $objPHPExcel->getActiveSheet()->getStyle(\"A1\")->applyFromArray($styleArray);\n    $objPHPExcel->getActiveSheet()->mergeCells('A1:H2');\n    $objPHPExcel->getActiveSheet()->getStyle('A2:H2')->getBorders()->getBottom()->setBorderStyle(PHPExcel_Style_Border::BORDER_MEDIUM);\n\n    $objPHPExcel->getActiveSheet()->SetCellValue(\"A4\", \"Reporte de Compromisos al $fecha\");\n    $objPHPExcel->getActiveSheet()->getStyle(\"A4:H4\")->getFont()->setSize(16);\n    $objPHPExcel->getActiveSheet()->getStyle('A4:H4')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);\n    $styleArray = array(\n        'font' => array(\n            'bold' => true\n        )\n    );\n\n    $objPHPExcel->getActiveSheet()->getStyle(\"A4\")->applyFromArray($styleArray);\n    $objPHPExcel->getActiveSheet()->mergeCells('A4:H4');\n\n    $count = 8;\n\n    $objPHPExcel->getActiveSheet()->SetCellValue(\"B\" . $count, \"Compromiso\");\n    $objPHPExcel->getActiveSheet()->SetCellValue(\"C\" . $count, \"Estado\");\n    $objPHPExcel->getActiveSheet()->SetCellValue(\"D\" . $count, \"Prioridad\");\n    $objPHPExcel->getActiveSheet()->SetCellValue(\"E\" . $count, \"Fecha\");\n    $objPHPExcel->getActiveSheet()->SetCellValue(\"F\" . $count, \"RC\");\n    $objPHPExcel->getActiveSheet()->SetCellValue(\"G\" . $count, \"SH\");\n\n    $styleArray = array(\n        'font' => array(\n            'bold' => true\n        )\n    );\n\n    $objPHPExcel->getActiveSheet()->getStyle(\"B\" . $count)->applyFromArray($styleArray);\n    $objPHPExcel->getActiveSheet()->getStyle(\"C\" . $count)->applyFromArray($styleArray);\n    $objPHPExcel->getActiveSheet()->getStyle(\"D\" . $count)->applyFromArray($styleArray);\n    $objPHPExcel->getActiveSheet()->getStyle(\"E\" . $count)->applyFromArray($styleArray);\n    $objPHPExcel->getActiveSheet()->getStyle(\"F\" . $count)->applyFromArray($styleArray);\n    $objPHPExcel->getActiveSheet()->getStyle(\"G\" . $count)->applyFromArray($styleArray);\n    //iteramos para los resultados\n    $count++;\n    foreach ($datos as $row) {\n        $objPHPExcel->getActiveSheet()->SetCellValue(\"B\" . $count, $row[\"compromiso\"]);\n        $objPHPExcel->getActiveSheet()->SetCellValue(\"C\" . $count, $row[\"estado\"]);\n        $objPHPExcel->getActiveSheet()->SetCellValue(\"D\" . $count, $row[\"prioridad\"]);\n        $objPHPExcel->getActiveSheet()->SetCellValue(\"E\" . $count, $row[\"fecha\"]);\n        $objPHPExcel->getActiveSheet()->SetCellValue(\"F\" . $count, $row[\"rcs\"]);\n        $objPHPExcel->getActiveSheet()->SetCellValue(\"G\" . $count, $row[\"shs\"]);\n        $count++;\n    }\n\n    //Titulo del libro y seguridad \n    $objPHPExcel->getActiveSheet()->setTitle('Reporte');\n    $objPHPExcel->getSecurity()->setLockWindows(true);\n    $objPHPExcel->getSecurity()->setLockStructure(true);\n\n\n\n    // Se modifican los encabezados del HTTP para indicar que se envia un archivo de Excel.\n\n    header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');\n    header(\"Content-Disposition: attachment;filename=reporte_compromisos_al_$fecha.xlsx \");\n    header('Cache-Control: max-age=0');\n\n\n    $objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');\n\n    ob_clean();\n    flush();\n    //readfile($fichero);\n    $objWriter->save('php://output');\n\n\n    exit;\n}\n\nfunction obtener_calificacion_stakeholder($idpersona, $idmodulo, $fecha_del, $fecha_al) {\n    $iidimension = new idimension_matriz_sh();\n    $ayudante = new Ayudante();\n    $fecha_del = $ayudante->FechaRevezMysql($fecha_del, \"/\");\n    $fecha_al = $ayudante->FechaRevezMysql($fecha_al, \"/\");\n\n    $result = $iidimension->lista_calificacion($idpersona, $idmodulo, $fecha_del, $fecha_al);\n\n    $datos = array();\n\n\n    while ($fila = mysql_fetch_array($result)) {\n        $fecha = $fila[fecha];\n        $posicion = $fila[posicion];\n        $poder = $fila[poder];\n        $interes = $fila[interes];\n        $idsh_dimension = $fila[idsh_dimension];\n        $idmodulo_sh_dimension = $fila[idmodulo_sh_dimension];\n\n        $accion = \"<a href=\\\"javascript:eliminar_calificacion($idsh_dimension,$idmodulo_sh_dimension)\\\" ><img src=\\\"../../../img/trash.png\\\" /></a>\";\n        $data = array(\"fecha\" => $fecha, \"posicion\" => $posicion, \"poder\" => $poder, \"interes\" => $interes, \"accion\" => $accion);\n        $datos[] = $data;\n    }\n\n    echo json_encode($datos);\n}\n\nfunction ver_buscar_red() {\n\n\n    $plantilla = new DmpTemplate(\"../../../plantillas/stakeholder/red/buscar.html\");\n\n\n    $plantilla->presentaPlantilla();\n}\n\nfunction consultar_indentificadores_geograficos($idtag_compuesto, $tags, $tags_predio) {\n\n\n\n    $istakeholder = new istakeholder();\n\n    $result = $istakeholder->lista_stakeholder_predio_tag($idtag_compuesto, $tags, $tags_predio);\n\n    $fid_string = \" \";\n\n    while ($fila = mysql_fetch_array($result)) {\n        $fid_string .= $fila[idgis_item] . \",\";\n    }\n\n    $datos = array();\n\n    $fid_string = substr($fid_string, 0, -1);\n\n    $datos[\"fid_string\"] = $fid_string;\n\n    echo json_encode($datos);\n}\n\nfunction ver_predio_persona($idgis_item) {\n\n    $plantilla = new DmpTemplate(\"../../../plantillas/stakeholder/mapa/ver_predio_persona.html\");\n    $istakeholder = new istakeholder();\n    $result = $istakeholder->listar_predio_persona($idgis_item);\n    $count = 0;\n\n    while ($fila = mysql_fetch_array($result)) {\n\n        $count++;\n\n        $plantilla->iniciaBloque(\"persona\");\n        $plantilla->reemplazaEnBloque(\"numero\", $count, \"persona\");\n        if ($fila[idpersona_tipo] > 1) {\n            $plantilla->reemplazaEnBloque(\"nombre\", utf8_encode($fila[apellido_p]), \"persona\");\n        } else {\n            $plantilla->reemplazaEnBloque(\"nombre\", utf8_encode($fila[nombre] . \" \" . $fila[apellido_p] . \" \" . $fila[apellido_m]), \"persona\");\n        }\n        $plantilla->reemplazaEnBloque(\"idpersona_compuesto\", $fila[idpersona] . \"---\" . $fila[idmodulo], \"persona\");\n    }\n\n    $plantilla->presentaPlantilla();\n}\n\nfunction actualizar_predio_stakeholder($idpredio, $idmodulo_predio, $idpredio_archivo, $comentario_predio, $idpredio_complejo_tag, $orden_complejo_tag) {\n\n    $gstakeholder = new gstakeholder();\n    $respuesta = $gstakeholder->actualizar_predio($idpredio, $idmodulo_predio, $comentario_predio, $idpredio_archivo, $idpredio_complejo_tag, $orden_complejo_tag);\n\n    $arespuesta = split(\"---\", $respuesta);\n\n    $data['op_stakeholder'] = true;\n\n\n\n    if ($arespuesta[1] == 0) {\n\n        $count = 0;\n        $archivos = array();\n\n        foreach ($_FILES[\"archivos\"][\"error\"] as $key => $error) {\n            if ($error == UPLOAD_ERR_OK) {\n                $tmp_name = $_FILES[\"archivos\"][\"tmp_name\"][$key];\n                $archivo = $_FILES[\"archivos\"][\"name\"][$key];\n\n                $uploadfile = dirname(dirname(dirname(dirname(__FILE__)))) . DIRECTORY_SEPARATOR . \"archivo\" . DIRECTORY_SEPARATOR . $_SESSION['proyecto'] . DIRECTORY_SEPARATOR . \"predio\" . DIRECTORY_SEPARATOR . $idpredio . '_' . $archivo;\n                $thumbfile = dirname(dirname(dirname(dirname(__FILE__)))) . DIRECTORY_SEPARATOR . \"archivo\" . DIRECTORY_SEPARATOR . $_SESSION['proyecto'] . DIRECTORY_SEPARATOR . \"predio\" . DIRECTORY_SEPARATOR . \"thumbnail\" . DIRECTORY_SEPARATOR . $idpredio . '_' . $archivo;\n                //echo $uploadfile.\" \";\n\n                if (move_uploaded_file($tmp_name, $uploadfile)) {\n                    $archivos[] = $archivo;\n                    $count++;\n                    $thumb = new thumb();\n                    if ($thumb->loadImage($uploadfile)) {\n\n                        $thumb->resize(100, 'height');\n                        $thumb->save($thumbfile);\n                    }\n                }\n            }\n        }\n\n        if ($count > 0) {\n            $gstakeholder->agregar_archivo_predio($idpredio, $archivos);\n        }\n\n        $data['success'] = true;\n        $data['mensaje'] = coloca_mensaje(\"actualiza_ok\", \" del predio \");\n        $data['idpredio'] = $idpredio;\n\n        //$data['data'] = ver_bloque_interaccion(1,\"\",$idinteraccion, $idmodulo_interaccion, 0, 3, 0);\n        //ver_bloque_interaccion($idpersona, $idmodulo, $inicio, $presenta = 1, $persona = 1, $tabla_interaccion = 1)\n    } else {\n        $data['success'] = false;\n        $data['mensaje'] = coloca_mensaje(\"actualiza_error\", \" del predio \");\n    }\n\n\n\n    echo json_encode($data);\n}\n?>\n\n",
			"file": "programas/stakeholder/stakeholder/astakeholder.php",
			"file_size": 180783,
			"file_write_time": 130372351804377620,
			"settings":
			{
				"buffer_size": 180783,
				"line_ending": "Unix"
			}
		}
	],
	"build_system": "",
	"command_palette":
	{
		"height": 392.0,
		"selected_items":
		[
		],
		"width": 392.0
	},
	"console":
	{
		"height": 0.0
	},
	"distraction_free":
	{
		"menu_visible": true,
		"show_minimap": false,
		"show_open_files": false,
		"show_tabs": false,
		"side_bar_visible": false,
		"status_bar_visible": false
	},
	"file_history":
	[
		"/C/xampp/htdocs/demo/protected/config/main.php",
		"/C/xampp/htdocs/demo/protected/views/greeting/index.php",
		"/C/xampp/htdocs/demo/protected/controllers/GreetingController.php",
		"/C/xampp/htdocs/demo/protected/models/Message.php"
	],
	"find":
	{
		"height": 34.0
	},
	"find_in_files":
	{
		"height": 0.0,
		"where_history":
		[
		]
	},
	"find_state":
	{
		"case_sensitive": false,
		"find_history":
		[
			"ver_tag",
			"function ver_tag",
			"ver_tag",
			"busca_rapida_tag",
			"ver_mas_tag",
			"ctrl+p",
			"ver_reporte_estadistico"
		],
		"highlight": true,
		"in_selection": false,
		"preserve_case": false,
		"regex": false,
		"replace_history":
		[
		],
		"reverse": false,
		"show_context": true,
		"use_buffer2": true,
		"whole_word": false,
		"wrap": true
	},
	"groups":
	[
		{
			"selected": 2,
			"sheets":
			[
				{
					"buffer": 0,
					"file": "programas/reporte/stakeholder/areporte.php",
					"settings":
					{
						"buffer_size": 55672,
						"regions":
						{
						},
						"selection":
						[
							[
								0,
								0
							]
						],
						"settings":
						{
							"syntax": "Packages/PHP/PHP.tmLanguage",
							"tab_size": 4,
							"translate_tabs_to_spaces": true
						},
						"translation.x": 0.0,
						"translation.y": 14717.0,
						"zoom_level": 1.0
					},
					"type": "text"
				},
				{
					"buffer": 1,
					"file": "/C/Users/daniel.montjoyp/AppData/Roaming/Sublime Text 2/Packages/Default/Default (Windows).sublime-keymap",
					"settings":
					{
						"buffer_size": 30564,
						"regions":
						{
						},
						"selection":
						[
							[
								6,
								6
							]
						],
						"settings":
						{
							"syntax": "Packages/JavaScript/JSON.tmLanguage",
							"translate_tabs_to_spaces": false
						},
						"translation.x": 0.0,
						"translation.y": 0.0,
						"zoom_level": 1.0
					},
					"type": "text"
				},
				{
					"buffer": 2,
					"file": "informacion/reporte/class.ireporte.php",
					"settings":
					{
						"buffer_size": 91665,
						"regions":
						{
						},
						"selection":
						[
							[
								0,
								0
							]
						],
						"settings":
						{
							"syntax": "Packages/PHP/PHP.tmLanguage",
							"tab_size": 2,
							"translate_tabs_to_spaces": true
						},
						"translation.x": 0.0,
						"translation.y": 11059.0,
						"zoom_level": 1.0
					},
					"type": "text"
				},
				{
					"buffer": 3,
					"file": "programas/stakeholder/stakeholder/astakeholder.php",
					"settings":
					{
						"buffer_size": 180783,
						"regions":
						{
						},
						"selection":
						[
							[
								3705,
								3705
							]
						],
						"settings":
						{
							"syntax": "Packages/PHP/PHP.tmLanguage",
							"tab_size": 4,
							"translate_tabs_to_spaces": true
						},
						"translation.x": 0.0,
						"translation.y": 1307.0,
						"zoom_level": 1.0
					},
					"type": "text"
				}
			]
		}
	],
	"incremental_find":
	{
		"height": 0.0
	},
	"input":
	{
		"height": 0.0
	},
	"layout":
	{
		"cells":
		[
			[
				0,
				0,
				1,
				1
			]
		],
		"cols":
		[
			0.0,
			1.0
		],
		"rows":
		[
			0.0,
			1.0
		]
	},
	"menu_visible": true,
	"replace":
	{
		"height": 0.0
	},
	"save_all_on_build": true,
	"select_file":
	{
		"height": 0.0,
		"selected_items":
		[
			[
				"ast",
				"programas/stakeholder/stakeholder/astakeholder.php"
			],
			[
				"irepor",
				"informacion/reporte/class.ireporte.php"
			]
		],
		"width": 0.0
	},
	"select_project":
	{
		"height": 500.0,
		"selected_items":
		[
		],
		"width": 380.0
	},
	"show_minimap": true,
	"show_open_files": false,
	"show_tabs": true,
	"side_bar_visible": true,
	"side_bar_width": 273.0,
	"status_bar_visible": true
}
